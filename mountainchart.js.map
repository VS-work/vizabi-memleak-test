{"version":3,"sources":["webpack:///webpack/bootstrap 7649343ee32b82bf5ca5","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/dialogs/axesmc/axesmc.js","webpack:///./src/mountainchart-math.js","webpack:///./src/mountainchart-probe.js","webpack:///./src/mountainchart-selectlist.js","webpack:///./src/styles.scss?ccec","webpack:///./src/dialogs/axesmc/axesmc.html","webpack:///./src/template.html"],"names":["VERSION_INFO","version","build","MountainChart","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","default_model","state","time","locale","ui","chart","manualSortingEnabled","yMaxMethod","showProbeX","probeX","xLogStops","xPoints","directSigma","directMu","preload","preloadKey","datawarning","doubtDomain","doubtRange","presentation","versionInfo","utils","globals","_globals","iconset","iconWarn","warn","iconQuestion","question","helpers","Exporter","svgexport","axisSmart","DynamicBackground","THICKNESS_THRESHOLD","COLOR_WHITEISH","MountainChartComponent","config","context","_this","template","require","model_expects","type","model_binds","evt","_readyOnce","marker","getFrame","value","frameChanged","bind","playing","redrawDataPoints","ready","updateSize","_adjustMaxY","force","record","_export","open","element","reset","highlightMarkers","updateOpacity","selectMarkers","_selectlist","redraw","updateDoubtOpacity","_probe","path","indexOf","zoomToMaxMin","updatePointers","pause","redrawDataPointsOnlyColors","_math","MountainChartMath","prefix","deleteClasses","Probe","Selectlist","area","d3","curve","curveBasis","x","xScale","rescale","d","y0","yScale","y1","y","stack","order","stackOrderReverse","key","cached","cScale","xAxis","rangeRatio","rangeShift","mesh","yMax","domReady","select","graph","xAxisEl","xTitleEl","yTitleEl","infoEl","dataWarningEl","yearEl","year","mountainMergeStackedContainer","mountainMergeGroupedContainer","mountainAtomicContainer","mountainLabelContainer","tooltip","eventAreaEl","probeEl","probeLineEl","probeTextEl","selectAll","onTap","i","_interact","_mouseout","afterPreload","xScaleFactor","axis_x","xScaleShift","precomputedShape","income_mountains","shape","length","scaleLog","domain","domainMin","domainMax","scaleLinear","Math","round","map","m","data","enter","append","attr","style","transition","duration","ease","easeLinear","readyOnce","on","dragging","level","invert","mouse","full","TIMEDIM","getDimension","KEYS","unique","_getAllDimensions","exceptType","KEY","join","dataKeys","getDataKeysPerHook","labelNames","getLabelHookNames","remove","setText","formatDate","wScale","range","updateUIStrings","updateIndicators","values","valuesAggregated","color","axis_y","end","updateEntities","endValues","_spawnMasks","updateTime","frame","toString","meshLength","profiles","small","margin","top","right","left","bottom","infoElHeight","medium","large","presentationProfileChanges","activeProfile","getActiveProfile","height","parseInt","width","isRTL","yearLabelOptions","topOffset","getLayoutProfile","xAlign","yAlign","widthRatio","setConditions","resize","scaleType","scale","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","pivotingLimit","method","METHOD_REPEATING","stops","formatter","getTickFormatter","call","warnBB","node","getBBox","titleBBox","t","transform","hTranslate","translateX","translateY","generateMesh","mdl","zoomedMin","zoomedMax","x1","x2","isFinite","translator","getTFunction","xConceptprops","getConceptprops","text","setIcon","parent","findChildByName","pin","rect","coord","makeAbsoluteContext","farthestViewportElement","toolRect","root","getBoundingClientRect","chartRect","setHook","show","setPos","hide","toggle","opacity","getUTCFullYear","someSelected","getScale","tickFormat","mountainPointers","getKeys","filter","getKey","axis_s","pointer","_keys","_key","sortValue","aggrLevel","groupedPointers","nest","use","group","sortValues","a","b","entries","groupManualSort","manualSorting","isManualSortCorrect","isArray","forEach","groupSortValue","includes","sum","sortGroupKeys","which","stackedPointers","sort","sortKeys","mountainsMergeStacked","mountainsMergeGrouped","mountainsAtomic","exit","merge","mountains","isTouchDevice","_mousemove","_click","event","stopPropagation","onLongTap","_getLabelText","highlightMarker","_setTooltip","getColorlegendMarker","label","getItems","showCloseCross","clearHighlighted","isPlayingOrDragging","isSelected","selectMarker","someHighlighted","highlight","selectList","classed","isHighlighted","rebuild","nonSelectedOpacityZero","_sumLeafPointersByMarker","branch","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","time_1","delayAnimations","vertices","_spawn","hidden","toStack","concat","subgroup","f","keys","keyIndex","verticesIndex","valuesPointer","max","mergeGrouped","mergeStacked","firstLast","_getFirstLastPointersInStack","_getVerticesOfaMergedShape","first","visible","e","yMaxGroup","visible2","last","arg","tailFatX","unscale","tailCutX","tailFade","k","PI","log","spawnMask","cosineShape","cosineArea","dX","exp","cos","norm","sigma","giniToSigma","mu","gdpToMu","distribution","acc","pdf","lognormal","result","options","prevValues","stackMode","dragOrPlay","each","view","_renderShape","isColorUseIndicator","palette","datum","random","easeCircle","write","id","fill","tooltipText","contentBBox","getProp","Promise","resolve","_getFirstDimension","dim","query","language","from","where","$and","$in","order_by","reject","dataPromise","load","JSON","parse","then","dataId","getData","err","stringify","Axes","updateView","markerID","selectDomainMinMax","selectZoomedMinMax","yMaxRadio","setModel","probeCheck","property","probeFieldEl","parseFloat","replace","what","push","MCMath","Class","rangeFrom","rangeTo","rangeStep","gdp","gini","normsinv","pow","normal","p","c","plow","phigh","q","sqrt","r","MCProbe","highlightValue","sumValue","totalArea","leftArea","_computeAreas","formatter1","format","formatter2","heightOfLabels","string","iconClose","close","MCSelectList","_local","listData","descending","labelCloseGroup","insert","sample","fontHeight","fontSizeToFontHeight","parentNode","titleHeight","maxFontHeight","currentAggrLevel","aggrLevelSpacing","groupLabels","spacing","_id","number","closeGroup","closeTextBBox","setTimeout","unhighlightMarker"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;AChEA;;AACA;;;;AACA;;;;AAEA,IAAMA,eAAe,EAAEC,SAAS,OAAX,EAAsBC,OAAO,aAA7B,EAArB;;AAEA;AACA,IAAMC,gBAAgBC,OAAOC,IAAP,CAAYC,MAAZ,CAAmB,eAAnB,EAAoC;;AAExD;;;;;;AAMAC,MARwD,gBAQnDC,WARmD,EAQtCC,cARsC,EAQtB;;AAEhC,SAAKC,IAAL,GAAY,eAAZ;;AAEA;AACA,SAAKC,UAAL,GAAkB,CAAC;AACjBC,oCADiB;AAEjBJ,mBAAa,eAFI;AAGjBK,aAAO,CAAC,YAAD,EAAe,cAAf,EAA+B,QAA/B,EAAyC,MAAzC,EAAiD,IAAjD,CAHU,CAG6C;AAH7C,KAAD,EAIf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,YAArB,CADV;AAEDP,mBAAa,sBAFZ;AAGDK,aAAO,CAAC,YAAD,EAAe,cAAf,EAA+B,IAA/B;AAHN,KAJe,EAQf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,SAArB,CADV;AAEDP,mBAAa,mBAFZ;AAGDK,aAAO,CAAC,OAAD,EAAU,IAAV,EAAgB,QAAhB;AAHN,KARe,EAYf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,YAArB,CADV;AAEDP,mBAAa,sBAFZ;AAGDK,aAAO,CAAC,OAAD,EAAU,IAAV,EAAgB,QAAhB;AAHN,KAZe,EAgBf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,UAArB,CADV;AAEDP,mBAAa,oBAFZ;AAGDK,aAAO,CAAC,cAAD,EAAiB,YAAjB,EAA+B,QAA/B,EAAyC,IAAzC;AAHN,KAhBe,EAoBf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,aAArB,CADV;AAEDP,mBAAa,uBAFZ;AAGDK,aAAO,CAAC,QAAD;AAHN,KApBe,EAwBf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,WAArB,CADV;AAEDP,mBAAa,qBAFZ;AAGDK,aAAO,CAAC,cAAD,EAAiB,QAAjB;AAHN,KAxBe,EA4Bf;AACDD,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,oBAArB,CADV;AAEDP,mBAAa,gCAFZ;AAGDK,aAAO,CAAC,YAAD,EAAe,QAAf;AAHN,KA5Be,CAAlB;;AAkCA;AACA,SAAKG,MAAL,CAAYR,WAAZ,EAAyBC,cAAzB;AACD,GAjDuD;;;AAmDxDQ,iBAAe;AACbC,WAAO;AACLC,YAAM;AACJ,iBAAS,GADL;AAEJ,4BAAoB,EAFhB;AAGJ,4BAAoB;AAHhB,OADD;AAML,kBAAY;AACV,4BAAoB,GADV;AAEV,0BAAkB;AAFR;AANP,KADM;AAYbC,YAAQ,EAZK;AAabC,QAAI;AACFC,aAAO;AACLC,8BAAsB,IADjB;AAELC,oBAAY,QAFP;AAGLC,oBAAY,IAHP;AAILC,gBAAQ,IAJH;AAKLC,mBAAW,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CALN;AAMLC,iBAAS,EANJ;AAOLC,qBAAa,KAPR,EAOe;AACpBC,kBAAU,KARL,EAQY;AACjBC,iBAAS,kBATJ;AAULC,oBAAY;AAVP,OADL;AAaF,iBAAW,CAAC,QAAD,EAAW,MAAX,EAAmB,OAAnB,EAA4B,aAA5B,EAA2C,YAA3C,EAAyD,cAAzD,CAbT;AAcF,iBAAW;AACT,iBAAS,CAAC,QAAD,EAAW,MAAX,EAAmB,OAAnB,EAA4B,aAA5B,CADA;AAET,mBAAW,CAAC,QAAD,EAAW,MAAX,EAAmB,OAAnB,CAFF;AAGT,uBAAe,CAAC,SAAD,EAAY,OAAZ,EAAqB,OAArB,EAA8B,QAA9B,EAAwC,QAAxC,EAAkD,cAAlD,EAAkE,OAAlE;AAHN,OAdT;AAmBFC,mBAAa;AACXC,qBAAa,EADF;AAEXC,oBAAY;AAFD,OAnBX;AAuBFC,oBAAc;AAvBZ;AAbS,GAnDyC;;AA2FxDC,eAAarC;AA3F2C,CAApC,CAAtB;;kBA8FeG,a;;;;;;;;;;;;;ACzEf;;;;AACA;;;;AACA;;;;;;;;AA9BA;;;;;;;;;;;;;;cA0BIC,M;IAXFkC,K,WAAAA,K;IACUC,O,WAAVC,Q;8BACAC,O;IACQC,Q,mBAANC,I;IACUC,Y,mBAAVC,Q;8BAEFC,O;IACaC,Q,mBAAXC,S;IAC0BC,S,mBAA1B,wB;IACwBC,iB,mBAAxB,sB;;;AAQJ,IAAMC,sBAAsB,KAA5B;AACA,IAAMC,iBAAiB,SAAvB;;AAEA;AACA,IAAMC,yBAAyBjD,OAAOU,SAAP,CAAiBR,MAAjB,CAAwB,eAAxB,EAAyC;;AAEtE;;;;;;AAMAC,MARsE,gBAQjE+C,MARiE,EAQzDC,OARyD,EAQhD;;AAEpB,QAAMC,QAAQ,IAAd;AACA,SAAK9C,IAAL,GAAY,eAAZ;AACA,SAAK+C,QAAL,GAAgB,mBAAAC,CAAQ,CAAR,CAAhB;;AAEA;AACA,SAAKC,aAAL,GAAqB,CACnB,EAAEjD,MAAM,MAAR,EAAgBkD,MAAM,MAAtB,EADmB,EAEnB,EAAElD,MAAM,QAAR,EAAkBkD,MAAM,QAAxB,EAFmB,EAGnB,EAAElD,MAAM,QAAR,EAAkBkD,MAAM,QAAxB,EAHmB,EAInB,EAAElD,MAAM,MAAR,EAAgBkD,MAAM,MAAtB,EAJmB,EAKnB,EAAElD,MAAM,IAAR,EAAckD,MAAM,IAApB,EALmB,CAArB;;AAQA;AACA,SAAKC,WAAL,GAAmB;AACjB,2BAAqB,yBAASC,GAAT,EAAc;AACjC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvBP,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmBC,QAAnB,CAA4BT,MAAM3C,KAAN,CAAYM,IAAZ,CAAiB+C,KAA7C,EAAoDV,MAAMW,YAAN,CAAmBC,IAAnB,CAAwBZ,KAAxB,CAApD;AACD,OAJgB;AAKjB,6BAAuB,2BAASM,GAAT,EAAc;AACnC;AACA;AACA,YAAI,CAACN,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBkD,OAAtB,EAA+B;AAC7Bb,gBAAMc,gBAAN;AACD;AACF,OAXgB;AAYjB,2CAAqC,0CAAW;AAC9Cd,cAAMe,KAAN;AACD,OAdgB;AAejB,0CAAoC,yCAAW;AAC7Cf,cAAMe,KAAN;AACD,OAjBgB;AAkBjB,uCAAiC,sCAAW;AAC1Cf,cAAMe,KAAN;AACD,OApBgB;AAqBjB,uCAAiC,sCAAW;AAC1Cf,cAAMe,KAAN;AACD,OAvBgB;AAwBjB,uCAAiC,sCAAW;AAC1Cf,cAAMe,KAAN;AACD,OA1BgB;AA2BjB,gCAA0B,+BAAW;AACnCf,cAAMe,KAAN;AACD,OA7BgB;AA8BjB,oCAA8B,mCAAW;AACvCf,cAAMe,KAAN;AACD,OAhCgB;AAiCjB,iCAA2B,gCAAW;AACpCf,cAAMe,KAAN;AACD,OAnCgB;AAoCjB,mCAA6B,kCAAW;AACtCf,cAAMgB,UAAN;AACD,OAtCgB;AAuCjB,oCAA8B,mCAAW;AACvChB,cAAMiB,WAAN,CAAkB,EAAEC,OAAO,IAAT,EAAlB;AACAlB,cAAMc,gBAAN;AACD,OA1CgB;AA2CjB,4BAAsB,0BAASR,GAAT,EAAc;AAClC,YAAIN,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBwD,MAArB,EAA6B;AAC3BnB,gBAAMoB,OAAN,CAAcC,IAAd,CAAmB,KAAKC,OAAxB,EAAiC,KAAKpE,IAAtC;AACD,SAFD,MAEO;AACL8C,gBAAMoB,OAAN,CAAcG,KAAd;AACD;AACF,OAjDgB;AAkDjB,iCAA2B,+BAASjB,GAAT,EAAc;AACvC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvBP,cAAMwB,gBAAN;AACAxB,cAAMyB,aAAN;AACD,OAtDgB;AAuDjB,8BAAwB,4BAASnB,GAAT,EAAc;AACpC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvBP,cAAM0B,aAAN;AACA1B,cAAM2B,WAAN,CAAkBC,MAAlB;AACA5B,cAAMyB,aAAN;AACAzB,cAAM6B,kBAAN;AACA7B,cAAMc,gBAAN;AACAd,cAAM8B,MAAN,CAAaF,MAAb;AACD,OA/DgB;AAgEjB,wCAAkC,sCAAStB,GAAT,EAAc;AAC9CN,cAAMyB,aAAN;AACD,OAlEgB;AAmEjB,sCAAgC,oCAASnB,GAAT,EAAc;AAC5CN,cAAMyB,aAAN;AACD,OArEgB;AAsEjB,uBAAiB,sBAASnB,GAAT,EAAcyB,IAAd,EAAoB;AACnC,YAAI,CAAC/B,MAAMO,UAAX,EAAuB;AACvB,YAAIwB,KAAKC,OAAL,CAAa,WAAb,IAA4B,CAAC,CAAjC,EAAoC;AAClChC,gBAAMe,KAAN;AACD,SAFD,MAEO,IAAIgB,KAAKC,OAAL,CAAa,WAAb,IAA4B,CAAC,CAA7B,IAAkCD,KAAKC,OAAL,CAAa,WAAb,IAA4B,CAAC,CAAnE,EAAsE;AAC3EhC,gBAAMiC,YAAN;AACAjC,gBAAMc,gBAAN;AACAd,gBAAM8B,MAAN,CAAaF,MAAb;AACD;AACF,OA/EgB;AAgFjB,6BAAuB,2BAAStB,GAAT,EAAcyB,IAAd,EAAoB;AACzC,YAAI,CAAC/B,MAAMO,UAAX,EAAuB;AACvB,YAAIwB,KAAKC,OAAL,CAAa,aAAb,IAA8B,CAAC,CAAnC,EAAsC;AACtChC,cAAMe,KAAN;AACD,OApFgB;AAqFjB,mCAA6B,gCAAST,GAAT,EAAc;AACzC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvBP,cAAMkC,cAAN;AACAlC,cAAMc,gBAAN;AACD,OAzFgB;AA0FjB,6BAAuB,2BAASR,GAAT,EAAc;AACnC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvBP,cAAMe,KAAN;AACD,OA7FgB;AA8FjB,mCAA6B,gCAAST,GAAT,EAAc;AACzC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvB,YAAIP,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBkD,OAArB,EAA8B;AAC5Bb,gBAAM3C,KAAN,CAAYM,IAAZ,CAAiBwE,KAAjB;AACD;AACF,OAnGgB;AAoGjB,iCAA2B,8BAAS7B,GAAT,EAAc;AACvC,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvB,YAAIP,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBkD,OAArB,EAA8B;AAC5Bb,gBAAM3C,KAAN,CAAYM,IAAZ,CAAiBwE,KAAjB;AACD;AACF,OAzGgB;AA0GjB,qCAA+B,kCAAS7B,GAAT,EAAc;AAC3C,YAAI,CAACN,MAAMO,UAAX,EAAuB;AACvBP,cAAMoC,0BAAN;AACApC,cAAM2B,WAAN,CAAkBC,MAAlB;AACD;AA9GgB,KAAnB;;AAiHA,SAAKpE,MAAL,CAAYsC,MAAZ,EAAoBC,OAApB;;AAEA,SAAKsC,KAAL,GAAa,IAAIC,2BAAJ,CAAsB,IAAtB,CAAb;AACA,SAAKlB,OAAL,GAAe,IAAI7B,QAAJ,CAAa,IAAb,CAAf;AACA,SAAK6B,OAAL,CACGmB,MADH,CACU,SADV,EAEGC,aAFH,CAEiB,CAAC,+BAAD,EAAkC,+BAAlC,EAAmE,kBAAnE,EAAuF,aAAvF,EAAsG,yBAAtG,EAAiI,oBAAjI,CAFjB;AAGA,SAAKV,MAAL,GAAc,IAAIW,4BAAJ,CAAU,IAAV,CAAd;AACA,SAAKd,WAAL,GAAmB,IAAIe,iCAAJ,CAAe,IAAf,CAAnB;;AAEA;AACA,SAAKC,IAAL,GAAYC,GAAGD,IAAH,GACTE,KADS,CACHD,GAAGE,UADA,EAETC,CAFS,CAEP;AAAA,aAAK/C,MAAMgD,MAAN,CAAahD,MAAMqC,KAAN,CAAYY,OAAZ,CAAoBC,EAAEH,CAAtB,CAAb,CAAL;AAAA,KAFO,EAGTI,EAHS,CAGN;AAAA,aAAKnD,MAAMoD,MAAN,CAAaF,EAAEC,EAAf,CAAL;AAAA,KAHM,EAITE,EAJS,CAIN;AAAA,aAAKrD,MAAMoD,MAAN,CAAaF,EAAEC,EAAF,GAAOD,EAAEI,CAAtB,CAAL;AAAA,KAJM,CAAZ;;AAMA;AACA,SAAKC,KAAL,GAAaX,GAAGW,KAAH,GACVC,KADU,CACJZ,GAAGa,iBADC,EAEV/C,KAFU,CAEJ,UAACwC,CAAD,EAAIQ,GAAJ;AAAA,aAAY1D,MAAM2D,MAAN,CAAaD,GAAb,EAAkBR,CAAlB,EAAqBI,CAAjC;AAAA,KAFI,CAAb;;AAIA;AACA,SAAKN,MAAL,GAAc,IAAd;AACA,SAAKI,MAAL,GAAc,IAAd;AACA,SAAKQ,MAAL,GAAc,IAAd;;AAEA,SAAKC,KAAL,GAAapE,UAAU,QAAV,CAAb;;AAGA,SAAKqE,UAAL,GAAkB,CAAlB;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,SAAKJ,MAAL,GAAc,EAAd;AACA,SAAKK,IAAL,GAAY,EAAZ;AACA,SAAKC,IAAL,GAAY,CAAZ;AACD,GA5KqE;AA8KtEC,UA9KsE,sBA8K3D;AACT,QAAMlE,QAAQ,IAAd;;AAEA;AACA,SAAKsB,OAAL,GAAesB,GAAGuB,MAAH,CAAU,KAAK7C,OAAf,CAAf;AACA,SAAK8C,KAAL,GAAa,KAAK9C,OAAL,CAAa6C,MAAb,CAAoB,eAApB,CAAb;AACA,SAAKE,OAAL,GAAe,KAAKD,KAAL,CAAWD,MAAX,CAAkB,gBAAlB,CAAf;AACA,SAAKG,QAAL,GAAgB,KAAKF,KAAL,CAAWD,MAAX,CAAkB,sBAAlB,CAAhB;AACA,SAAKI,QAAL,GAAgB,KAAKH,KAAL,CAAWD,MAAX,CAAkB,sBAAlB,CAAhB;AACA,SAAKK,MAAL,GAAc,KAAKJ,KAAL,CAAWD,MAAX,CAAkB,mBAAlB,CAAd;AACA,SAAKM,aAAL,GAAqB,KAAKL,KAAL,CAAWD,MAAX,CAAkB,mBAAlB,CAArB;;AAEA,SAAKO,MAAL,GAAc,KAAKN,KAAL,CAAWD,MAAX,CAAkB,cAAlB,CAAd;AACA,SAAKQ,IAAL,GAAY,IAAIjF,iBAAJ,CAAsB,KAAKgF,MAA3B,CAAZ;;AAEA,SAAKE,6BAAL,GAAqC,KAAKR,KAAL,CAAWD,MAAX,CAAkB,gCAAlB,CAArC;AACA,SAAKU,6BAAL,GAAqC,KAAKT,KAAL,CAAWD,MAAX,CAAkB,gCAAlB,CAArC;AACA,SAAKW,uBAAL,GAA+B,KAAKV,KAAL,CAAWD,MAAX,CAAkB,mBAAlB,CAA/B;AACA,SAAKY,sBAAL,GAA8B,KAAKX,KAAL,CAAWD,MAAX,CAAkB,0BAAlB,CAA9B;AACA,SAAKa,OAAL,GAAe,KAAK1D,OAAL,CAAa6C,MAAb,CAAoB,iBAApB,CAAf;AACA,SAAKc,WAAL,GAAmB,KAAK3D,OAAL,CAAa6C,MAAb,CAAoB,mBAApB,CAAnB;AACA,SAAKe,OAAL,GAAe,KAAK5D,OAAL,CAAa6C,MAAb,CAAoB,eAApB,CAAf;AACA,SAAKgB,WAAL,GAAmB,KAAKD,OAAL,CAAaf,MAAb,CAAoB,MAApB,CAAnB;AACA,SAAKiB,WAAL,GAAmB,KAAKF,OAAL,CAAaG,SAAb,CAAuB,MAAvB,CAAnB;;AAEA,SAAK/D,OAAL,CACGgE,KADH,CACS,UAACpC,CAAD,EAAIqC,CAAJ,EAAU;AACfvF,YAAMwF,SAAN,GAAkBC,SAAlB,CAA4BvC,CAA5B,EAA+BqC,CAA/B;AACD,KAHH;AAID,GA3MqE;AA6MtEG,cA7MsE,0BA6MvD;AACb,QAAM1F,QAAQ,IAAd;;AAEA,SAAKqC,KAAL,CAAWsD,YAAX,GAA0B,KAAKtI,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBD,YAAnD;AACA,SAAKtD,KAAL,CAAWwD,WAAX,GAAyB,KAAKxI,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBC,WAAlD;;AAEA,QAAI,CAAC,KAAKC,gBAAN,IAA0B,CAAC,KAAKA,gBAAL,CAAsB,CAAtB,CAA3B,IAAuD,CAAC,KAAKA,gBAAL,CAAsB,CAAtB,EAAyBC,gBAArF,EAAuG;;AAEvG,QAAM9B,OAAO,KAAK6B,gBAAL,CAAsB,CAAtB,EAAyBC,gBAAzB,CAA0C,UAAU,KAAK1I,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBE,UAAxE,CAAb;AACA,QAAIgI,QAAQ,KAAKF,gBAAL,CAAsB,CAAtB,EAAyBC,gBAAzB,CAA0CC,KAAtD;;AAEA,QAAI,CAAC/B,IAAD,IAAS,CAAC+B,KAAV,IAAmBA,MAAMC,MAAN,KAAiB,CAAxC,EAA2C;;AAE3C,SAAKjD,MAAL,GAAcJ,GAAGsD,QAAH,GAAcC,MAAd,CAAqB,CAAC,KAAK9I,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBQ,SAA1B,EAAqC,KAAK/I,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBS,SAA9D,CAArB,CAAd;AACA,SAAKjD,MAAL,GAAcR,GAAG0D,WAAH,GAAiBH,MAAjB,CAAwB,CAAC,CAAD,EAAII,KAAKC,KAAL,CAAWvC,IAAX,CAAJ,CAAxB,CAAd;;AAEAjE,UAAMgB,UAAN,CAAiBgF,MAAMC,MAAvB;AACAjG,UAAMiC,YAAN;;AAEA+D,YAAQA,MAAMS,GAAN,CAAU,UAACC,CAAD,EAAInB,CAAJ;AAAA,aAAW,EAAExC,GAAG/C,MAAMgE,IAAN,CAAWuB,CAAX,CAAL,EAAoBpC,IAAI,CAAxB,EAA2BG,GAAG,CAACoD,CAA/B,EAAX;AAAA,KAAV,CAAR;;AAEA,SAAK5B,uBAAL,CAA6BO,SAA7B,CAAuC,mBAAvC,EACGsB,IADH,CACQ,CAAC,CAAD,CADR,EAEGC,KAFH,GAEWC,MAFX,CAEkB,MAFlB,EAGGC,IAHH,CAGQ,OAHR,EAGiB,kBAHjB,EAIGC,KAJH,CAIS,MAJT,EAIiB,MAJjB,EAKGA,KALH,CAKS,SALT,EAKoB,CALpB,EAMGD,IANH,CAMQ,GANR,EAMa9G,MAAM2C,IAAN,CAAWqD,KAAX,CANb,EAOGgB,UAPH,GAOgBC,QAPhB,CAOyB,IAPzB,EAO+BC,IAP/B,CAOoCtE,GAAGuE,UAPvC,EAQGJ,KARH,CAQS,SART,EAQoB,CARpB;AASD,GA3OqE;AA6OtEK,WA7OsE,uBA6O1D;;AAEV,SAAKnC,WAAL,CACGoC,EADH,CACM,WADN,EACmB,YAAW;AAC1B,UAAIrH,MAAM3C,KAAN,CAAYM,IAAZ,CAAiB2J,QAArB,EAA+B;AAC/B,UAAI,CAACtH,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBG,UAA1B,EAAsC;AACtC+B,YAAM8B,MAAN,CAAaF,MAAb,CAAoB;AAClB2F,eAAOvH,MAAMgD,MAAN,CAAawE,MAAb,CAAoB5E,GAAG6E,KAAH,CAAS,IAAT,EAAe,CAAf,CAApB,CADW;AAElBC,cAAM;AAFY,OAApB;AAID,KARH,EASGL,EATH,CASM,UATN,EASkB,YAAM;AACpB,UAAIrH,MAAM3C,KAAN,CAAYM,IAAZ,CAAiB2J,QAArB,EAA+B;AAC/B,UAAI,CAACtH,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBG,UAA1B,EAAsC;AACtC+B,YAAM8B,MAAN,CAAaF,MAAb;AACD,KAbH;;AAeA,QAAM5B,QAAQ,IAAd;AACA,SAAKqH,EAAL,CAAQ,QAAR,EAAkB,YAAM;AACtB;AACA;AACA,UAAIrH,MAAMgB,UAAN,EAAJ,EAAwB;AACxBhB,YAAMkC,cAAN,GAJsB,CAIE;AACxBlC,YAAMc,gBAAN;AACAd,YAAM2B,WAAN,CAAkBC,MAAlB;AACA5B,YAAM8B,MAAN,CAAaF,MAAb;AACD,KARD;;AAUA,SAAK+F,OAAL,GAAe,KAAKtK,KAAL,CAAWM,IAAX,CAAgBiK,YAAhB,EAAf;AACA,SAAKC,IAAL,GAAY/I,MAAMgJ,MAAN,CAAa,KAAKzK,KAAL,CAAWmD,MAAX,CAAkBuH,iBAAlB,CAAoC,EAAEC,YAAY,MAAd,EAApC,CAAb,CAAZ;AACA,SAAKC,GAAL,GAAW,KAAKJ,IAAL,CAAUK,IAAV,CAAe,GAAf,CAAX;AACA,SAAKC,QAAL,GAAgB,KAAK9K,KAAL,CAAWmD,MAAX,CAAkB4H,kBAAlB,EAAhB;AACA,SAAKC,UAAL,GAAkB,KAAKhL,KAAL,CAAWmD,MAAX,CAAkB8H,iBAAlB,EAAlB;;AAEA,SAAKxD,uBAAL,CAA6BX,MAA7B,CAAoC,mBAApC,EAAyDoE,MAAzD;AACA,SAAK5D,IAAL,CAAU6D,OAAV,CAAkB,KAAKnL,KAAL,CAAWM,IAAX,CAAgB8K,UAAhB,CAA2B,KAAKpL,KAAL,CAAWM,IAAX,CAAgB+C,KAA3C,CAAlB;AACA,SAAKgI,MAAL,GAAc9F,GAAG0D,WAAH,GACXH,MADW,CACJ,KAAK9I,KAAL,CAAWQ,EAAX,CAAcY,WAAd,CAA0BC,WADtB,EAEXiK,KAFW,CAEL,KAAKtL,KAAL,CAAWQ,EAAX,CAAcY,WAAd,CAA0BE,UAFrB,CAAd;AAGD,GApRqE;AAsRtEoC,OAtRsE,mBAsR9D;AACN;AACA,QAAMf,QAAQ,IAAd;AACA,SAAK6H,IAAL,GAAY/I,MAAMgJ,MAAN,CAAa,KAAKzK,KAAL,CAAWmD,MAAX,CAAkBuH,iBAAlB,CAAoC,EAAEC,YAAY,MAAd,EAApC,CAAb,CAAZ;AACA,SAAKC,GAAL,GAAW,KAAKJ,IAAL,CAAUK,IAAV,CAAe,GAAf,CAAX;AACA,SAAKC,QAAL,GAAgB,KAAK9K,KAAL,CAAWmD,MAAX,CAAkB4H,kBAAlB,EAAhB;AACA,SAAKC,UAAL,GAAkB,KAAKhL,KAAL,CAAWmD,MAAX,CAAkB8H,iBAAlB,EAAlB;;AAEA,SAAKjG,KAAL,CAAWsD,YAAX,GAA0B,KAAKtI,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBD,YAAnD;AACA,SAAKtD,KAAL,CAAWwD,WAAX,GAAyB,KAAKxI,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBC,WAAlD;;AAEA,SAAK+C,eAAL;AACA,SAAKC,gBAAL;AACA,SAAKxL,KAAL,CAAWmD,MAAX,CAAkBC,QAAlB,CAA2B,KAAKpD,KAAL,CAAWM,IAAX,CAAgB+C,KAA3C,EAAkD,kBAAU;AAC1D,UAAI,CAACoI,MAAL,EAAa;AACb9I,YAAM8I,MAAN,GAAeA,MAAf;AACA9I,YAAM+I,gBAAN,GAAyB,EAAEC,OAAO,EAAT,EAAaC,QAAQ,EAArB,EAAzB;;AAEAjJ,YAAM3C,KAAN,CAAYmD,MAAZ,CAAmBC,QAAnB,CAA4BT,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBuL,GAA7C,EAAkD,qBAAa;AAC7DlJ,cAAMmJ,cAAN,CAAqBC,SAArB;AACApJ,cAAMgB,UAAN;AACAhB,cAAMiC,YAAN;AACAjC,cAAMqJ,WAAN;AACArJ,cAAMsJ,UAAN;AACAtJ,cAAMkC,cAAN;AACAlC,cAAMiB,WAAN,CAAkB,EAAEC,OAAO,IAAT,EAAlB;AACAlB,cAAMc,gBAAN;AACAd,cAAMoC,0BAAN;AACApC,cAAMwB,gBAAN;AACAxB,cAAM0B,aAAN;AACA1B,cAAM2B,WAAN,CAAkBC,MAAlB;AACA5B,cAAMyB,aAAN;AACAzB,cAAM6B,kBAAN;AACA7B,cAAM8B,MAAN,CAAaF,MAAb;AACD,OAhBD;AAiBD,KAtBD;AAuBD,GA1TqE;AA4TtEjB,cA5TsE,wBA4TzD4I,KA5TyD,EA4TlD5L,IA5TkD,EA4T5C;AACxB,QAAI,CAAC4L,KAAL,EAAY,OAAOzK,MAAMK,IAAN,CAAW,8EAAX,CAAP;AACZ,QAAIxB,KAAK6L,QAAL,MAAmB,KAAKnM,KAAL,CAAWM,IAAX,CAAgB+C,KAAhB,CAAsB8I,QAAtB,EAAvB,EAAyD,OAFjC,CAEyC;AACjE,SAAKV,MAAL,GAAcS,KAAd;AACA,SAAKD,UAAL;AACA,SAAKpH,cAAL;AACA,SAAKpB,gBAAL;AACA,SAAKa,WAAL,CAAiBC,MAAjB;AACA,SAAKE,MAAL,CAAYF,MAAZ;AACA,SAAKC,kBAAL;AACD,GAtUqE;AAyUtEb,YAzUsE,sBAyU3DyI,UAzU2D,EAyU/C;AACrB,QAAMC,WAAW;AACfC,aAAO;AACLC,gBAAQ,EAAEC,KAAK,EAAP,EAAWC,OAAO,EAAlB,EAAsBC,MAAM,EAA5B,EAAgCC,QAAQ,EAAxC,EADH;AAELC,sBAAc;AAFT,OADQ;AAKfC,cAAQ;AACNN,gBAAQ,EAAEC,KAAK,EAAP,EAAWC,OAAO,EAAlB,EAAsBC,MAAM,EAA5B,EAAgCC,QAAQ,EAAxC,EADF;AAENC,sBAAc;AAFR,OALO;AASfE,aAAO;AACLP,gBAAQ,EAAEC,KAAK,EAAP,EAAWC,OAAO,EAAlB,EAAsBC,MAAM,EAA5B,EAAgCC,QAAQ,EAAxC,EADH;AAELC,sBAAc;AAFT;AATQ,KAAjB;;AAeA,QAAMG,6BAA6B;AACjCF,cAAQ;AACNN,gBAAQ,EAAEC,KAAK,EAAP,EAAWC,OAAO,EAAlB,EAAsBC,MAAM,EAA5B,EAAgCC,QAAQ,EAAxC,EADF;AAENC,sBAAc;AAFR,OADyB;AAKjCE,aAAO;AACLP,gBAAQ,EAAEC,KAAK,EAAP,EAAWC,OAAO,EAAlB,EAAsBC,MAAM,EAA5B,EAAgCC,QAAQ,EAAxC,EADH;AAELC,sBAAc;AAFT;AAL0B,KAAnC;;AAWA,SAAKI,aAAL,GAAqB,KAAKC,gBAAL,CAAsBZ,QAAtB,EAAgCU,0BAAhC,CAArB;AA3BqB,QA4BbR,MA5Ba,GA4BF,KAAKS,aA5BH,CA4BbT,MA5Ba;AAAA,QA6BbK,YA7Ba,GA6BI,KAAKI,aA7BT,CA6BbJ,YA7Ba;;AA+BrB;;AACA,SAAKM,MAAL,GAAeC,SAAS,KAAKlJ,OAAL,CAAayF,KAAb,CAAmB,QAAnB,CAAT,EAAuC,EAAvC,IAA6C6C,OAAOC,GAApD,GAA0DD,OAAOI,MAAlE,IAA6E,CAA3F;AACA,SAAKS,KAAL,GAAcD,SAAS,KAAKlJ,OAAL,CAAayF,KAAb,CAAmB,OAAnB,CAAT,EAAsC,EAAtC,IAA4C6C,OAAOG,IAAnD,GAA0DH,OAAOE,KAAlE,IAA4E,CAAzF;;AAEA,QAAI,KAAKS,MAAL,IAAe,CAAf,IAAoB,KAAKE,KAAL,IAAc,CAAtC,EAAyC;AACvC,WAAKF,MAAL,GAAc,CAAd;AACA,WAAKE,KAAL,GAAa,CAAb;AACA3L,YAAMK,IAAN,CAAW,iFAAX;AACD;;AAED;AACA,SAAKiF,KAAL,CAAW0C,IAAX,CAAgB,WAAhB,EAA6B,eAAe8C,OAAOG,IAAtB,GAA6B,GAA7B,GAAmCH,OAAOC,GAA1C,GAAgD,GAA7E;;AAEA,QAAMa,QAAQ,KAAKrN,KAAL,CAAWO,MAAX,CAAkB8M,KAAlB,EAAd;;AAEA,QAAMC,mBAAmB;AACvBC,iBAAW,KAAKC,gBAAL,OAA4B,OAA5B,GAAsCjB,OAAOC,GAAP,GAAa,CAAnD,GAAuD,CAD3C;AAEvBiB,cAAQ,KAAKD,gBAAL,OAA4B,OAA5B,GAAuCH,QAAQ,MAAR,GAAiB,OAAxD,GAAmE,QAFpD;AAGvBK,cAAQ,KAAKF,gBAAL,OAA4B,OAA5B,GAAsC,KAAtC,GAA8C,QAH/B;AAIvBG,kBAAY,KAAKH,gBAAL,OAA4B,OAA5B,GAAsC,IAAI,CAA1C,GAA8C,IAAI;AAJvC,KAAzB;;AAOA;AACA,SAAKlG,IAAL,CACGsG,aADH,CACiBN,gBADjB,EAEGO,MAFH,CAEU,KAAKT,KAFf,EAEsB,KAAKF,MAF3B;;AAIA;AACA,SAAKnH,MAAL,CAAYuF,KAAZ,CAAkB,CAAC,KAAK4B,MAAN,EAAc,CAAd,CAAlB;AACA,SAAKvH,MAAL,CAAY2F,KAAZ,CAAkB,CAAC,KAAK5E,UAAN,EAAkB,KAAK0G,KAAL,GAAa,KAAK3G,UAAlB,GAA+B,KAAKC,UAAtD,CAAlB;;AAGA;AACA,QAAMoH,YAAY,KAAK5K,UAAL,GAAkB,KAAKlD,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBuF,SAA3C,GAAuD,KAAzE;;AAEA;AACA,SAAKtH,KAAL,CAAWuH,KAAX,CAAiB,KAAKpI,MAAtB,EACGqI,aADH,CACiB,CADjB,EAEGC,WAFH,CAEe,CAFf,EAGGC,aAHH,CAGiB,CAHjB,EAGoB,CAHpB,EAIGC,cAJH,CAIkB;AACdL,0BADc;AAEdM,kBAAY7B,MAFE;AAGd8B,qBAAe9B,OAAOI,MAAP,GAAgB,GAHjB;AAId2B,cAAQ,KAAK9H,KAAL,CAAW+H,gBAJL;AAKdC,aAAO,KAAKtL,UAAL,GAAkB,KAAKlD,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBK,SAAtC,GAAkD,CAAC,CAAD,CAL3C;AAMd2N,iBAAW,KAAKzO,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBmG,gBAAzB;AANG,KAJlB;;AAcA,SAAK1H,OAAL,CACGyC,IADH,CACQ,WADR,EACqB,iBAAiB,KAAKyD,MAAtB,GAA+B,GADpD,EAEGyB,IAFH,CAEQ,KAAKnI,KAFb;;AAIA,SAAKS,QAAL,CAAcH,MAAd,CAAqB,MAArB,EACG2C,IADH,CACQ,WADR,EACqB,eAAe,KAAK2D,KAApB,GAA4B,GAA5B,GAAkC,KAAKF,MAAvC,GAAgD,GADrE,EAEGzD,IAFH,CAEQ,IAFR,EAEc,SAFd;;AAIA,SAAKvC,QAAL,CACGwC,KADH,CACS,WADT,EACsBkD,eAAe,IADrC,EAEGnD,IAFH,CAEQ,WAFR,EAEqB,gBAAgB4D,QAAQ,KAAKD,KAAb,GAAqB,CAArC,IAA0C,GAA1C,GAAgDb,OAAOC,GAAvD,GAA6D,GAFlF;;AAKA,QAAMoC,SAAS,KAAKxH,aAAL,CAAmBN,MAAnB,CAA0B,MAA1B,EAAkC+H,IAAlC,GAAyCC,OAAzC,EAAf;AACA,SAAK1H,aAAL,CAAmBN,MAAnB,CAA0B,KAA1B,EACG2C,IADH,CACQ,OADR,EACiBmF,OAAO1B,MADxB,EAEGzD,IAFH,CAEQ,QAFR,EAEkBmF,OAAO1B,MAFzB,EAGGzD,IAHH,CAGQ,GAHR,EAGamF,OAAO1B,MAAP,GAAgB,GAH7B,EAIGzD,IAJH,CAIQ,GAJR,EAIa,CAACmF,OAAO1B,MAAR,GAAiB,GAAjB,GAAuB,CAJpC;;AAMA,SAAK9F,aAAL,CACGqC,IADH,CACQ,WADR,EACqB,gBAAgB4D,QAAQ,KAAKD,KAAL,GAAawB,OAAOxB,KAApB,GAA4BwB,OAAO1B,MAAP,GAAgB,CAApD,GAAwD,CAAxE,IAA6E,GAA7E,IAAoFX,OAAOC,GAAP,GAAaoC,OAAO1B,MAAP,GAAgB,GAAjH,IAAwH,GAD7I,EAEGpG,MAFH,CAEU,MAFV,EAGG2C,IAHH,CAGQ,IAHR,EAGcmF,OAAO1B,MAAP,GAAgB,GAH9B;;AAKA,QAAI,KAAK/F,MAAL,CAAYL,MAAZ,CAAmB,KAAnB,EAA0B+H,IAA1B,EAAJ,EAAsC;AACpC,UAAME,YAAY,KAAK7H,QAAL,CAAc2H,IAAd,GAAqBC,OAArB,EAAlB;AACA,UAAME,IAAIvN,MAAMwN,SAAN,CAAgB,KAAK/H,QAAL,CAAc2H,IAAd,EAAhB,CAAV;AACA,UAAMK,aAAa7B,QAAS0B,UAAUrJ,CAAV,GAAcsJ,EAAEG,UAAhB,GAA6BvC,eAAe,GAArD,GAA6DmC,UAAUrJ,CAAV,GAAcsJ,EAAEG,UAAhB,GAA6BJ,UAAU3B,KAAvC,GAA+CR,eAAe,GAA9I;;AAEA,WAAKzF,MAAL,CAAYL,MAAZ,CAAmB,KAAnB,EACG2C,IADH,CACQ,OADR,EACiBmD,eAAe,IADhC,EAEGnD,IAFH,CAEQ,QAFR,EAEkBmD,eAAe,IAFjC;AAGA,WAAKzF,MAAL,CAAYsC,IAAZ,CAAiB,WAAjB,EAA8B,eAC1ByF,UAD0B,GACb,GADa,IAEzBF,EAAEI,UAAF,GAAexC,eAAe,GAFL,IAEY,GAF1C;AAGD;;AAED,SAAKhF,WAAL,CACG6B,IADH,CACQ,GADR,EACa,KAAKyD,MADlB,EAEGzD,IAFH,CAEQ,OAFR,EAEiB,KAAK2D,KAFtB,EAGG3D,IAHH,CAGQ,QAHR,EAGkB8C,OAAOI,MAHzB;;AAKA,QAAI,CAACP,UAAL,EAAiBA,aAAa,KAAKpM,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBM,OAAjC;AACjB,SAAK4F,IAAL,GAAY,KAAK3B,KAAL,CAAWqK,YAAX,CAAwBjD,UAAxB,EAAoC0B,SAApC,EAA+C,KAAKnI,MAAL,CAAYmD,MAAZ,EAA/C,CAAZ;AACD,GAvcqE;AA0ctElE,cA1csE,0BA0cvD;AACb,QAAMjC,QAAQ,IAAd;AACA,QAAM2M,MAAM,KAAKtP,KAAL,CAAWmD,MAAX,CAAkBoF,MAA9B;;AAEA,QAAI+G,IAAIC,SAAJ,IAAiB,IAAjB,IAAyBD,IAAIvG,SAAJ,IAAiB,IAA1C,IAAkDuG,IAAIE,SAAJ,IAAiB,IAAjB,IAAyBF,IAAIvG,SAAJ,IAAiB,IAAhG,EAAsG;;AAEtG,QAAM0G,KAAK,KAAK9J,MAAL,CAAY2J,IAAIC,SAAJ,IAAiBD,IAAIvG,SAAjC,CAAX;AACA,QAAM2G,KAAK,KAAK/J,MAAL,CAAY2J,IAAIE,SAAJ,IAAiBF,IAAItG,SAAjC,CAAX;AACA;AACA,QAAI,CAAC2G,SAASF,EAAT,CAAD,IAAiB,CAACE,SAASD,EAAT,CAAlB,IAAkCD,OAAOC,EAA7C,EAAiD;;AAEjD,SAAKjJ,UAAL,GAAkB,KAAK2G,KAAL,IAAcsC,KAAKD,EAAnB,IAAyB,KAAKhJ,UAAhD;AACA,SAAKC,UAAL,GAAkB,CAAC,KAAKA,UAAL,GAAkB+I,EAAnB,KAA0BC,KAAKD,EAA/B,IAAqC,KAAKrC,KAA5D;;AAEA,SAAKzH,MAAL,CAAY2F,KAAZ,CAAkB,CAAC,KAAK5E,UAAN,EAAkB,KAAK0G,KAAL,GAAa,KAAK3G,UAAlB,GAA+B,KAAKC,UAAtD,CAAlB;;AAEA,SAAKM,OAAL,CAAa2H,IAAb,CAAkB,KAAKnI,KAAvB;AACD,GA3dqE;AA8dtE+E,iBA9dsE,6BA8dpD;AAChB,QAAM5I,QAAQ,IAAd;;AAEA,SAAKiN,UAAL,GAAkB,KAAK5P,KAAL,CAAWO,MAAX,CAAkBsP,YAAlB,EAAlB;AACA,QAAMC,gBAAgB,KAAK9P,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBwH,eAAzB,EAAtB;;AAGA,SAAK9I,QAAL,CAAcH,MAAd,CAAqB,MAArB,EACGkJ,IADH,CACQ,KAAKJ,UAAL,CAAgB,6CAAhB,CADR;;AAGA,SAAK1I,QAAL,CAAcJ,MAAd,CAAqB,MAArB,EACGkJ,IADH,CACQ,KAAKJ,UAAL,CAAgB,aAAhB,CADR;;AAGAnO,UAAMwO,OAAN,CAAc,KAAK7I,aAAnB,EAAkCvF,QAAlC,EAA4CiF,MAA5C,CAAmD,KAAnD,EAA0D2C,IAA1D,CAA+D,OAA/D,EAAwE,KAAxE,EAA+EA,IAA/E,CAAoF,QAApF,EAA8F,KAA9F;AACA,SAAKrC,aAAL,CAAmBoC,MAAnB,CAA0B,MAA1B,EACGwG,IADH,CACQ,KAAKJ,UAAL,CAAgB,mBAAhB,CADR;;AAGAnO,UAAMwO,OAAN,CAAc,KAAK9I,MAAnB,EAA2BpF,YAA3B,EAAyC+E,MAAzC,CAAgD,KAAhD,EAAuD2C,IAAvD,CAA4D,OAA5D,EAAqE,KAArE,EAA4EA,IAA5E,CAAiF,QAAjF,EAA2F,KAA3F;;AAEA;AACA,SAAKtC,MAAL,CAAY6C,EAAZ,CAAe,OAAf,EAAwB,YAAM;AAC5BrH,YAAMuN,MAAN,CAAaC,eAAb,CAA6B,qBAA7B,EAAoDC,GAApD;AACD,KAFD;AAGA,SAAKjJ,MAAL,CAAY6C,EAAZ,CAAe,WAAf,EAA4B,YAAW;AACrC,UAAMqG,OAAO,KAAKvB,OAAL,EAAb;AACA,UAAMwB,QAAQ7O,MAAM8O,mBAAN,CAA0B,IAA1B,EAAgC,KAAKC,uBAArC,EAA8DH,KAAK3K,CAAL,GAAS,EAAvE,EAA2E2K,KAAKpK,CAAL,GAASoK,KAAKnD,MAAd,GAAuB,EAAlG,CAAd;AACA,UAAMuD,WAAW9N,MAAM+N,IAAN,CAAWzM,OAAX,CAAmB0M,qBAAnB,EAAjB;AACA,UAAMC,YAAYjO,MAAMsB,OAAN,CAAc4K,IAAd,GAAqB8B,qBAArB,EAAlB;AACAhO,YAAMuN,MAAN,CAAaC,eAAb,CAA6B,qBAA7B,EAAoDU,OAApD,CAA4D,QAA5D,EAAsEC,IAAtE,GAA6EC,MAA7E,CAAoFT,MAAM5K,CAAN,GAAUkL,UAAUlE,IAApB,GAA2B+D,SAAS/D,IAAxH,EAA8H4D,MAAMrK,CAApI;AACD,KAND;AAOA,SAAKkB,MAAL,CAAY6C,EAAZ,CAAe,UAAf,EAA2B,YAAM;AAC/BrH,YAAMuN,MAAN,CAAaC,eAAb,CAA6B,qBAA7B,EAAoDa,IAApD;AACD,KAFD;;AAKA,SAAK5J,aAAL,CACG4C,EADH,CACM,OADN,EACe,YAAM;AACjBrH,YAAMuN,MAAN,CAAaC,eAAb,CAA6B,uBAA7B,EAAsDc,MAAtD;AACD,KAHH,EAIGjH,EAJH,CAIM,WAJN,EAImB,YAAM;AACrBrH,YAAM6B,kBAAN,CAAyB,CAAzB;AACD,KANH,EAOGwF,EAPH,CAOM,UAPN,EAOkB,YAAM;AACpBrH,YAAM6B,kBAAN;AACD,KATH;AAUD,GA3gBqE;AA6gBtEA,oBA7gBsE,8BA6gBnD0M,OA7gBmD,EA6gB1C;AAC1B,QAAIA,WAAW,IAAf,EAAqBA,UAAU,KAAK7F,MAAL,CAAY,CAAC,KAAK/K,IAAL,CAAU6Q,cAAV,GAA2BhF,QAA3B,EAAb,CAAV;AACrB,QAAI,KAAKiF,YAAT,EAAuBF,UAAU,CAAV;AACvB,SAAK9J,aAAL,CAAmBsC,KAAnB,CAAyB,SAAzB,EAAoCwH,OAApC;AACD,GAjhBqE;AAmhBtE1F,kBAnhBsE,8BAmhBnD;AACjB,QAAM7I,QAAQ,IAAd;;AAEA;AACA,SAAKoD,MAAL,GAAc,KAAK/F,KAAL,CAAWmD,MAAX,CAAkByI,MAAlB,CAAyByF,QAAzB,EAAd;AACA,SAAK1L,MAAL,GAAc,KAAK3F,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyB8I,QAAzB,EAAd;AACA,SAAK9K,MAAL,GAAc,KAAKvG,KAAL,CAAWmD,MAAX,CAAkBwI,KAAlB,CAAwB0F,QAAxB,EAAd;;AAEA,SAAK7K,KAAL,CAAW8K,UAAX,CAAsB3O,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBoF,MAAnB,CAA0BmG,gBAA1B,EAAtB;AACD,GA5hBqE;AA8hBtE5C,gBA9hBsE,4BA8hBjC;AAAA,QAAtBL,MAAsB,uEAAb,KAAKA,MAAQ;;AACnC,QAAM9I,QAAQ,IAAd;AACA,QAAMmI,WAAW,KAAKA,QAAtB;;AAEA;AACA,SAAKyG,gBAAL,GAAwB,KAAKvR,KAAL,CAAWmD,MAAX,CAAkBqO,OAAlB,GACrBC,MADqB,CACd;AAAA,aAAK,KACVhG,OAAOlD,MAAP,CAAc9G,MAAMiQ,MAAN,CAAa7L,CAAb,EAAgBiF,SAASvC,MAAzB,CAAd,CADU,IAEVkD,OAAOG,MAAP,CAAcnK,MAAMiQ,MAAN,CAAa7L,CAAb,EAAgBiF,SAASc,MAAzB,CAAd,CAFU,IAGVH,OAAOkG,MAAP,CAAclQ,MAAMiQ,MAAN,CAAa7L,CAAb,EAAgBiF,SAAS6G,MAAzB,CAAd,CAHK;AAAA,KADc,EAKrBvI,GALqB,CAKjB,aAAK;AACR,UAAMwI,UAAU,EAAhB;AACAA,cAAQC,KAAR,GAAgBhM,CAAhB;AACA+L,cAAQpH,IAAR,GAAe,YAAW;AACxB,eAAO,KAAKqH,KAAZ;AACD,OAFD;AAGAD,cAAQE,IAAR,GAAerQ,MAAMiQ,MAAN,CAAa7L,CAAb,EAAgBlD,MAAM6H,IAAtB,CAAf;AACAoH,cAAQhH,GAAR,GAAc,YAAW;AACvB,eAAO,KAAKkH,IAAZ;AACD,OAFD;AAGAF,cAAQG,SAAR,GAAoB,CAACtG,OAAOG,MAAP,CAAcnK,MAAMiQ,MAAN,CAAa7L,CAAb,EAAgBiF,SAASc,MAAzB,CAAd,KAAmD,CAApD,EAAuD,CAAvD,CAApB;AACAgG,cAAQI,SAAR,GAAoB,CAApB;AACA,aAAOJ,OAAP;AACD,KAlBqB,CAAxB;;AAqBA;AACA,SAAKK,eAAL,GAAuB1M,GAAG2M,IAAH,GACpB7L,GADoB,CAChB;AAAA,aAAK1D,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB+C,KAAnB,CAAyBiM,GAAzB,KAAiC,UAAjC,GAA8C1G,OAAOvF,KAAP,CAAazE,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAAS5E,KAAhC,CAAb,CAA9C,GAAqGuF,OAAO2G,KAAP,CAAa3Q,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASsH,KAAhC,CAAb,CAA1G;AAAA,KADgB,EAEpBC,UAFoB,CAET,UAACC,CAAD,EAAIC,CAAJ;AAAA,aAAUA,EAAER,SAAF,CAAY,CAAZ,IAAiBO,EAAEP,SAAF,CAAY,CAAZ,CAA3B;AAAA,KAFS,EAGpBS,OAHoB,CAGZ,KAAKjB,gBAHO,CAAvB;;AAMA,QAAMkB,kBAAkB,KAAKzS,KAAL,CAAWmD,MAAX,CAAkBiP,KAAlB,CAAwBM,aAAhD;AACA,QAAMC,sBAAsBlR,MAAMmR,OAAN,CAAcH,eAAd,KAAkCA,gBAAgB7J,MAAhB,GAAyB,CAAvF;AACA,SAAKqJ,eAAL,CAAqBY,OAArB,CAA6B,iBAAS;AACpC,UAAMC,iBAAiBH,sBACrBF,gBAAgBM,QAAhB,CAAyBX,MAAM/L,GAA/B,IACEoM,gBAAgB7J,MAAhB,GAAyB,CAAzB,GAA6B6J,gBAAgB9N,OAAhB,CAAwByN,MAAM/L,GAA9B,CAD/B,GAEE,CAAC,CAHkB,GAIrBd,GAAGyN,GAAH,CAAOZ,MAAM3G,MAAN,CAAarC,GAAb,CAAiB;AAAA,eAAKC,EAAE0I,SAAF,CAAY,CAAZ,CAAL;AAAA,OAAjB,CAAP,CAJF;;AAMAK,YAAM3G,MAAN,CAAaoH,OAAb,CAAqB,aAAK;AACxBhN,UAAEkM,SAAF,CAAY,CAAZ,IAAiBe,cAAjB;AACD,OAFD;;AAIAV,YAAMP,KAAN,uBAAiBlP,MAAMiI,GAAvB,EAA6BwH,MAAM/L,GAAnC,EAXoC,CAWM;AAC1C+L,YAAM5H,IAAN,GAAa,YAAW;AACtB,eAAO,KAAKqH,KAAZ;AACD,OAFD;AAGAO,YAAMxH,GAAN,GAAY,YAAW;AACrB,eAAO,KAAKvE,GAAZ;AACD,OAFD;AAGA+L,YAAMJ,SAAN,GAAkB,CAAlB;AACD,KAnBD;;AAqBA,QAAMiB,gBAAgB,EAAtB;AACAtQ,UAAMsP,eAAN,CAAsBY,OAAtB,CAA8B,aAAK;AACjCI,oBAAc5J,EAAEhD,GAAhB,IAAuBgD,EAAEoC,MAAF,CAAS,CAAT,EAAYsG,SAAZ,CAAsB,CAAtB,CAAvB;AACD,KAFD;;AAKA;AACA,QAAIpP,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB+C,KAAnB,CAAyBgN,KAAzB,KAAmC,MAAvC,EAA+C;AAC7C,WAAKC,eAAL,GAAuB,EAAvB;AACA,WAAK5B,gBAAL,CAAsB6B,IAAtB,CAA2B,UAACd,CAAD,EAAIC,CAAJ;AAAA,eAAUA,EAAER,SAAF,CAAY,CAAZ,IAAiBO,EAAEP,SAAF,CAAY,CAAZ,CAA3B;AAAA,OAA3B;AAED,KAJD,MAIO;AACL,WAAKoB,eAAL,GAAuB5N,GAAG2M,IAAH,GACpB7L,GADoB,CAChB;AAAA,eAAKoF,OAAOvF,KAAP,CAAazE,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAAS5E,KAAhC,CAAb,CAAL;AAAA,OADgB,EAEpBG,GAFoB,CAEhB;AAAA,eAAKoF,OAAO2G,KAAP,CAAa3Q,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASsH,KAAhC,CAAb,CAAL;AAAA,OAFgB,EAGpBiB,QAHoB,CAGX,UAACf,CAAD,EAAIC,CAAJ;AAAA,eAAUU,cAAcV,CAAd,IAAmBU,cAAcX,CAAd,CAA7B;AAAA,OAHW,EAIpBD,UAJoB,CAIT,UAACC,CAAD,EAAIC,CAAJ;AAAA,eAAUA,EAAER,SAAF,CAAY,CAAZ,IAAiBO,EAAEP,SAAF,CAAY,CAAZ,CAA3B;AAAA,OAJS,EAKpBS,OALoB,CAKZ,KAAKjB,gBALO,CAAvB;;AAOA,WAAKA,gBAAL,CAAsB6B,IAAtB,CAA2B,UAACd,CAAD,EAAIC,CAAJ;AAAA,eAAUA,EAAER,SAAF,CAAY,CAAZ,IAAiBO,EAAEP,SAAF,CAAY,CAAZ,CAA3B;AAAA,OAA3B;;AAGA,WAAKoB,eAAL,CAAqBN,OAArB,CAA6B,iBAAS;AACpC3M,cAAM2L,KAAN,uBAAiBlP,MAAMiI,GAAvB,EAA6B1E,MAAMG,GAAnC,EADoC,CACM;AAC1CH,cAAMsE,IAAN,GAAa,YAAW;AACtB,iBAAO,KAAKqH,KAAZ;AACD,SAFD;AAGA3L,cAAM0E,GAAN,GAAY,YAAW;AACrB,iBAAO,KAAKvE,GAAZ;AACD,SAFD;AAGEH,cAAM8L,SAAN,GAAkB,CAAlB;AACH,OATD;AAUD;;AAED;AACA,SAAKsB,qBAAL,GAA6B,KAAK7L,uBAAL,CAA6BO,SAA7B,CAAuC,oCAAvC,EAC1BsB,IAD0B,CACrB,KAAK6J,eADgB,CAA7B;AAEA,SAAKI,qBAAL,GAA6B,KAAK9L,uBAAL,CAA6BO,SAA7B,CAAuC,oCAAvC,EAC1BsB,IAD0B,CACrB,KAAK2I,eADgB,CAA7B;AAEA,SAAKuB,eAAL,GAAuB,KAAK/L,uBAAL,CAA6BO,SAA7B,CAAuC,oCAAvC,EACpBsB,IADoB,CACf,KAAKiI,gBADU,CAAvB;;AAGA;AACA,SAAK+B,qBAAL,CAA2BG,IAA3B,GAAkCvI,MAAlC;AACA,SAAKqI,qBAAL,CAA2BE,IAA3B,GAAkCvI,MAAlC;AACA,SAAKsI,eAAL,CAAqBC,IAArB,GAA4BvI,MAA5B;;AAEA;AACA,SAAKoI,qBAAL,GAA6B,KAAKA,qBAAL,CAA2B/J,KAA3B,GAAmCC,MAAnC,CAA0C,MAA1C,EAC1BC,IAD0B,CACrB,OADqB,EACZ,mCADY,EAE1BiK,KAF0B,CAEpB,KAAKJ,qBAFe,CAA7B;AAGA,SAAKC,qBAAL,GAA6B,KAAKA,qBAAL,CAA2BhK,KAA3B,GAAmCC,MAAnC,CAA0C,MAA1C,EAC1BC,IAD0B,CACrB,OADqB,EACZ,mCADY,EAE1BiK,KAF0B,CAEpB,KAAKH,qBAFe,CAA7B;AAGA,SAAKC,eAAL,GAAuB,KAAKA,eAAL,CAAqBjK,KAArB,GAA6BC,MAA7B,CAAoC,MAApC,EACpBC,IADoB,CACf,OADe,EACN,mCADM,EAEpBiK,KAFoB,CAEd,KAAKF,eAFS,CAAvB;;AAIA;AACA,SAAKG,SAAL,GAAiB,KAAKlM,uBAAL,CAA6BO,SAA7B,CAAuC,kBAAvC,CAAjB;;AAEA,SAAK2L,SAAL,CACG3J,EADH,CACM,WADN,EACmB,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACzB,UAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BjR,YAAMwF,SAAN,GAAkB0L,UAAlB,CAA6BhO,CAA7B,EAAgCqC,CAAhC;AACD,KAJH,EAKG8B,EALH,CAKM,UALN,EAKkB,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACxB,UAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BjR,YAAMwF,SAAN,GAAkBC,SAAlB,CAA4BvC,CAA5B,EAA+BqC,CAA/B;AACD,KARH,EASG8B,EATH,CASM,OATN,EASe,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACrB,UAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BjR,YAAMwF,SAAN,GAAkB2L,MAAlB,CAAyBjO,CAAzB,EAA4BqC,CAA5B;AACAvF,YAAMwB,gBAAN;AACD,KAbH,EAcG8D,KAdH,CAcS,UAACpC,CAAD,EAAIqC,CAAJ,EAAU;AACfvF,YAAMwF,SAAN,GAAkB2L,MAAlB,CAAyBjO,CAAzB,EAA4BqC,CAA5B;AACA3C,SAAGwO,KAAH,CAASC,eAAT;AACD,KAjBH,EAkBGC,SAlBH,CAkBa,UAACpO,CAAD,EAAIqC,CAAJ,EAAU,CACpB,CAnBH;AAoBD,GAvqBqE;AAyqBtEgM,eAzqBsE,yBAyqBxDzI,MAzqBwD,EAyqBhDT,UAzqBgD,EAyqBpCnF,CAzqBoC,EAyqBjC;AACnC,WAAO,KAAK2E,IAAL,CAAUpB,GAAV,CAAc;AAAA,aAAOqC,OAAOT,WAAW3E,GAAX,CAAP,IAA0BoF,OAAOT,WAAW3E,GAAX,CAAP,EAAwBR,EAAEQ,GAAF,CAAxB,CAA1B,GAA4DR,EAAEQ,GAAF,CAAnE;AAAA,KAAd,EAAyFwE,IAAzF,CAA8F,IAA9F,CAAP;AACD,GA3qBqE;AA6qBtE1C,WA7qBsE,uBA6qB1D;AACV,QAAMxF,QAAQ,IAAd;;AAEA,WAAO;AACLkR,gBADK,sBACMhO,CADN,EACSqC,CADT,EACY;AACf,YAAIvF,MAAM3C,KAAN,CAAYM,IAAZ,CAAiB2J,QAAjB,IAA6BtH,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBkD,OAAlD,EAA2D;;AAE3Db,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmBgR,eAAnB,CAAmCtO,EAAE2E,IAAF,EAAnC;;AAEA,YAAMJ,QAAQ7E,GAAG6E,KAAH,CAASzH,MAAMoE,KAAN,CAAY8H,IAAZ,EAAT,EAA6BzF,GAA7B,CAAiC;AAAA,iBAAK+D,SAAStH,CAAT,CAAL;AAAA,SAAjC,CAAd;;AAEA;AACAlD,cAAMyR,WAAN,CAAkBvO,EAAEQ,GAAF,GAAQ1D,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwI,KAAnB,CAAyB0I,oBAAzB,GAAgDC,KAAhD,CAAsDC,QAAtD,GAAiE1O,EAAEQ,GAAnE,CAAR,GAAkF1D,MAAMuR,aAAN,CAAoBvR,MAAM8I,MAA1B,EAAkC9I,MAAMqI,UAAxC,EAAoDnF,EAAE2E,IAAF,EAApD,CAApG;AACA7H,cAAM2B,WAAN,CAAkBkQ,cAAlB,CAAiC3O,CAAjC,EAAoC,IAApC;AAED,OAZI;AAaLuC,eAbK,qBAaKvC,CAbL,EAaQqC,CAbR,EAaW;AACd,YAAIvF,MAAM3C,KAAN,CAAYM,IAAZ,CAAiB2J,QAAjB,IAA6BtH,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBkD,OAAlD,EAA2D;;AAE3Db,cAAMyR,WAAN,CAAkB,EAAlB;AACAzR,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmBsR,gBAAnB;AACA9R,cAAM2B,WAAN,CAAkBkQ,cAAlB,CAAiC3O,CAAjC,EAAoC,KAApC;AAED,OApBI;AAqBLiO,YArBK,kBAqBEjO,CArBF,EAqBK;AACR,YAAM6O,sBAAsB/R,MAAM3C,KAAN,CAAYM,IAAZ,CAAiB2J,QAAjB,IAA6BtH,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBkD,OAA1E;AACA,YAAI,CAACkR,mBAAD,IAAwB/R,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B9O,EAAE2E,IAAF,EAA9B,CAA5B,EAAqE;AACnE7H,gBAAM3C,KAAN,CAAYmD,MAAZ,CAAmByR,YAAnB,CAAgC/O,EAAE2E,IAAF,EAAhC;AACD;AACF;AA1BI,KAAP;AA6BD,GA7sBqE;AA+sBtErG,kBA/sBsE,8BA+sBnD;AACjB,QAAMxB,QAAQ,IAAd;AACA,SAAKkS,eAAL,GAAwB,KAAK7U,KAAL,CAAWmD,MAAX,CAAkB2R,SAAlB,CAA4BlM,MAA5B,GAAqC,CAA7D;;AAEA,QAAI,CAAC,KAAKmM,UAAN,IAAoB,CAAC,KAAK3D,YAA9B,EAA4C;AAC5C,SAAK2D,UAAL,CAAgBC,OAAhB,CAAwB,eAAxB,EAAyC;AAAA,aAAKrS,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB8R,aAAnB,CAAiCpP,CAAjC,CAAL;AAAA,KAAzC;AAED,GAttBqE;AAwtBtExB,eAxtBsE,2BAwtBtD;AACd,QAAM1B,QAAQ,IAAd;AACA,SAAKyO,YAAL,GAAqB,KAAKpR,KAAL,CAAWmD,MAAX,CAAkB2D,MAAlB,CAAyB8B,MAAzB,GAAkC,CAAvD;;AAEA,SAAKtE,WAAL,CAAiB4Q,OAAjB;AACA,SAAKC,sBAAL,GAA8B,KAA9B;AACD,GA9tBqE;AAguBtEC,0BAhuBsE,oCAguB7CC,MAhuB6C,EAguBrClS,MAhuBqC,EAguB7B;AACvC,QAAMR,QAAQ,IAAd;AACA,QAAI,CAAC0S,OAAOhP,GAAZ,EAAiB,OAAO1D,MAAM8I,MAAN,CAAatI,MAAb,EAAqB1B,MAAMiQ,MAAN,CAAa2D,OAAO7K,IAAP,EAAb,EAA4B7H,MAAMmI,QAAN,CAAe3H,MAAf,CAA5B,CAArB,CAAP;AACjB,WAAOoC,GAAGyN,GAAH,CAAOqC,OAAO5J,MAAP,CAAcrC,GAAd,CAAkB;AAAA,aAAKzG,MAAMyS,wBAAN,CAA+B/L,CAA/B,EAAkClG,MAAlC,CAAL;AAAA,KAAlB,CAAP,CAAP;AACD,GApuBqE;AAsuBtEiB,eAtuBsE,2BAsuBtD;AACd,QAAMzB,QAAQ,IAAd;AACA;;AAEA,QAAM2S,iBAAiB,GAAvB;AACA,QAAMC,qBAAqB,GAA3B;AACA,QAAMC,iBAAiB,GAAvB;AACA,QAAMC,kBAAkB,KAAKzV,KAAL,CAAWmD,MAAX,CAAkBuS,cAA1C;AACA,QAAMC,qBAAqB,KAAK3V,KAAL,CAAWmD,MAAX,CAAkByS,gBAA7C;;AAEA,SAAKjC,SAAL,CAAejK,KAAf,CAAqB,SAArB,EAAgC,aAAK;;AAEnC,UAAI/G,MAAMkS,eAAV,EAA2B;AACzB;AACA,YAAIlS,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB8R,aAAnB,CAAiCpP,EAAE2E,IAAF,EAAjC,CAAJ,EAAgD,OAAO8K,cAAP;AACjD;;AAED,UAAI3S,MAAMyO,YAAV,EAAwB;AACtB;AACA,eAAOzO,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B9O,EAAE2E,IAAF,EAA9B,IAA0CgL,cAA1C,GAA2DG,kBAAlE;AACD;;AAED,UAAIhT,MAAMkS,eAAV,EAA2B,OAAOU,kBAAP;;AAE3B,aAAOE,eAAP;AAED,KAhBD;;AAkBA,SAAK9B,SAAL,CAAeqB,OAAf,CAAuB,cAAvB,EAAuC;AAAA,aAAKrS,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B9O,EAAE2E,IAAF,EAA9B,CAAL;AAAA,KAAvC;;AAEA,QAAM2K,yBAAyBxS,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmByS,gBAAnB,GAAsC,IAArE;;AAEA;AACA,QAAIT,2BAA2B,KAAKA,sBAApC,EAA4D;AAC1D,WAAK3B,eAAL,CAAqB9J,KAArB,CAA2B,gBAA3B,EAA6C;AAAA,eAAM,CAAC/G,MAAMyO,YAAP,IAAuB,CAAC+D,sBAAxB,IAAkDxS,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B9O,EAAE2E,IAAF,EAA9B,CAAnD,GAChD,SADgD,GACpC,MAD+B;AAAA,OAA7C;AAED;;AAED,SAAK2K,sBAAL,GAA8BxS,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmByS,gBAAnB,GAAsC,IAApE;AACD,GA7wBqE;AA+wBtE3J,YA/wBsE,wBA+wBzD;AACX,QAAMtJ,QAAQ,IAAd;;AAEA,SAAKkT,MAAL,GAAc,KAAKvV,IAAL,IAAa,IAAb,GAAoB,KAAKN,KAAL,CAAWM,IAAX,CAAgB+C,KAApC,GAA4C,KAAK/C,IAA/D;AACA,SAAKA,IAAL,GAAY,KAAKN,KAAL,CAAWM,IAAX,CAAgB+C,KAA5B;AACA,SAAKuG,QAAL,GAAgB,KAAK5J,KAAL,CAAWM,IAAX,CAAgBkD,OAAhB,IAA4B,KAAKlD,IAAL,GAAY,KAAKuV,MAAjB,GAA0B,CAAtD,GAA2D,KAAK7V,KAAL,CAAWM,IAAX,CAAgBwV,eAA3E,GAA6F,CAA7G;AACA,SAAKxO,IAAL,CAAU6D,OAAV,CAAkB,KAAKnL,KAAL,CAAWM,IAAX,CAAgB8K,UAAhB,CAA2B,KAAK9K,IAAhC,CAAlB,EAAyD,KAAKsJ,QAA9D;AACD,GAtxBqE;AAwxBtE/E,gBAxxBsE,4BAwxBrD;AACf,QAAMlC,QAAQ,IAAd;AACA,SAAKiE,IAAL,GAAY,CAAZ;;AAGA;AACA,SAAK2K,gBAAL,CAAsBsB,OAAtB,CAA8B,UAAChN,CAAD,EAAIqC,CAAJ,EAAU;AACtC,UAAM6N,WAAWpT,MAAMqT,MAAN,CAAarT,MAAM8I,MAAnB,EAA2B9I,MAAMmI,QAAjC,EAA2CjF,CAA3C,CAAjB;AACAlD,YAAM2D,MAAN,CAAaT,EAAE+E,GAAF,EAAb,IAAwBmL,QAAxB;AACAlQ,QAAEoQ,MAAF,GAAWF,SAASnN,MAAT,KAAoB,CAA/B;AACD,KAJD;;AAOA;AACA,QAAIjG,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB+C,KAAnB,CAAyBgN,KAAzB,KAAmC,MAAvC,EAA+C;AAC7C,WAAKC,eAAL,CAAqBN,OAArB,CAA6B,iBAAS;AACpC,YAAIqD,UAAU,EAAd;AACA9D,cAAM3G,MAAN,CAAaoH,OAAb,CAAqB,oBAAY;AAC/BqD,oBAAUA,QAAQC,MAAR,CAAeC,SAAS3K,MAAT,CAAgBgG,MAAhB,CAAuB;AAAA,mBAAK,CAAC4E,EAAEJ,MAAR;AAAA,WAAvB,CAAf,CAAV;AACD,SAFD;AAGAtT,cAAMuD,KAAN,CAAYoQ,IAAZ,CAAiBJ,QAAQ9M,GAAR,CAAY;AAAA,iBAAKvD,EAAE+E,GAAF,EAAL;AAAA,SAAZ,CAAjB,EAA4CrF,GAAG+F,KAAH,CAAS3I,MAAMgE,IAAN,CAAWiC,MAApB,CAA5C,EACGiK,OADH,CACW,UAACkD,QAAD,EAAWQ,QAAX,EAAwB;AAC/B,cAAMlQ,MAAM6P,QAAQK,QAAR,EAAkB3L,GAAlB,EAAZ;AACAmL,mBAASlD,OAAT,CAAiB,UAAChN,CAAD,EAAI2Q,aAAJ,EAAsB;AACrC7T,kBAAM2D,MAAN,CAAaD,GAAb,EAAkBmQ,aAAlB,EAAiC1Q,EAAjC,GAAsCD,EAAE,CAAF,CAAtC;AACD,WAFD;AAGD,SANH;AAOD,OAZD;AAaD;;AAED,SAAK0L,gBAAL,CAAsBsB,OAAtB,CAA8B,aAAK;AACjChN,QAAE4Q,aAAF,GAAkB9T,MAAM8I,MAAxB;AACA5F,QAAEe,IAAF,GAASrB,GAAGmR,GAAH,CAAO/T,MAAM2D,MAAN,CAAaT,EAAE+E,GAAF,EAAb,EAAsBxB,GAAtB,CAA0B;AAAA,eAAKC,EAAEvD,EAAF,GAAOuD,EAAEpD,CAAd;AAAA,OAA1B,CAAP,CAAT;AACA,UAAItD,MAAMiE,IAAN,GAAaf,EAAEe,IAAnB,EAAyBjE,MAAMiE,IAAN,GAAaf,EAAEe,IAAf;AAC1B,KAJD;;AAMA,QAAM+P,eAAehU,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBiP,KAAnB,CAAyBsB,KAA9C;AACA,QAAMkD,eAAejU,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB+C,KAAnB,CAAyBwN,KAA9C;AACA;;AAEA;AACA,SAAKP,eAAL,CAAqBN,OAArB,CAA6B,aAAK;AAChChN,QAAE4Q,aAAF,GAAkB9T,MAAM+I,gBAAxB;AACA,UAAMmL,YAAYlU,MAAMmU,4BAAN,CAAmCjR,CAAnC,CAAlB;AACAlD,YAAM2D,MAAN,CAAaT,EAAEQ,GAAf,IAAsB1D,MAAMoU,0BAAN,CAAiCF,SAAjC,CAAtB;AACAlU,YAAM+I,gBAAN,CAAuBC,KAAvB,CAA6B9F,EAAEQ,GAA/B,IAAsC,UAAtC;AACA1D,YAAM+I,gBAAN,CAAuBE,MAAvB,CAA8B/F,EAAEQ,GAAhC,IAAuC1D,MAAMyS,wBAAN,CAA+BvP,CAA/B,EAAkC,QAAlC,CAAvC;AACAA,QAAEe,IAAF,GAASiQ,UAAUG,KAAV,CAAgBpQ,IAAzB;AACD,KAPD;AAQA;AACA,SAAKqL,eAAL,CAAqBY,OAArB,CAA6B,aAAK;AAChChN,QAAE4Q,aAAF,GAAkB9T,MAAM+I,gBAAxB;AACA,UAAMmL,YAAYlU,MAAMmU,4BAAN,CAAmCjR,CAAnC,CAAlB;AACAlD,YAAM2D,MAAN,CAAaT,EAAEQ,GAAf,IAAsB1D,MAAMoU,0BAAN,CAAiCF,SAAjC,CAAtB;AACAlU,YAAM+I,gBAAN,CAAuBC,KAAvB,CAA6B9F,EAAEQ,GAA/B,IAAsC1D,MAAM8I,MAAN,CAAaE,KAAb,CAAmBkL,UAAUG,KAAV,CAAgBpM,GAAhB,EAAnB,CAAtC;AACAjI,YAAM+I,gBAAN,CAAuBE,MAAvB,CAA8B/F,EAAEQ,GAAhC,IAAuC1D,MAAMyS,wBAAN,CAA+BvP,CAA/B,EAAkC,QAAlC,CAAvC;AACAA,QAAEe,IAAF,GAASiQ,UAAUG,KAAV,CAAgBpQ,IAAzB;AACD,KAPD;AAQA;;AAEA,QAAI,CAACgQ,YAAD,IAAiB,CAACD,YAAlB,IAAkC,KAAK3W,KAAL,CAAWmD,MAAX,CAAkB+C,KAAlB,CAAwBiM,GAAxB,KAAgC,UAAtE,EAAkF;AAChF,WAAKF,eAAL,CAAqBY,OAArB,CAA6B,aAAK;AAChC,YAAMoE,UAAUpR,EAAE4F,MAAF,CAASgG,MAAT,CAAgB;AAAA,iBAAK,CAAC4E,EAAEJ,MAAR;AAAA,SAAhB,CAAhB;AACApQ,UAAEe,IAAF,GAASqQ,QAAQ,CAAR,EAAWrQ,IAApB;AACAf,UAAE4F,MAAF,CAASoH,OAAT,CAAiB,aAAK;AACpBqE,YAAEC,SAAF,GAActR,EAAEe,IAAhB;AACD,SAFD;AAGD,OAND;AAOD;AAGF,GA/1BqE;AAi2BtEkQ,8BAj2BsE,wCAi2BzC1E,KAj2ByC,EAi2BlC;AAClC,QAAI6E,gBAAJ;AAAA,QAAaG,iBAAb;AACA,QAAIJ,cAAJ;AAAA,QAAWK,aAAX;;AAEA,QAAIjF,MAAM3G,MAAN,CAAa,CAAb,EAAgBA,MAApB,EAA4B;AAC1BwL,gBAAU7E,MAAM3G,MAAN,CAAa,CAAb,EAAgBA,MAAhB,CAAuBgG,MAAvB,CAA8B;AAAA,eAAK,CAAC4E,EAAEJ,MAAR;AAAA,OAA9B,CAAV;AACAmB,iBAAWhF,MAAM3G,MAAN,CAAa2G,MAAM3G,MAAN,CAAa7C,MAAb,GAAsB,CAAnC,EAAsC6C,MAAtC,CAA6CgG,MAA7C,CAAoD;AAAA,eAAK,CAAC4E,EAAEJ,MAAR;AAAA,OAApD,CAAX;AACAe,cAAQC,QAAQ,CAAR,CAAR;AACAI,aAAOD,SAASA,SAASxO,MAAT,GAAkB,CAA3B,CAAP;AACD,KALD,MAKO;AACLqO,gBAAU7E,MAAM3G,MAAN,CAAagG,MAAb,CAAoB;AAAA,eAAK,CAAC4E,EAAEJ,MAAR;AAAA,OAApB,CAAV;AACAe,cAAQC,QAAQ,CAAR,CAAR;AACAI,aAAOJ,QAAQA,QAAQrO,MAAR,GAAiB,CAAzB,CAAP;AACD;;AAED,QAAI,CAACqO,QAAQrO,MAAT,IAAoBwO,YAAY,CAACA,SAASxO,MAA9C,EAAuDnH,MAAMK,IAAN,CAAW,mEAAX;;AAEvD,WAAO;AACLkV,kBADK;AAELK;AAFK,KAAP;AAID,GAt3BqE;AAw3BtEN,4BAx3BsE,sCAw3B3CO,GAx3B2C,EAw3BtC;AAC9B,QAAM3U,QAAQ,IAAd;;AAEA,QAAMqU,QAAQM,IAAIN,KAAJ,CAAUpM,GAAV,EAAd;AACA,QAAMyM,OAAOC,IAAID,IAAJ,CAASzM,GAAT,EAAb;;AAEA,WAAOjI,MAAMgE,IAAN,CAAWyC,GAAX,CAAe,UAACC,CAAD,EAAInB,CAAJ,EAAU;AAC9B,UAAMjC,IAAItD,MAAM2D,MAAN,CAAa0Q,KAAb,EAAoB9O,CAApB,EAAuBpC,EAAvB,GAA4BnD,MAAM2D,MAAN,CAAa0Q,KAAb,EAAoB9O,CAApB,EAAuBjC,CAAnD,GAAuDtD,MAAM2D,MAAN,CAAa+Q,IAAb,EAAmBnP,CAAnB,EAAsBpC,EAAvF;AACA,UAAMA,KAAKnD,MAAM2D,MAAN,CAAa+Q,IAAb,EAAmBnP,CAAnB,EAAsBpC,EAAjC;AACA,aAAO;AACLJ,WAAG2D,CADE;AAELvD,cAFK;AAGLG;AAHK,OAAP;AAKD,KARM,CAAP;AASD,GAv4BqE;AAy4BtE+F,aAz4BsE,yBAy4BxD;AACZ,QAAMrJ,QAAQ,IAAd;;AAEA,QAAM4U,WAAW,KAAKvS,KAAL,CAAWwS,OAAX,CAAmB,KAAKxX,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBgP,QAA5C,CAAjB;AACA,QAAME,WAAW,KAAKzS,KAAL,CAAWwS,OAAX,CAAmB,KAAKxX,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBkP,QAA5C,CAAjB;AACA,QAAMC,WAAW,KAAK1X,KAAL,CAAWmD,MAAX,CAAkBoF,MAAlB,CAAyBmP,QAA1C;AACA,QAAMC,IAAI,IAAIzO,KAAK0O,EAAT,IAAe1O,KAAK2O,GAAL,CAASN,QAAT,IAAqBrO,KAAK2O,GAAL,CAASJ,QAAT,CAApC,CAAV;AACA,QAAMpO,IAAIH,KAAK0O,EAAL,GAAU1O,KAAK2O,GAAL,CAASN,QAAT,IAAqBI,CAAzC;;AAGA,SAAKG,SAAL,GAAiB,EAAjB;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,UAAL,GAAkB,CAAlB;;AAEA,SAAKrR,IAAL,CAAUkM,OAAV,CAAkB,UAACoF,EAAD,EAAK/P,CAAL,EAAW;AAC3BvF,YAAMmV,SAAN,CAAgB5P,CAAhB,IAAqB+P,KAAKR,QAAL,GAAgB,CAAhB,GAAqBQ,KAAKP,WAAW,CAAhB,GAAoB,CAApB,GAAwBxO,KAAKgP,GAAL,CAAS,CAACT,WAAWQ,EAAZ,IAAkBP,QAA3B,CAAlE;AACA/U,YAAMoV,WAAN,CAAkB7P,CAAlB,IAAwB+P,KAAKR,QAAL,IAAiBQ,KAAKV,QAAtB,GAAkC,IAAIrO,KAAKiP,GAAL,CAASjP,KAAK2O,GAAL,CAASI,EAAT,IAAeN,CAAf,GAAmBtO,CAA5B,CAAtC,GAAwE,CAAhG;AACA1G,YAAMqV,UAAN,IAAoBrV,MAAMoV,WAAN,CAAkB7P,CAAlB,CAApB;AACD,KAJD;AAKD,GA55BqE;AA85BtE8N,QA95BsE,kBA85B/DvK,MA95B+D,EA85BvDX,QA95BuD,EA85B7CjF,CA95B6C,EA85B1C;AAC1B,QAAMlD,QAAQ,IAAd;;AAEA,QAAMyV,OAAO3M,OAAOG,MAAP,CAAcnK,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASc,MAAhC,CAAd,CAAb;AACA,QAAMyM,QAAQ1V,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBO,WAArB,GACZyK,OAAOkG,MAAP,CAAclQ,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAAS6G,MAAhC,CAAd,CADY,GAEZhP,MAAMqC,KAAN,CAAYsT,WAAZ,CAAwB7M,OAAOkG,MAAP,CAAclQ,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAAS6G,MAAhC,CAAd,CAAxB,CAFF;;AAIA,QAAM4G,KAAK5V,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBQ,QAArB,GACTwK,OAAOlD,MAAP,CAAc9G,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASvC,MAAhC,CAAd,CADS,GAET5F,MAAMqC,KAAN,CAAYwT,OAAZ,CAAoB/M,OAAOlD,MAAP,CAAc9G,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASvC,MAAhC,CAAd,CAApB,EAA4E8P,KAA5E,CAFF;;AAIA,QAAI,CAACD,IAAD,IAAS,CAACG,EAAV,IAAgB,CAACF,KAArB,EAA4B,OAAO,EAAP;;AAE5B,QAAMI,eAAe,EAArB;AACA,QAAIC,MAAM,CAAV;;AAEA,SAAK/R,IAAL,CAAUkM,OAAV,CAAkB,UAACoF,EAAD,EAAK/P,CAAL,EAAW;AAC3BuQ,mBAAavQ,CAAb,IAAkBvF,MAAMqC,KAAN,CAAY2T,GAAZ,CAAgBC,SAAhB,CAA0BX,EAA1B,EAA8BM,EAA9B,EAAkCF,KAAlC,CAAlB;AACAK,aAAO/V,MAAMmV,SAAN,CAAgB5P,CAAhB,IAAqBuQ,aAAavQ,CAAb,CAA5B;AACD,KAHD;;AAKA,QAAM2Q,SAAS,KAAKlS,IAAL,CAAUyC,GAAV,CAAc,UAAC6O,EAAD,EAAK/P,CAAL;AAAA,aAAY;AACvCxC,WAAGuS,EADoC;AAEvCnS,YAAI,CAFmC;AAGvCG,WAAGmS,QAAQK,aAAavQ,CAAb,KAAmB,IAAIvF,MAAMmV,SAAN,CAAgB5P,CAAhB,CAAvB,IAA6CvF,MAAMoV,WAAN,CAAkB7P,CAAlB,IAAuBvF,MAAMqV,UAA7B,GAA0CU,GAA/F;AAHoC,OAAZ;AAAA,KAAd,CAAf;;AAMA,WAAOG,MAAP;AACD,GA37BqE;AA67BtEjV,aA77BsE,uBA67B1DkV,OA77B0D,EA67BjD;AACnB,QAAI,CAACA,OAAL,EAAcA,UAAU,EAAV;AACd,QAAMnW,QAAQ,IAAd;AACA,QAAM2L,SAAS,KAAKtO,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBE,UAAnC;;AAEA,QAAI2N,WAAW,WAAX,IAA0B,CAACwK,QAAQjV,KAAvC,EAA8C;AAC9C,QAAIyK,WAAW,QAAf,EAAyB;AACvB,UAAMyK,aAAapW,MAAM8I,MAAzB;AACA9I,YAAM3C,KAAN,CAAYmD,MAAZ,CAAmBC,QAAnB,CAA4BT,MAAM3C,KAAN,CAAYM,IAAZ,CAAiBuL,GAA7C,EAAkD,kBAAU;AAC1D,YAAI,CAACJ,MAAL,EAAa;;AAEb;AACA9I,cAAM8I,MAAN,GAAeA,MAAf;AACA9I,cAAMkC,cAAN;;AAEA;AACAlC,cAAM8I,MAAN,GAAesN,UAAf;AACApW,cAAMoD,MAAN,CAAa+C,MAAb,CAAoB,CAAC,CAAD,EAAII,KAAKC,KAAL,CAAWxG,MAAMiE,IAAjB,CAAJ,CAApB;AACAjE,cAAMkC,cAAN;AACAlC,cAAMc,gBAAN;AACD,OAZD;AAaD,KAfD,MAeO;AACL,UAAI,CAACd,MAAMiE,IAAX,EAAiBnF,MAAMK,IAAN,CAAW,qBAAqBa,MAAMiE,IAA3B,GAAkC,wBAA7C;AACjBjE,YAAMoD,MAAN,CAAa+C,MAAb,CAAoB,CAAC,CAAD,EAAII,KAAKC,KAAL,CAAWxG,MAAMiE,IAAjB,CAAJ,CAApB;AACD;AACF,GAt9BqE;AAw9BtEnD,kBAx9BsE,8BAw9BnD;AACjB,QAAMd,QAAQ,IAAd;AACA,QAAMgU,eAAe,KAAK3W,KAAL,CAAWmD,MAAX,CAAkBiP,KAAlB,CAAwBsB,KAA7C;AACA,QAAMkD,eAAe,KAAK5W,KAAL,CAAWmD,MAAX,CAAkB+C,KAAlB,CAAwBwN,KAA7C;AACA,QAAMsF,YAAY,KAAKhZ,KAAL,CAAWmD,MAAX,CAAkB+C,KAAlB,CAAwBgN,KAA1C;AACA;AACA;AACA,QAAM+F,aAAa,CAAC,KAAKjZ,KAAL,CAAWM,IAAX,CAAgB2J,QAAhB,IAA4B,KAAKjK,KAAL,CAAWM,IAAX,CAAgBkD,OAA7C;AACjB;AACGwV,kBAAc,MAFnB;;AAIA,SAAKpV,WAAL;;AAEA,SAAK0P,qBAAL,CAA2B4F,IAA3B,CAAgC,UAASrT,CAAT,EAAY;AAC1C,UAAMsT,OAAO5T,GAAGuB,MAAH,CAAU,IAAV,CAAb;AACA,UAAMmP,SAAS,CAACW,YAAhB;AACAjU,YAAMyW,YAAN,CAAmBD,IAAnB,EAAyBtT,EAAE+E,GAAF,EAAzB,EAAkCqL,MAAlC;AACD,KAJD;;AAMA,SAAK1C,qBAAL,CAA2B2F,IAA3B,CAAgC,UAASrT,CAAT,EAAY;AAC1C,UAAMsT,OAAO5T,GAAGuB,MAAH,CAAU,IAAV,CAAb;AACA,UAAMmP,SAAU,CAACU,YAAD,IAAiB,CAACsC,UAAnB,IAAmCrC,gBAAgB,CAACjU,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B9O,CAA9B,CAAnE;AACAlD,YAAMyW,YAAN,CAAmBD,IAAnB,EAAyBtT,EAAE+E,GAAF,EAAzB,EAAkCqL,MAAlC;AACD,KAJD;;AAMA,SAAKzC,eAAL,CAAqB0F,IAArB,CAA0B,UAASrT,CAAT,EAAYqC,CAAZ,EAAe;AACvC,UAAMiR,OAAO5T,GAAGuB,MAAH,CAAU,IAAV,CAAb;AACA,UAAMmP,SAASpQ,EAAEoQ,MAAF,IAAa,CAACU,gBAAgBC,YAAhB,IAAgCqC,UAAjC,KAAgD,CAACtW,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B9O,CAA9B,CAA7E;AACAlD,YAAMyW,YAAN,CAAmBD,IAAnB,EAAyBtT,EAAE+E,GAAF,EAAzB,EAAkCqL,MAAlC;AACD,KAJD;;AAMA,QAAI+C,cAAc,MAAlB,EAA0B;AACxB,WAAKxF,eAAL,CAAqBJ,IAArB,CAA0B,UAACd,CAAD,EAAIC,CAAJ;AAAA,eAAUA,EAAE3L,IAAF,GAAS0L,EAAE1L,IAArB;AAAA,OAA1B;AAED,KAHD,MAGO,IAAIoS,cAAc,KAAlB,EAAyB;AAC9B;;AAED,KAHM,MAGA;AACL,UAAIrC,gBAAgBsC,UAApB,EAAgC;AAC9B;AACA;AACA;AACD,OAJD,MAIO;AACL,aAAKzF,eAAL,CAAqBJ,IAArB,CAA0B,UAACd,CAAD,EAAIC,CAAJ;AAAA,iBAAUA,EAAE4E,SAAF,GAAc7E,EAAE6E,SAA1B;AAAA,SAA1B;AACD;AACF;;AAGD;AACA;AACA;AACA;AACA;AACA;AAED,GA/gCqE;AAihCtEpS,4BAjhCsE,wCAihCzC;AAC3B,QAAMpC,QAAQ,IAAd;AACA,QAAI,CAAC,KAAKgR,SAAV,EAAqB,OAAOlS,MAAMK,IAAN,CAAW,uFAAX,CAAP;AACrB,QAAMuX,sBAAsB,KAAKrZ,KAAL,CAAWmD,MAAX,CAAkBwI,KAAlB,CAAwBwG,GAAxB,KAAgC,WAA5D;AACA,SAAKwB,SAAL,CAAejK,KAAf,CAAqB,MAArB,EAA6B,aAAK;AAChC,UAAMiC,QAAQ9F,EAAE4Q,aAAF,CAAgB9K,KAAhB,CAAsBlK,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuB7H,MAAMmI,QAAN,CAAea,KAAtC,CAAtB,CAAd;AACA,aAAOA,QAAS0N,uBAAuB1N,SAAS,UAAhC,GAA6ChJ,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwI,KAAnB,CAAyB2N,OAAzB,CAAiC,UAAjC,CAA7C,GAA4F3W,MAAM4D,MAAN,CAAaoF,KAAb,CAArG,GAA4HpJ,cAAnI;AACD,KAHD;AAID,GAzhCqE;AA2hCtE6W,cA3hCsE,wBA2hCzDD,IA3hCyD,EA2hCnD9S,GA3hCmD,EA2hC9C4P,MA3hC8C,EA2hCtC;AAC9B,QAAM/P,QAAQ,KAAKlG,KAAL,CAAWmD,MAAX,CAAkB+C,KAAlB,CAAwBgN,KAAtC;AACA,QAAMvQ,QAAQ,IAAd;AACA,QAAM8T,gBAAgB0C,KAAKI,KAAL,GAAa9C,aAAnC;;AAEA0C,SAAKnE,OAAL,CAAa,YAAb,EAA2BiB,MAA3B;;AAEA,QAAIA,MAAJ,EAAY;AACV,UAAI/P,UAAU,MAAd,EAAsBiT,KAAKzP,KAAL,CAAW,gBAAX,EAA6B,CAA7B;AACtB;AACD;;AAED,QAAM+H,SAAS,EAAf;AACAA,WAAO,KAAK7G,GAAZ,IAAmBvE,GAAnB;AACA,QAAI,KAAKrG,KAAL,CAAWmD,MAAX,CAAkBwR,UAAlB,CAA6BlD,MAA7B,CAAJ,EAA0C;AACxC0H,WAAK1P,IAAL,CAAU,GAAV,EAAe,KAAKnE,IAAL,CAAU,KAAKgB,MAAL,CAAYD,GAAZ,EAAiBoL,MAAjB,CAAwB;AAAA,eAAK4E,EAAEpQ,CAAF,GAAMwQ,cAAc7K,MAAd,CAAqBvF,GAArB,IAA4B/D,mBAAvC;AAAA,OAAxB,CAAV,CAAf;AACD,KAFD,MAEO;AACL6W,WAAK1P,IAAL,CAAU,GAAV,EAAe,KAAKnE,IAAL,CAAU,KAAKgB,MAAL,CAAYD,GAAZ,CAAV,CAAf;AACD;;AAED;AACA,QAAI,KAAKrG,KAAL,CAAWmD,MAAX,CAAkBwI,KAAlB,CAAwBwG,GAAxB,KAAgC,WAApC,EAAiD;AAC/CgH,WAAKzP,KAAL,CAAW,MAAX,EAAmB+M,cAAc9K,KAAd,CAAoBtF,GAApB,IAEfoQ,cAAc9K,KAAd,CAAoBtF,GAApB,MAA6B,UAA7B,GACE1D,MAAM4D,MAAN,CAAakQ,cAAc9K,KAAd,CAAoBtF,GAApB,CAAb,CADF,GAGE1D,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwI,KAAnB,CAAyB2N,OAAzB,CAAiC,UAAjC,CALa,GAQjB/W,cARF;AAUD;;AAED,QAAI2D,UAAU,MAAd,EAAsBiT,KACnBxP,UADmB,GACNC,QADM,CACGV,KAAKsQ,MAAL,KAAgB,GAAhB,GAAsB,GADzB,EAC8B3P,IAD9B,CACmCtE,GAAGkU,UADtC,EAEnB/P,KAFmB,CAEb,gBAFa,EAEK,GAFL;;AAItB,QAAI,KAAK1J,KAAL,CAAWM,IAAX,CAAgBwD,MAApB,EAA4B,KAAKC,OAAL,CAAa2V,KAAb,CAAmB;AAC7C3W,YAAM,MADuC;AAE7C4W,UAAItT,GAFyC;AAG7C/F,YAAM,KAAKN,KAAL,CAAWM,IAAX,CAAgB+C,KAAhB,CAAsB8N,cAAtB,EAHuC;AAI7CyI,YAAM,KAAKrT,MAAL,CAAYkQ,cAAc9K,KAAd,CAAoBtF,GAApB,CAAZ,CAJuC;AAK7CR,SAAG,KAAKP,IAAL,CAAU,KAAKgB,MAAL,CAAYD,GAAZ,CAAV;AAL0C,KAAnB;AAO7B,GAxkCqE;AA0kCtE+N,aA1kCsE,uBA0kC1DyF,WA1kC0D,EA0kC7C;AACvB,QAAIA,WAAJ,EAAiB;AACf,UAAMzP,QAAQ7E,GAAG6E,KAAH,CAAS,KAAKrD,KAAL,CAAW8H,IAAX,EAAT,EAA4BzF,GAA5B,CAAgC;AAAA,eAAK+D,SAAStH,CAAT,CAAL;AAAA,OAAhC,CAAd;;AAEA;AACA,WAAK8B,OAAL,CAAaqN,OAAb,CAAqB,YAArB,EAAmC,KAAnC,EACGvL,IADH,CACQ,WADR,EACqB,eAAgBW,MAAM,CAAN,CAAhB,GAA4B,GAA5B,GAAmCA,MAAM,CAAN,CAAnC,GAA+C,GADpE,EAEGpC,SAFH,CAEa,MAFb,EAGGyB,IAHH,CAGQ,aAHR,EAGuB,QAHvB,EAIGA,IAJH,CAIQ,oBAJR,EAI8B,QAJ9B,EAKGuG,IALH,CAKQ6J,WALR;;AAOA,UAAMC,cAAc,KAAKnS,OAAL,CAAab,MAAb,CAAoB,MAApB,EAA4B+H,IAA5B,GAAmCC,OAAnC,EAApB;;AAEA,WAAKnH,OAAL,CAAab,MAAb,CAAoB,MAApB,EACG2C,IADH,CACQ,OADR,EACiBqQ,YAAY1M,KAAZ,GAAoB,CADrC,EAEG3D,IAFH,CAEQ,QAFR,EAEkBqQ,YAAY5M,MAAZ,GAAqB,CAFvC,EAGGzD,IAHH,CAGQ,GAHR,EAGa,CAACqQ,YAAY1M,KAAb,GAAqB,EAHlC,EAIG3D,IAJH,CAIQ,GAJR,EAIa,CAACqQ,YAAY5M,MAAb,GAAsB,EAJnC,EAKGzD,IALH,CAKQ,IALR,EAKcqQ,YAAY5M,MAAZ,GAAqB,GALnC,EAMGzD,IANH,CAMQ,IANR,EAMcqQ,YAAY5M,MAAZ,GAAqB,GANnC;;AAQA,WAAKvF,OAAL,CAAaK,SAAb,CAAuB,MAAvB,EACGyB,IADH,CACQ,GADR,EACa,CAACqQ,YAAY1M,KAAb,GAAqB,EAArB,GAA2B,CAAC0M,YAAY1M,KAAZ,GAAoB,CAArB,IAA0B,CADlE,EAEG3D,IAFH,CAEQ,GAFR,EAEa,CAACqQ,YAAY5M,MAAb,GAAsB,EAAtB,GAA4B,CAAC4M,YAAY5M,MAAZ,GAAqB,EAAtB,IAA4B,CAFrE,EArBe,CAuB2D;AAC1E,UAAMiC,aAAc/E,MAAM,CAAN,IAAW0P,YAAY1M,KAAvB,GAA+B,EAAhC,GAAsC,CAAtC,GAA0ChD,MAAM,CAAN,CAA1C,GAAsD0P,YAAY1M,KAAZ,GAAoB,EAA7F;AACA,UAAMgC,aAAchF,MAAM,CAAN,IAAW0P,YAAY5M,MAAvB,GAAgC,EAAjC,GAAuC,CAAvC,GAA2C9C,MAAM,CAAN,CAA3C,GAAuD0P,YAAY5M,MAAZ,GAAqB,EAA/F;AACA,WAAKvF,OAAL,CACG8B,IADH,CACQ,WADR,EACqB,eAAe0F,UAAf,GAA4B,GAA5B,GAAkCC,UAAlC,GAA+C,GADpE;AAGD,KA7BD,MA6BO;;AAEL,WAAKzH,OAAL,CAAaqN,OAAb,CAAqB,YAArB,EAAmC,IAAnC;AACD;AACF,GA5mCqE;AA8mCtE9T,SA9mCsE,qBA8mC5D;AAAA;AAAA;;AACR,QAAMyB,QAAQ,IAAd;;AAEA,QAAMzB,UAAUO,MAAMsY,OAAN,CAAc,IAAd,EAAoB,CAAC,OAAD,EAAU,IAAV,EAAgB,OAAhB,EAAyB,SAAzB,CAApB,CAAhB;AACA,QAAM5Y,aAAaM,MAAMsY,OAAN,CAAc,IAAd,EAAoB,CAAC,OAAD,EAAU,IAAV,EAAgB,OAAhB,EAAyB,YAAzB,CAApB,CAAnB;AACA,QAAG,CAAC7Y,OAAJ,EAAa,OAAO8Y,QAAQC,OAAR,EAAP;;AAEb,QAAMrP,MAAM,KAAK5K,KAAL,CAAWmD,MAAX,CAAkB+W,kBAAlB,CAAqC,EAAEvP,YAAY,MAAd,EAArC,CAAZ;AACA,QAAML,UAAU,KAAKtK,KAAL,CAAWM,IAAX,CAAgB6Z,GAAhC;;AAEA;AACA,QAAMC,QAAQ;AACZC,gBAAU,KAAKra,KAAL,CAAWO,MAAX,CAAkBoZ,EADhB;AAEZW,YAAM,YAFM;AAGZxT,cAAQ;AACNT,aAAK,CAACuE,GAAD,EAAMN,OAAN,CADC;AAENjH,eAAO,CAACnC,OAAD;AAFD,OAHI;AAOZqZ,aAAO,EAAEC,MAAM,qBACV5P,GADU,EACJ,MAAMA,GADF,uBAEVN,OAFU,EAEA,MAAMA,OAFN,EAAR,EAPK;AAWZO,gDACG,MAAMD,GADT,EACe,EAAEvE,KAAKuE,GAAP,EAAY2P,2BAAU3P,GAAV,EAAgB,EAAE6P,KAAK,CAACtZ,cAAY,OAAb,CAAP,EAAhB,CAAZ,EADf,0BAEG,MAAMmJ,OAFT,EAEmB,EAAEjE,KAAKiE,OAAP,EAAgBiQ,2BAAUjQ,OAAV,EAAoB,KAAKtK,KAAL,CAAWM,IAAX,CAAgB8K,UAAhB,CAA2B,KAAKpL,KAAL,CAAWM,IAAX,CAAgB+C,KAA3C,CAApB,CAAhB,EAFnB,SAXY;AAeZqX,gBAAU,CAACpQ,OAAD;AAfE,KAAd;;AAkBA,WAAO,IAAI0P,OAAJ,CAAY,UAACC,OAAD,EAAUU,MAAV,EAAqB;;AAEtC,UAAMC,cAAc,OAAK5a,KAAL,CAAWsJ,IAAX,CAAgBuR,IAAhB,CAAqBT,KAArB,sBAA8BlZ,OAA9B,EAAwC;AAAA,eAAK4Z,KAAKC,KAAL,CAAWlV,CAAX,CAAL;AAAA,OAAxC,EAApB;;AAEA+U,kBAAYI,IAAZ,CACE,UAASC,MAAT,EAAgB;AACdtY,cAAM8F,gBAAN,GAAyB9F,MAAM3C,KAAN,CAAYsJ,IAAZ,CAAiB4R,OAAjB,CAAyBD,MAAzB,CAAzB;AACAhB;AACD,OAJH,EAKE;AAAA,eAAOxY,MAAMK,IAAN,CAAW,4CAAX,EAAyDqZ,GAAzD,EAA8DL,KAAKM,SAAL,CAAehB,KAAf,CAA9D,CAAP;AAAA,OALF;AAOD,KAXM,CAAP;AAYD;AAvpCqE,CAAzC,CAA/B;;kBA2pCe5X,sB;;;;;;;;;;;;AC/rCf;;;;AAIA,IAAM6Y,OAAO9b,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,SAArB,EAAgCT,MAAhC,CAAuC,QAAvC,EAAiD;;AAE5D;;;;;AAKAC,MAP4D,gBAOvD+C,MAPuD,EAO/CyN,MAP+C,EAOvC;AACnB,SAAKrQ,IAAL,GAAY,QAAZ;AACA,QAAM8C,QAAQ,IAAd;;AAEA,SAAKK,WAAL,GAAmB;AACjB,mCAA6B,kCAAW;AACtCL,cAAM2Y,UAAN;AACD,OAHgB;AAIjB,oCAA8B,mCAAW;AACvC3Y,cAAM2Y,UAAN;AACD;AANgB,KAAnB;;AASA,SAAKxb,UAAL,GAAkB,CAAC;AACjBC,iBAAWR,OAAOU,SAAP,CAAiBC,GAAjB,CAAqB,cAArB,CADM;AAEjBP,mBAAa,wBAFI;AAGjBK,aAAO,CAAC,cAAD,EAAiB,YAAjB,EAA+B,QAA/B,CAHU;AAIjBub,gBAAU,QAJO;AAKjB/a,UAAI;AACFgb,4BAAoB,KADlB;AAEFC,4BAAoB;AAFlB;AALa,KAAD,CAAlB;;AAYA,SAAKtb,MAAL,CAAYsC,MAAZ,EAAoByN,MAApB;AACA,SAAKtN,QAAL,GAAgB,mBAAAC,CAAQ,CAAR,CAAhB;AACD,GAlC2D;AAoC5DkH,WApC4D,uBAoChD;AACV,SAAK5J,MAAL;;AAEA,QAAMwC,QAAQ,IAAd;;AAEA,SAAK+Y,SAAL,GAAiB,KAAKzX,OAAL,CAAa6C,MAAb,CAAoB,sBAApB,EAA4CkB,SAA5C,CAAsD,OAAtD,EACdgC,EADc,CACX,QADW,EACD,YAAW;AACvBrH,YAAMgZ,QAAN,CAAe,YAAf,EAA6BpW,GAAGuB,MAAH,CAAU,IAAV,EAAgB+H,IAAhB,GAAuBxL,KAApD;AACD,KAHc,CAAjB;;AAKA,SAAKvC,SAAL,GAAiB,KAAKmD,OAAL,CAAa6C,MAAb,CAAoB,sBAApB,EAA4CkB,SAA5C,CAAsD,OAAtD,EACdgC,EADc,CACX,QADW,EACD,YAAW;AACvBrH,YAAMgZ,QAAN,CAAe,WAAf,EAA4BpW,GAAGuB,MAAH,CAAU,IAAV,EAAgB+H,IAAhB,GAAuBxL,KAAnD;AACD,KAHc,CAAjB;;AAKA,SAAKuY,UAAL,GAAkB,KAAK3X,OAAL,CAAa6C,MAAb,CAAoB,kBAApB,EACfkD,EADe,CACZ,QADY,EACF,YAAW;AACvBrH,YAAMgZ,QAAN,CAAe,YAAf,EAA6BpW,GAAGuB,MAAH,CAAU,IAAV,EAAgB+U,QAAhB,CAAyB,SAAzB,CAA7B;AACD,KAHe,CAAlB;;AAKA,SAAKC,YAAL,GAAoB,KAAK7X,OAAL,CAAa6C,MAAb,CAAoB,kBAApB,EACjBkD,EADiB,CACd,QADc,EACJ,YAAW;AACvB,UAAI6O,SAASkD,WAAW,KAAK1Y,KAAL,CAAW2Y,OAAX,CAAmB,GAAnB,EAAwB,GAAxB,CAAX,CAAb;AACA,UAAI,CAACnD,MAAD,IAAWA,UAAUlW,MAAM3C,KAAN,CAAYK,KAAZ,CAAkB8C,MAAlB,CAAyBoF,MAAzB,CAAgCkP,QAAzD,EAAmE;AACjE,aAAKpU,KAAL,GAAaV,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBI,MAAlC;AACA;AACD,OAHD,MAGO,IAAIgY,SAASlW,MAAM3C,KAAN,CAAYK,KAAZ,CAAkB8C,MAAlB,CAAyBoF,MAAzB,CAAgCS,SAA7C,EAAwD;AAC7D6P,iBAASlW,MAAM3C,KAAN,CAAYK,KAAZ,CAAkB8C,MAAlB,CAAyBoF,MAAzB,CAAgCS,SAAzC;AACD;AACD,WAAK3F,KAAL,GAAawV,MAAb;AACAlW,YAAMgZ,QAAN,CAAe,QAAf,EAAyB9C,MAAzB;AACD,KAXiB,CAApB;;AAaA,SAAKyC,UAAL;AAED,GAvE2D;AAyE5DA,YAzE4D,wBAyE/C;AACX,QAAM3Y,QAAQ,IAAd;;AAEA,SAAK+Y,SAAL,CAAeG,QAAf,CAAwB,SAAxB,EAAmC,YAAW;AAC5C,aAAOtW,GAAGuB,MAAH,CAAU,IAAV,EAAgB+H,IAAhB,GAAuBxL,KAAvB,KAAiCV,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBE,UAA7D;AACD,KAFD;AAGA,SAAKG,SAAL,CAAe+a,QAAf,CAAwB,SAAxB,EAAmC,YAAW;AAC5C,aAAOlZ,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBK,SAArB,CAA+B6D,OAA/B,CAAuC,CAACY,GAAGuB,MAAH,CAAU,IAAV,EAAgB+H,IAAhB,GAAuBxL,KAA/D,MAA0E,CAAC,CAAlF;AACD,KAFD;AAGA,SAAKuY,UAAL,CAAgBC,QAAhB,CAAyB,SAAzB,EAAoC,KAAK7b,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBG,UAAxD;AACA,SAAKkb,YAAL,CAAkBD,QAAlB,CAA2B,OAA3B,EAAoC,KAAK7b,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBI,MAAxD;AACD,GApF2D;AAsF5D8a,UAtF4D,oBAsFnDM,IAtFmD,EAsF7C5Y,KAtF6C,EAsFtC;AACpB,QAAIwV,eAAJ;;AAEA,QAAIoD,QAAQ,YAAZ,EAA0B;AACxBpD,eAASxV,KAAT;AACD;AACD,QAAI4Y,QAAQ,WAAZ,EAAyB;AACvBpD,eAAS,EAAT;AACA,WAAK/X,SAAL,CAAeoY,IAAf,CAAoB,YAAW;AAC7B,YAAI3T,GAAGuB,MAAH,CAAU,IAAV,EAAgB+U,QAAhB,CAAyB,SAAzB,CAAJ,EAAyChD,OAAOqD,IAAP,CAAY,CAAC3W,GAAGuB,MAAH,CAAU,IAAV,EAAgB+H,IAAhB,GAAuBxL,KAApC;AAC1C,OAFD;AAGD;AACD,QAAI4Y,QAAQ,QAAR,IAAoBA,QAAQ,YAAhC,EAA8C;AAC5CpD,eAASxV,KAAT;AACD;;AAED,SAAKrD,KAAL,CAAWQ,EAAX,CAAcC,KAAd,CAAoBwb,IAApB,IAA4BpD,MAA5B;AACD;AAvG2D,CAAjD,CAAb;;kBA0GewC,I;;;;;;;;;;;;cC9GG9b,M;IAAVkC,K,WAAAA,K;;;AAER,IAAM0a,SAAS5c,OAAO6c,KAAP,CAAa3c,MAAb,CAAoB;AAEjCC,MAFiC,gBAE5BgD,OAF4B,EAEnB;AACZ,SAAKA,OAAL,GAAeA,OAAf;;AAEA,SAAK4F,YAAL,GAAoB,CAApB;AACA,SAAKE,WAAL,GAAmB,CAAnB;AACD,GAPgC;AASjC5C,SATiC,mBASzBF,CATyB,EAStB;AACT,WAAOwD,KAAKgP,GAAL,CAAS,KAAK5P,YAAL,GAAoBY,KAAK2O,GAAL,CAASnS,CAAT,CAApB,GAAkC,KAAK8C,WAAhD,CAAP;AACD,GAXgC;AAYjCgP,SAZiC,mBAYzB9R,CAZyB,EAYtB;AACT,WAAOwD,KAAKgP,GAAL,CAAS,CAAChP,KAAK2O,GAAL,CAASnS,CAAT,IAAc,KAAK8C,WAApB,IAAmC,KAAKF,YAAjD,CAAP;AACD,GAdgC;AAgBjC+G,cAhBiC,wBAgBpBzG,MAhBoB,EAgBZkF,SAhBY,EAgBDhF,MAhBC,EAgBO;AACtC;AACA;;AAEA,QAAMuT,YAAYvO,cAAc,QAAd,GAAyBhF,OAAO,CAAP,CAAzB,GACdI,KAAK2O,GAAL,CAAS,KAAKL,OAAL,CAAa1O,OAAO,CAAP,CAAb,CAAT,CADJ;;AAGA,QAAMwT,UAAUxO,cAAc,QAAd,GAAyBhF,OAAO,CAAP,CAAzB,GACZI,KAAK2O,GAAL,CAAS,KAAKL,OAAL,CAAa1O,OAAO,CAAP,CAAb,CAAT,CADJ;;AAGA,QAAMyT,YAAY,CAACD,UAAUD,SAAX,IAAwBzT,MAA1C;;AAEA,QAAIjC,OAAOpB,GAAG+F,KAAH,CAAS+Q,SAAT,EAAoBC,OAApB,EAA6BC,SAA7B,EAAwCpG,MAAxC,CAA+CmG,OAA/C,CAAX;;AAEA,QAAIxO,cAAc,QAAlB,EAA4B;AAC1BnH,aAAOA,KAAKyC,GAAL,CAAS;AAAA,eAAMF,KAAKgP,GAAL,CAASD,EAAT,CAAN;AAAA,OAAT,CAAP;AACD,KAFD,MAEO;AACLtR,aAAOA,KAAK8K,MAAL,CAAY;AAAA,eAAMwG,KAAK,CAAX;AAAA,OAAZ,CAAP;AACD;;AAED,WAAOtR,IAAP;AACD,GArCgC;AAuCjC6R,SAvCiC,mBAuCzBgE,GAvCyB,EAuCpBnE,KAvCoB,EAuCb/P,YAvCa,EAuCCE,WAvCD,EAuCc;AAC7C;AACA;AACA,WAAOU,KAAK2O,GAAL,CAAS2E,MAAM,GAAf,IAAsBnE,QAAQA,KAAR,GAAgB,CAA7C;AACD,GA3CgC;AA6CjCC,aA7CiC,uBA6CrBmE,IA7CqB,EA6Cf;AAChB;AACA;AACA,WAAO,KAAKC,QAAL,CAAc,CAAED,OAAO,GAAR,GAAe,CAAhB,IAAqB,CAAnC,IAAwCvT,KAAKyT,GAAL,CAAS,CAAT,EAAY,GAAZ,CAA/C;AACD,GAjDgC;;;AAmDjC;AACAhE,OAAK;AACHiE,UADG,kBACIlX,CADJ,EACO6S,EADP,EACWF,KADX,EACkB;AACnB,aAAOnP,KAAKgP,GAAL,CACL,CAAC,GAAD,GAAOhP,KAAK2O,GAAL,CAAS,IAAI3O,KAAK0O,EAAlB,CAAP,GACE1O,KAAK2O,GAAL,CAASQ,KAAT,CADF,GAEEnP,KAAKyT,GAAL,CAASjX,IAAI6S,EAAb,EAAiB,CAAjB,KAAuB,IAAIF,KAAJ,GAAYA,KAAnC,CAHG,CAAP;AAKD,KAPE;AAQHO,aARG,qBAQOlT,CARP,EAQU6S,EARV,EAQcF,KARd,EAQqB;AACtB,aAAOnP,KAAKgP,GAAL,CACL,CAAC,GAAD,GAAOhP,KAAK2O,GAAL,CAAS,IAAI3O,KAAK0O,EAAlB,CAAP,CAA6B;AAA7B,QACE1O,KAAK2O,GAAL,CAASQ,KAAT,CADF,GAEEnP,KAAKyT,GAAL,CAASzT,KAAK2O,GAAL,CAASnS,CAAT,IAAc6S,EAAvB,EAA2B,CAA3B,KAAiC,IAAIF,KAAJ,GAAYA,KAA7C,CAHG,CAAP;AAKD;AAdE,GApD4B;;AAsEjCqE,UAtEiC,oBAsExBG,CAtEwB,EAsErB;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA,QAAMvK,IAAI,CAAC,CAAC,qBAAF,EAAyB,qBAAzB,EAAgD,CAAC,qBAAjD,EAAwE,qBAAxE,EAA+F,CAAC,qBAAhG,EAAuH,qBAAvH,CAAV;AACA,QAAMC,IAAI,CAAC,CAAC,qBAAF,EAAyB,qBAAzB,EAAgD,CAAC,qBAAjD,EAAwE,qBAAxE,EAA+F,CAAC,qBAAhG,CAAV;AACA,QAAMuK,IAAI,CAAC,CAAC,qBAAF,EAAyB,CAAC,qBAA1B,EAAiD,CAAC,qBAAlD,EAAyE,CAAC,qBAA1E,EAAiG,qBAAjG,EAAwH,qBAAxH,CAAV;AACA,QAAMjX,IAAI,CAAC,qBAAD,EAAwB,qBAAxB,EAA+C,qBAA/C,EAAsE,qBAAtE,CAAV;;AAEA;AACA,QAAMkX,OAAO,OAAb;AACA,QAAMC,QAAQ,IAAID,IAAlB;;AAEA;AACA,QAAIF,IAAIE,IAAR,EAAc;AACZ,UAAME,KAAI/T,KAAKgU,IAAL,CAAU,CAAC,CAAD,GAAKhU,KAAK2O,GAAL,CAASgF,CAAT,CAAf,CAAV;AACA,aAAO,CAAC,CAAC,CAAC,CAAC,CAACC,EAAE,CAAF,IAAOG,EAAP,GAAWH,EAAE,CAAF,CAAZ,IAAoBG,EAApB,GAAwBH,EAAE,CAAF,CAAzB,IAAiCG,EAAjC,GAAqCH,EAAE,CAAF,CAAtC,IAA8CG,EAA9C,GAAkDH,EAAE,CAAF,CAAnD,IAA2DG,EAA3D,GAA+DH,EAAE,CAAF,CAAhE,KACJ,CAAC,CAAC,CAACjX,EAAE,CAAF,IAAOoX,EAAP,GAAWpX,EAAE,CAAF,CAAZ,IAAoBoX,EAApB,GAAwBpX,EAAE,CAAF,CAAzB,IAAiCoX,EAAjC,GAAqCpX,EAAE,CAAF,CAAtC,IAA8CoX,EAA9C,GAAkD,CAD9C,CAAP;AAED;;AAED;AACA,QAAID,QAAQH,CAAZ,EAAe;AACb,UAAMI,MAAI/T,KAAKgU,IAAL,CAAU,CAAC,CAAD,GAAKhU,KAAK2O,GAAL,CAAS,IAAIgF,CAAb,CAAf,CAAV;AACA,aAAO,EAAE,CAAC,CAAC,CAAC,CAACC,EAAE,CAAF,IAAOG,GAAP,GAAWH,EAAE,CAAF,CAAZ,IAAoBG,GAApB,GAAwBH,EAAE,CAAF,CAAzB,IAAiCG,GAAjC,GAAqCH,EAAE,CAAF,CAAtC,IAA8CG,GAA9C,GAAkDH,EAAE,CAAF,CAAnD,IAA2DG,GAA3D,GAA+DH,EAAE,CAAF,CAAjE,KACJ,CAAC,CAAC,CAACjX,EAAE,CAAF,IAAOoX,GAAP,GAAWpX,EAAE,CAAF,CAAZ,IAAoBoX,GAApB,GAAwBpX,EAAE,CAAF,CAAzB,IAAiCoX,GAAjC,GAAqCpX,EAAE,CAAF,CAAtC,IAA8CoX,GAA9C,GAAkD,CAD9C,CAAP;AAED;;AAED;AACA,QAAMA,IAAIJ,IAAI,GAAd;AACA,QAAMM,IAAIF,IAAIA,CAAd;AACA,WAAO,CAAC,CAAC,CAAC,CAAC,CAAC3K,EAAE,CAAF,IAAO6K,CAAP,GAAW7K,EAAE,CAAF,CAAZ,IAAoB6K,CAApB,GAAwB7K,EAAE,CAAF,CAAzB,IAAiC6K,CAAjC,GAAqC7K,EAAE,CAAF,CAAtC,IAA8C6K,CAA9C,GAAkD7K,EAAE,CAAF,CAAnD,IAA2D6K,CAA3D,GAA+D7K,EAAE,CAAF,CAAhE,IAAwE2K,CAAxE,IACJ,CAAC,CAAC,CAAC,CAAC1K,EAAE,CAAF,IAAO4K,CAAP,GAAW5K,EAAE,CAAF,CAAZ,IAAoB4K,CAApB,GAAwB5K,EAAE,CAAF,CAAzB,IAAiC4K,CAAjC,GAAqC5K,EAAE,CAAF,CAAtC,IAA8C4K,CAA9C,GAAkD5K,EAAE,CAAF,CAAnD,IAA2D4K,CAA3D,GAA+D,CAD3D,CAAP;AAGD;AA5HgC,CAApB,CAAf;;kBAiIehB,M;;;;;;;;;;;;cCnIG5c,M;IAAVkC,K,WAAAA,K;;;AAER,IAAM2b,UAAU7d,OAAO6c,KAAP,CAAa3c,MAAb,CAAoB;AAElCC,MAFkC,gBAE7BgD,OAF6B,EAEpB;AACZ,SAAKA,OAAL,GAAeA,OAAf;AAED,GALiC;AAOlC6B,QAPkC,kBAO3BuU,OAP2B,EAOlB;AACd,QAAMnW,QAAQ,KAAKD,OAAnB;AACA,QAAI,CAACoW,OAAL,EAAcA,UAAU,EAAV;;AAEd,QAAI,CAACA,QAAQ5O,KAAb,EAAoB4O,QAAQ5O,KAAR,GAAgBvH,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBI,MAArC;;AAEpB8B,UAAMkF,OAAN,CAAcmN,OAAd,CAAsB,YAAtB,EAAoC,CAAC8D,QAAQ5O,KAAT,IAAkB,CAACvH,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBG,UAA5E;AACA,QAAI,CAACkY,QAAQ5O,KAAb,EAAoB;;AAEpBvH,UAAMqE,OAAN,CAAc2H,IAAd,CAAmBhM,MAAM6D,KAAN,CAAY6W,cAAZ,CAA2BvE,QAAQzO,IAAR,GAAeyO,QAAQ5O,KAAvB,GAA+B,MAA1D,CAAnB;;AAEA,QAAIoT,WAAW,CAAf;AACA,QAAIC,YAAY,CAAhB;AACA,QAAIC,WAAW,CAAf;;AAEA,QAAMC,gBAAgB,SAAhBA,aAAgB,CAAS5X,CAAT,EAAY;AAChCyX,kBAAYzX,EAAE4Q,aAAF,CAAgB7K,MAAhB,CAAuBnK,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuB7H,MAAMmI,QAAN,CAAec,MAAtC,CAAvB,CAAZ;AACAjJ,YAAM2D,MAAN,CAAaT,EAAE+E,GAAF,EAAb,EAAsBiI,OAAtB,CAA8B,aAAK;AACjC0K,qBAAa1X,EAAEI,CAAf;AACA,YAAItD,MAAMqC,KAAN,CAAYY,OAAZ,CAAoBC,EAAEH,CAAtB,IAA2BoT,QAAQ5O,KAAvC,EAA8CsT,YAAY3X,EAAEI,CAAd;AAC/C,OAHD;AAID,KAND;;AAQA,QAAItD,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB+C,KAAnB,CAAyBgN,KAAzB,KAAmC,KAAvC,EAA8C;AAC5CvQ,YAAMwQ,eAAN,CAAsBN,OAAtB,CAA8B4K,aAA9B;AACD,KAFD,MAEO,IAAI9a,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmB+C,KAAnB,CAAyBgN,KAAzB,KAAmC,MAAvC,EAA+C;AACpDvQ,YAAM4O,gBAAN,CAAuBsB,OAAvB,CAA+B4K,aAA/B;AACD,KAFM,MAEA;AACL9a,YAAMsP,eAAN,CAAsBY,OAAtB,CAA8B4K,aAA9B;AACD;;AAED,QAAMC,aAAanY,GAAGoY,MAAH,CAAU,KAAV,CAAnB;AACA,QAAMC,aAAajb,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmByI,MAAnB,CAA0B8C,gBAA1B,EAAnB;AACA/L,UAAMkb,cAAN,GAAuBlb,MAAMkb,cAAN,IAAyB,OAAOlb,MAAMuK,MAA7D;;AAEAvK,UAAMoF,WAAN,CAAkBmR,IAAlB,CAAuB,UAASrT,CAAT,EAAYqC,CAAZ,EAAe;AACpC,UAAIA,MAAM,CAAV,EAAa;AACb,UAAMiR,OAAO5T,GAAGuB,MAAH,CAAU,IAAV,CAAb;;AAEA,UAAI,CAACgS,QAAQzO,IAAT,IAAiB1H,MAAM3C,KAAN,CAAYQ,EAAZ,CAAeC,KAAf,CAAqBI,MAArB,IAA+B8B,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBoF,MAAnB,CAA0BgP,QAA9E,EAAwF;;AAEtF4B,aAAKnJ,IAAL,CAAUrN,MAAMiN,UAAN,CAAiB,sBAAjB,CAAV,EACGoF,OADH,CACW,YADX,EACyB,KADzB,EAEGvL,IAFH,CAEQ,GAFR,EAEa,CAAC9G,MAAMuK,MAFpB,EAGGzD,IAHH,CAGQ,GAHR,EAGa9G,MAAMgD,MAAN,CAAamT,QAAQ5O,KAArB,CAHb,EAIGT,IAJH,CAIQ,IAJR,EAIc,SAJd,EAKGA,IALH,CAKQ,IALR,EAKc,OALd,EAMGA,IANH,CAMQ,WANR,EAMqB,aANrB;;AAQA9G,cAAMkb,cAAN,GAAuBlb,MAAMuK,MAAN,GAAeiM,KAAKtK,IAAL,GAAYC,OAAZ,GAAsB1B,KAArC,GAA6C+L,KAAKtK,IAAL,GAAYC,OAAZ,GAAsB5B,MAAtB,GAA+B,IAAnG;AACD,OAXD,MAWO;AACLiM,aAAKnE,OAAL,CAAa,YAAb,EAA2B,IAA3B;AACD;AACF,KAlBD;;AAqBArS,UAAMoF,WAAN,CAAkBmR,IAAlB,CAAuB,UAASrT,CAAT,EAAYqC,CAAZ,EAAe;AACpC,UAAIA,MAAM,CAAV,EAAa;AACb,UAAMiR,OAAO5T,GAAGuB,MAAH,CAAU,IAAV,CAAb;;AAEA,UAAIgX,eAAJ;AACA,UAAI5V,MAAM,CAAN,IAAWA,MAAM,CAArB,EAAwB4V,SAASJ,WAAWF,WAAWD,SAAX,GAAuB,GAAlC,IAAyC,GAAlD;AACxB,UAAIrV,MAAM,CAAN,IAAWA,MAAM,CAArB,EAAwB4V,SAASJ,WAAW,MAAMF,WAAWD,SAAX,GAAuB,GAAxC,IAA+C,GAAxD;AACxB,UAAIrV,MAAM,CAAN,IAAWA,MAAM,CAArB,EAAwB4V,SAASF,WAAWN,WAAWE,QAAX,GAAsBD,SAAjC,CAAT;AACxB,UAAIrV,MAAM,CAAN,IAAWA,MAAM,CAArB,EAAwB4V,SAASF,WAAWN,YAAY,IAAIE,WAAWD,SAA3B,CAAX,IAAoD,GAApD,GAA0D5a,MAAMiN,UAAN,CAAiB,cAAjB,CAAnE;;AAExBuJ,WAAKnJ,IAAL,CAAU8N,MAAV,EACG9I,OADH,CACW,YADX,EACyB,CAAC8D,QAAQzO,IAAT,KAAkB1H,MAAMyO,YAAN,IAAuBlJ,MAAM,CAAN,IAAWA,MAAM,CAA1D,CADzB,EAEGuB,IAFH,CAEQ,GAFR,EAEa9G,MAAMgD,MAAN,CAAamT,QAAQ5O,KAArB,KAA+B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAavF,OAAb,CAAqBuD,CAArB,IAA0B,CAAC,CAA3B,GAA+B,CAAC,CAAhC,GAAoC,CAAC,CAApE,CAFb,EAGGuB,IAHH,CAGQ,GAHR,EAGa9G,MAAMkb,cAHnB,EAIGpU,IAJH,CAIQ,IAJR,EAIc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa9E,OAAb,CAAqBuD,CAArB,IAA0B,CAAC,CAA3B,GAA+B,CAA/B,GAAmC,OAJjD;AAKD,KAfD;;AAkBAvF,UAAMmF,WAAN,CACG2B,IADH,CACQ,IADR,EACc9G,MAAMgD,MAAN,CAAamT,QAAQ5O,KAArB,CADd,EAEGT,IAFH,CAEQ,IAFR,EAEc9G,MAAMgD,MAAN,CAAamT,QAAQ5O,KAArB,CAFd,EAGGT,IAHH,CAGQ,IAHR,EAGc9G,MAAMuK,MAAN,GAAe,CAH7B,EAIGzD,IAJH,CAIQ,IAJR,EAIc,CAJd;AAOD;AAxFiC,CAApB,CAAhB;;kBA6Fe2T,O;;;;;;;;;;;;cC1FX7d,M;IAJFkC,K,WAAAA,K;IAESsc,S,WADTnc,O,CACEoc,K;;;AAIJ,IAAMC,eAAe1e,OAAO6c,KAAP,CAAa3c,MAAb,CAAoB;AAEvCC,MAFuC,gBAElCgD,OAFkC,EAEzB;AACZ,SAAKA,OAAL,GAAeA,OAAf;AAED,GALsC;AAOvCwS,SAPuC,mBAO/B5L,IAP+B,EAOzB;AACZ,QAAM3G,QAAQ,KAAKD,OAAnB;AACA,QAAMwb,SAAS,IAAf;;AAEA,QAAMC,WAAWxb,MAAM4O,gBAAN,CACd4E,MADc,CACPxT,MAAMsP,eADC,EAEdkE,MAFc,CAEPxT,MAAMwQ,eAFC,EAGd1B,MAHc,CAGP;AAAA,aAAK9O,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwR,UAAnB,CAA8B0B,EAAE7L,IAAF,EAA9B,CAAL;AAAA,KAHO,EAGuC4I,IAHvC,CAG4C,UAACd,CAAD,EAAIC,CAAJ,EAAU;AACnE,UAAID,EAAEP,SAAF,IAAeQ,EAAER,SAArB,EAAgC;AAC9B,YAAIO,EAAEP,SAAF,CAAY,CAAZ,MAAmBQ,EAAER,SAAF,CAAY,CAAZ,CAAvB,EAAuC;AACrC,iBAAOxM,GAAG6Y,UAAH,CAAc9L,EAAEP,SAAF,CAAY,CAAZ,CAAd,EAA8BQ,EAAER,SAAF,CAAY,CAAZ,CAA9B,CAAP;AACD;AACD,eAAOxM,GAAG6Y,UAAH,CAAc9L,EAAEP,SAAF,CAAY,CAAZ,CAAd,EAA8BQ,EAAER,SAAF,CAAY,CAAZ,CAA9B,CAAP;AACD;;AAED,UAAIO,EAAEN,SAAF,IAAeO,EAAEP,SAArB,EAAgC;AAC9B,eAAOzM,GAAG6Y,UAAH,CAAc9L,EAAEN,SAAhB,EAA2BO,EAAEP,SAA7B,CAAP;AACD,OAFD,MAEO,IAAIM,EAAEN,SAAF,IAAeO,EAAEP,SAArB,EAAgC;AACrC,eAAOzM,GAAG6Y,UAAH,CAAc9L,EAAE1L,IAAhB,EAAsB2L,EAAE3L,IAAxB,CAAP;AACD;;AAED,aAAO,CAAP;AACD,KAlBc,CAAjB;AAmBAjE,UAAMoS,UAAN,GAAmBpS,MAAM+E,sBAAN,CAA6BM,SAA7B,CAAuC,gBAAvC,EAChBsB,IADgB,CACX7H,MAAMgJ,MAAN,CAAa0T,QAAb,EAAuB;AAAA,aAAKtY,EAAE+E,GAAF,EAAL;AAAA,KAAvB,CADW,CAAnB;AAEAjI,UAAMoS,UAAN,CAAiBtB,IAAjB,GAAwBvI,MAAxB;AACAvI,UAAMoS,UAAN,GAAmBpS,MAAMoS,UAAN,CAAiBxL,KAAjB,GAAyBC,MAAzB,CAAgC,GAAhC,EAChBC,IADgB,CACX,OADW,EACF,cADE,EAEhByP,IAFgB,CAEX,UAASrT,CAAT,EAAYqC,CAAZ,EAAe;AACnB,UAAMoM,QAAQ/O,GAAGuB,MAAH,CAAU,IAAV,CAAd;AACAwN,YAAM9K,MAAN,CAAa,QAAb,EAAuBC,IAAvB,CAA4B,OAA5B,EAAqC,qBAArC;AACA6K,YAAM9K,MAAN,CAAa,MAAb,EAAqBC,IAArB,CAA0B,OAA1B,EAAmC,uCAAnC;AACA6K,YAAM9K,MAAN,CAAa,MAAb,EAAqBC,IAArB,CAA0B,OAA1B,EAAmC,mBAAnC;AACA6K,YAAM9K,MAAN,CAAa,GAAb,EAAkBC,IAAlB,CAAuB,OAAvB,EAAgC,+CAAhC,EACGO,EADH,CACM,OADN,EACe,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACrB,YAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BrO,WAAGwO,KAAH,CAASC,eAAT;AACArR,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmBsR,gBAAnB;AACA9R,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmByR,YAAnB,CAAgC/O,EAAE2E,IAAF,EAAhC;AACAjF,WAAGwO,KAAH,CAASC,eAAT;AACD,OAPH,EAQG/L,KARH,CAQS,UAACpC,CAAD,EAAIqC,CAAJ,EAAU;AACf;AACAvF,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmBsR,gBAAnB;AACA9R,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmByR,YAAnB,CAAgC/O,EAAE2E,IAAF,EAAhC;AACD,OAZH;AAaA,UAAM6T,kBAAkB/J,MAAMxN,MAAN,CAAa,kBAAb,CAAxB;AACA,UAAI,CAACrF,MAAMmS,aAAN,EAAL,EAA4B;AAC1BnS,cAAMwO,OAAN,CAAcoO,eAAd,EAA+BN,SAA/B,EACGjX,MADH,CACU,KADV,EAEG2C,IAFH,CAEQ,OAFR,EAEiB,qBAFjB,EAGGA,IAHH,CAGQ,OAHR,EAGiB,KAHjB,EAIGA,IAJH,CAIQ,QAJR,EAIkB,KAJlB;;AAMA4U,wBAAgBC,MAAhB,CAAuB,QAAvB,EAAiC,KAAjC;AAED,OATD,MASO;AACLD,wBAAgB7U,MAAhB,CAAuB,MAAvB;AACA6U,wBAAgB7U,MAAhB,CAAuB,MAAvB,EACGC,IADH,CACQ,OADR,EACiB,qBADjB,EAEGuG,IAFH,CAEQ,UAFR;AAGD;AACF,KApCgB,EAqChBhG,EArCgB,CAqCb,WArCa,EAqCA,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACzB,UAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BsK,aAAO1J,cAAP,CAAsB3O,CAAtB,EAAyB,IAAzB;AACAlD,YAAM3C,KAAN,CAAYmD,MAAZ,CAAmBgR,eAAnB,CAAmCtO,EAAE2E,IAAF,EAAnC;AACD,KAzCgB,EA0ChBR,EA1CgB,CA0Cb,UA1Ca,EA0CD,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACxB,UAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BsK,aAAO1J,cAAP,CAAsB3O,CAAtB,EAAyB,KAAzB;AACAlD,YAAM3C,KAAN,CAAYmD,MAAZ,CAAmBsR,gBAAnB;AAED,KA/CgB,EAgDhBzK,EAhDgB,CAgDb,OAhDa,EAgDJ,UAACnE,CAAD,EAAIqC,CAAJ,EAAU;AACrB,UAAIzG,MAAMmS,aAAN,EAAJ,EAA2B;AAC3BjR,YAAM3C,KAAN,CAAYmD,MAAZ,CAAmBsR,gBAAnB;AACA9R,YAAM3C,KAAN,CAAYmD,MAAZ,CAAmByR,YAAnB,CAAgC/O,EAAE2E,IAAF,EAAhC;AACD,KApDgB,EAqDhBkJ,KArDgB,CAqDV/Q,MAAMoS,UArDI,CAAnB;AAsDD,GAvFsC;AAyFvCxQ,QAzFuC,oBAyF9B;AACP,QAAM5B,QAAQ,KAAKD,OAAnB;AACA,QAAMoI,WAAWnI,MAAMmI,QAAvB;;AAEA,QAAI,CAACnI,MAAMoS,UAAP,IAAqB,CAACpS,MAAMyO,YAAhC,EAA8C;;AAE9C,QAAMmN,SAAS5b,MAAM+E,sBAAN,CAA6B8B,MAA7B,CAAoC,GAApC,EAAyCC,IAAzC,CAA8C,OAA9C,EAAuD,cAAvD,EAAuED,MAAvE,CAA8E,MAA9E,EAAsFwG,IAAtF,CAA2F,GAA3F,CAAf;AACA,QAAIwO,aAAaD,OAAO1P,IAAP,GAAcC,OAAd,GAAwB5B,MAAxB,GAAiC,GAAlD;AACA,QAAMuR,uBAAuB1C,WAAWwC,OAAO7U,KAAP,CAAa,WAAb,CAAX,IAAwC8U,UAArE;AACAjZ,OAAGuB,MAAH,CAAUyX,OAAO1P,IAAP,GAAc6P,UAAxB,EAAoCxT,MAApC;AACA,QAAMuD,YAAY9L,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmByI,MAAnB,CAA0B8C,gBAA1B,EAAlB;;AAEA,QAAMiQ,cAAchc,MAAMuE,QAAN,CAAeJ,MAAf,CAAsB,MAAtB,EAA8B+H,IAA9B,GAAqCC,OAArC,GAA+C5B,MAA/C,IAAyD,CAA7E;;AAEA,QAAM0R,gBAAgB,CAACjc,MAAMuK,MAAN,GAAeyR,cAAc,CAA9B,KAAoChc,MAAMoS,UAAN,CAAiBzL,IAAjB,GAAwBV,MAAxB,GAAiC,CAArE,CAAtB;AACA,QAAI4V,aAAaI,aAAjB,EAAgCJ,aAAaI,aAAb;;AAEhC,QAAIC,mBAAmB,MAAvB;AACA,QAAIC,mBAAmB,CAAvB;;AAEA,QAAMC,cAAcpc,MAAM3C,KAAN,CAAYmD,MAAZ,CAAmBwI,KAAnB,CAAyB0I,oBAAzB,GAAgDC,KAAhD,CAAsDC,QAAtD,EAApB;;AAEA,QAAMlH,QAAQ1K,MAAM3C,KAAN,CAAYO,MAAZ,CAAmB8M,KAAnB,EAAd;;AAEA1K,UAAMoS,UAAN,CACGtL,IADH,CACQ,WADR,EACqB,UAAC5D,CAAD,EAAIqC,CAAJ,EAAU;AAC3B,UAAIrC,EAAEmM,SAAF,IAAe6M,gBAAnB,EAAqCC,oBAAoBN,UAApB;AACrC,UAAMQ,UAAUR,aAAatW,CAAb,GAAiByW,cAAc,CAA/B,GAAmCG,gBAAnD;AACAD,yBAAmBhZ,EAAEmM,SAArB;AACA,aAAO,gBAAgB3E,QAAQ1K,MAAMyK,KAAd,GAAsB,CAAtC,IAA2C,GAA3C,GAAiD4R,OAAjD,GAA2D,GAAlE;AACD,KANH,EAOG9F,IAPH,CAOQ,UAASrT,CAAT,EAAYqC,CAAZ,EAAe;;AAEnB,UAAMiR,OAAO5T,GAAGuB,MAAH,CAAU,IAAV,EAAgB2C,IAAhB,CAAqB,IAArB,EAA2B5D,EAAE+E,GAAF,KAAU,SAAV,GAAsBjI,MAAMsc,GAAvD,CAAb;AACA,UAAIpf,OAAO,EAAX;AACA,UAAIgG,EAAEQ,GAAN,EAAW;AACTxG,eAAOgG,EAAEQ,GAAF,KAAU,KAAV,GAAkB1D,MAAMiN,UAAN,CAAiB,qBAAjB,CAAlB,GAA4DmP,YAAYlZ,EAAEQ,GAAd,CAAnE;AACD,OAFD,MAEO;AACLxG,eAAO8C,MAAMuR,aAAN,CAAoBvR,MAAM8I,MAA1B,EAAkC9I,MAAMqI,UAAxC,EAAoDnF,EAAE2E,IAAF,EAApD,CAAP;AACD;;AAED,UAAM0U,SAASrZ,EAAE4Q,aAAF,CAAgB7K,MAAhB,CAAuBnK,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASc,MAAhC,CAAvB,CAAf;;AAEA,UAAMkS,SAASje,OAAO,IAAP,GAAc4O,UAAUyQ,MAAV,CAAd,IAAmChX,MAAM,CAAN,GAAU,MAAMvF,MAAMiN,UAAN,CAAiB,cAAjB,CAAhB,GAAmD,EAAtF,CAAf;;AAEA,UAAMI,OAAOmJ,KAAKnR,SAAL,CAAe,oBAAf,EACVyB,IADU,CACL,GADK,EACA,CAAC4D,QAAQ,CAAC,CAAT,GAAa,CAAd,IAAmBmR,UADnB,EAEV/U,IAFU,CAEL,GAFK,EAEA+U,UAFA,EAGVxO,IAHU,CAGL8N,MAHK,EAIVpU,KAJU,CAIJ,WAJI,EAIS8U,eAAeI,aAAf,GAAgCJ,aAAaC,oBAAb,GAAoC,IAApE,GAA4E,IAJrF,CAAb;;AAMA,UAAM3E,cAAc9J,KAAKnB,IAAL,GAAYC,OAAZ,EAApB;;AAEA,UAAMqQ,aAAahG,KAAKrS,MAAL,CAAY,iBAAZ,CAAnB;;AAEA,UAAIrF,MAAMmS,aAAN,EAAJ,EAA2B;AACzB,YAAMwL,gBAAgBD,WAAWrY,MAAX,CAAkB,MAAlB,EAA0B+H,IAA1B,GAAiCC,OAAjC,EAAtB;AACAqQ,mBACGnK,OADH,CACW,kBADX,EAC+B,IAD/B,EAEGlO,MAFH,CAEU,sBAFV,EAGGkO,OAHH,CAGW,kBAHX,EAG+B,IAH/B,EAIGvL,IAJH,CAIQ,GAJR,EAIaqQ,YAAY1M,KAAZ,GAAoB0M,YAAY5M,MAAZ,GAAqB,IAAzC,GAAgDkS,cAAchS,KAAd,GAAsB,GAJnF,EAKG3D,IALH,CAKQ,GALR,EAKaqQ,YAAY5M,MAAZ,GAAqB,IALlC;;AAOAiS,mBAAWrY,MAAX,CAAkB,MAAlB,EACG2C,IADH,CACQ,OADR,EACiB2V,cAAchS,KAAd,GAAsB0M,YAAY5M,MAAZ,GAAqB,GAD5D,EAEGzD,IAFH,CAEQ,QAFR,EAEkBqQ,YAAY5M,MAF9B,EAGGzD,IAHH,CAGQ,GAHR,EAGaqQ,YAAY1M,KAAZ,GAAoB0M,YAAY5M,MAAZ,GAAqB,GAHtD,EAIGzD,IAJH,CAIQ,GAJR,EAIa,CAJb,EAKGA,IALH,CAKQ,IALR,EAKcqQ,YAAY5M,MAAZ,GAAqB,IALnC,EAMGzD,IANH,CAMQ,IANR,EAMcqQ,YAAY5M,MAAZ,GAAqB,IANnC;AAOD,OAhBD,MAgBO;AACLiS,mBACG1V,IADH,CACQ,GADR,EACaqQ,YAAY1M,KAAZ,GAAoB0M,YAAY5M,MAAZ,GAAqB,GADtD,EAEGzD,IAFH,CAEQ,GAFR,EAEaqQ,YAAY5M,MAAZ,GAAqB,CAFlC;;AAIAiS,mBAAWrY,MAAX,CAAkB,QAAlB,EACG2C,IADH,CACQ,GADR,EACaqQ,YAAY5M,MAAZ,GAAqB,GADlC,EAEGzD,IAFH,CAEQ,IAFR,EAEc,CAAC4D,QAAQ,CAAC,CAAT,GAAa,CAAd,KAAoByM,YAAY1M,KAAZ,GAAoB0M,YAAY5M,MAAZ,GAAqB,GAA7D,CAFd,EAGGzD,IAHH,CAGQ,IAHR,EAGcqQ,YAAY5M,MAAZ,GAAqB,CAHnC;;AAKAiS,mBAAWrY,MAAX,CAAkB,KAAlB,EACG2C,IADH,CACQ,GADR,EACa,CAAC4D,QAAQ,CAAC,CAAT,GAAa,CAAd,KAAoByM,YAAY1M,KAAZ,GAAoB0M,YAAY5M,MAAZ,IAAsB,OAAOG,QAAQ,CAAC,GAAT,GAAe,GAAtB,CAAtB,CAAxC,CADb,EAEG5D,IAFH,CAEQ,GAFR,EAEaqQ,YAAY5M,MAAZ,IAAsB,IAAI,CAAJ,GAAQ,GAA9B,CAFb,EAGGzD,IAHH,CAGQ,OAHR,EAGiBqQ,YAAY5M,MAAZ,GAAqB,GAHtC,EAIGzD,IAJH,CAIQ,QAJR,EAIkBqQ,YAAY5M,MAAZ,GAAqB,GAJvC;AAKD;;AAEDiM,WAAKrS,MAAL,CAAY,sBAAZ,EACG2C,IADH,CACQ,GADR,EACa+U,aAAa,CAD1B,EAEG/U,IAFH,CAEQ,IAFR,EAEc,CAAC4D,QAAQ,CAAC,CAAT,GAAa,CAAd,IAAmBmR,UAAnB,GAAgC,GAF9C,EAGG/U,IAHH,CAGQ,IAHR,EAGc+U,aAAa,GAH3B,EAIG9U,KAJH,CAIS,MAJT,EAIiB/G,MAAM4D,MAAN,CAAaV,EAAE4Q,aAAF,CAAgB9K,KAAhB,CAAsBlK,MAAMiQ,MAAN,CAAa7L,EAAE2E,IAAF,EAAb,EAAuBM,SAASa,KAAhC,CAAtB,CAAb,CAJjB;;AAMAwN,WAAKlR,KAAL,CAAW,UAACpC,CAAD,EAAIqC,CAAJ,EAAU;AACnB3C,WAAGwO,KAAH,CAASC,eAAT;AACArR,cAAM3C,KAAN,CAAYmD,MAAZ,CAAmBgR,eAAnB,CAAmCtO,EAAE2E,IAAF,EAAnC;AACA6U,mBAAW,YAAM;AACf1c,gBAAM3C,KAAN,CAAYmD,MAAZ,CAAmBmc,iBAAnB,CAAqCzZ,EAAE2E,IAAF,EAArC;AACD,SAFD,EAEG,IAFH;AAGD,OAND;AAOD,KA7EH;AA8ED,GA/LsC;AAiMvCgK,gBAjMuC,0BAiMxB3O,CAjMwB,EAiMrBiL,IAjMqB,EAiMf;AACtB,QAAMnO,QAAQ,KAAKD,OAAnB;AACA,QAAM2D,MAAMR,EAAE+E,GAAF,EAAZ;AACA;AACAjI,UAAMoS,UAAN,CACGtD,MADH,CACU;AAAA,aAAK4E,EAAEzL,GAAF,MAAWvE,GAAhB;AAAA,KADV,EAEGS,MAFH,CAEU,iBAFV,EAGGkO,OAHH,CAGW,eAHX,EAG4B,CAAClE,IAH7B;AAID;AAzMsC,CAApB,CAArB;;kBA6MemN,Y;;;;;;ACpNf,yC;;;;;;ACAA,8hE;;;;;;ACAA,y5D","file":"mountainchart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7649343ee32b82bf5ca5","import \"./styles.scss\";\nimport component from \"./component\";\nimport \"./dialogs/axesmc/axesmc\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n// MOUNTAIN CHART TOOL\nconst MountainChart = Vizabi.Tool.extend(\"MountainChart\", {\n\n  /**\n   * Initializes the tool (MountainChart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"mountainchart\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"locale\", \"data\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.time\", \"locale\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  default_model: {\n    state: {\n      time: {\n        \"delay\": 100,\n        \"delayThresholdX2\": 50,\n        \"delayThresholdX4\": 25\n      },\n      \"entities\": {\n        \"opacitySelectDim\": 0.3,\n        \"opacityRegular\": 0.7\n      }\n    },\n    locale: { },\n    ui: {\n      chart: {\n        manualSortingEnabled: true,\n        yMaxMethod: \"latest\",\n        showProbeX: true,\n        probeX: 1.85,\n        xLogStops: [1, 2, 5],\n        xPoints: 50,\n        directSigma: false, //false = input is gini, true = input is standatd deviation of the distribution\n        directMu: false, //false = input is GDP/capita, true = input is mean of the distribution\n        preload: \"income_mountains\",\n        preloadKey: \"world\"\n      },\n      \"buttons\": [\"colors\", \"find\", \"stack\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      \"dialogs\": {\n        \"popup\": [\"colors\", \"find\", \"stack\", \"moreoptions\"],\n        \"sidebar\": [\"colors\", \"find\", \"stack\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"stack\", \"axesmc\", \"colors\", \"presentation\", \"about\"]\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      presentation: false\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default MountainChart;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/**\n * VIZABI MOUNTAINCHART\n * This graph displays income distribution in the world\n *\n * Original code:\n * Angie https://github.com/angieskazka\n *\n * Contributions:\n * IncoCode https://github.com/IncoCode/\n * Arthur https://github.com/arthurcamara1\n *\n * Developed in Gapminder Foundation, 2015\n */\n\nconst { \n  utils, \n  _globals: globals,\n  iconset: {\n    warn: iconWarn,\n    question: iconQuestion\n  },\n  helpers: {\n    svgexport: Exporter,\n    \"d3.axisWithLabelPicker\": axisSmart,\n    \"d3.dynamicBackground\": DynamicBackground,\n  }\n} = Vizabi;\n\nimport MountainChartMath from \"./mountainchart-math\";\nimport Selectlist from \"./mountainchart-selectlist\";\nimport Probe from \"./mountainchart-probe\";\n\nconst THICKNESS_THRESHOLD = 0.001;\nconst COLOR_WHITEISH = \"#d3d3d3\";\n\n// MOUNTAIN CHART COMPONENT\nconst MountainChartComponent = Vizabi.Component.extend(\"mountainchart\", {\n\n  /**\n   * Initialize the component\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n\n    const _this = this;\n    this.name = \"mountainchart\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [\n      { name: \"time\", type: \"time\" },\n      { name: \"marker\", type: \"marker\" },\n      { name: \"locale\", type: \"locale\" },\n      { name: \"data\", type: \"data\" },\n      { name: \"ui\", type: \"ui\" }\n    ];\n\n    //attach event listeners to the model items\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.getFrame(_this.model.time.value, _this.frameChanged.bind(_this));\n      },\n      \"change:time.playing\": function(evt) {\n        // this listener is a patch for fixing #1228. time.js doesn't produce the last event\n        // with playing == false when paused softly\n        if (!_this.model.time.playing) {\n          _this.redrawDataPoints();\n        }\n      },\n      \"change:marker.axis_x.xScaleFactor\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.xScaleShift\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFatX\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailCutX\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFade\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.probeX\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.showProbeX\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.xPoints\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.xLogStops\": function() {\n        _this.updateSize();\n      },\n      \"change:ui.chart.yMaxMethod\": function() {\n        _this._adjustMaxY({ force: true });\n        _this.redrawDataPoints();\n      },\n      \"change:time.record\": function(evt) {\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:marker.highlight\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.highlightMarkers();\n        _this.updateOpacity();\n      },\n      \"change:marker.select\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.selectMarkers();\n        _this._selectlist.redraw();\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n        _this.redrawDataPoints();\n        _this._probe.redraw();\n      },\n      \"change:marker.opacitySelectDim\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.opacityRegular\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          _this.zoomToMaxMin();\n          _this.redrawDataPoints();\n          _this._probe.redraw();\n        }\n      },\n      \"change:marker.group\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"group.merge\") > -1) return;\n        _this.ready();\n      },\n      \"change:marker.group.merge\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      },\n      \"change:marker.stack\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.ready();\n      },\n      \"change:marker.stack.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.stack.use\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.redrawDataPointsOnlyColors();\n        _this._selectlist.redraw();\n      },\n    };\n\n    this._super(config, context);\n\n    this._math = new MountainChartMath(this);\n    this._export = new Exporter(this);\n    this._export\n      .prefix(\"vzb-mc-\")\n      .deleteClasses([\"vzb-mc-mountains-mergestacked\", \"vzb-mc-mountains-mergegrouped\", \"vzb-mc-mountains\", \"vzb-mc-year\", \"vzb-mc-mountains-labels\", \"vzb-mc-axis-labels\"]);\n    this._probe = new Probe(this);\n    this._selectlist = new Selectlist(this);\n\n    // define path generator\n    this.area = d3.area()\n      .curve(d3.curveBasis)\n      .x(d => _this.xScale(_this._math.rescale(d.x)))\n      .y0(d => _this.yScale(d.y0))\n      .y1(d => _this.yScale(d.y0 + d.y));\n\n    //define d3 stack layout\n    this.stack = d3.stack()\n      .order(d3.stackOrderReverse)\n      .value((d, key) => _this.cached[key][d].y);\n\n    // init internal variables\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n\n\n    this.rangeRatio = 1;\n    this.rangeShift = 0;\n    this.cached = {};\n    this.mesh = [];\n    this.yMax = 0;\n  },\n\n  domReady() {\n    const _this = this;\n\n    // reference elements\n    this.element = d3.select(this.element);\n    this.graph = this.element.select(\".vzb-mc-graph\");\n    this.xAxisEl = this.graph.select(\".vzb-mc-axis-x\");\n    this.xTitleEl = this.graph.select(\".vzb-mc-axis-x-title\");\n    this.yTitleEl = this.graph.select(\".vzb-mc-axis-y-title\");\n    this.infoEl = this.graph.select(\".vzb-mc-axis-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.yearEl = this.graph.select(\".vzb-mc-year\");\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.mountainMergeStackedContainer = this.graph.select(\".vzb-mc-mountains-mergestacked\");\n    this.mountainMergeGroupedContainer = this.graph.select(\".vzb-mc-mountains-mergegrouped\");\n    this.mountainAtomicContainer = this.graph.select(\".vzb-mc-mountains\");\n    this.mountainLabelContainer = this.graph.select(\".vzb-mc-mountains-labels\");\n    this.tooltip = this.element.select(\".vzb-mc-tooltip\");\n    this.eventAreaEl = this.element.select(\".vzb-mc-eventarea\");\n    this.probeEl = this.element.select(\".vzb-mc-probe\");\n    this.probeLineEl = this.probeEl.select(\"line\");\n    this.probeTextEl = this.probeEl.selectAll(\"text\");\n\n    this.element\n      .onTap((d, i) => {\n        _this._interact()._mouseout(d, i);\n      });\n  },\n\n  afterPreload() {\n    const _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    if (!this.precomputedShape || !this.precomputedShape[0] || !this.precomputedShape[0].income_mountains) return;\n\n    const yMax = this.precomputedShape[0].income_mountains[\"yMax_\" + this.model.ui.chart.yMaxMethod];\n    let shape = this.precomputedShape[0].income_mountains.shape;\n\n    if (!yMax || !shape || shape.length === 0) return;\n\n    this.xScale = d3.scaleLog().domain([this.model.marker.axis_x.domainMin, this.model.marker.axis_x.domainMax]);\n    this.yScale = d3.scaleLinear().domain([0, Math.round(yMax)]);\n\n    _this.updateSize(shape.length);\n    _this.zoomToMaxMin();\n\n    shape = shape.map((m, i) => ({ x: _this.mesh[i], y0: 0, y: +m }));\n\n    this.mountainAtomicContainer.selectAll(\".vzb-mc-prerender\")\n      .data([0])\n      .enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-prerender\")\n      .style(\"fill\", \"pink\")\n      .style(\"opacity\", 0)\n      .attr(\"d\", _this.area(shape))\n      .transition().duration(1000).ease(d3.easeLinear)\n      .style(\"opacity\", 1);\n  },\n\n  readyOnce() {\n\n    this.eventAreaEl\n      .on(\"mousemove\", function() {\n        if (_this.model.time.dragging) return;\n        if (!_this.model.ui.chart.showProbeX) return;\n        _this._probe.redraw({\n          level: _this.xScale.invert(d3.mouse(this)[0]),\n          full: true\n        });\n      })\n      .on(\"mouseout\", () => {\n        if (_this.model.time.dragging) return;\n        if (!_this.model.ui.chart.showProbeX) return;\n        _this._probe.redraw();\n      });\n\n    const _this = this;\n    this.on(\"resize\", () => {\n      //console.log(\"acting on resize\");\n      //return if updatesize exists with error\n      if (_this.updateSize()) return;\n      _this.updatePointers(); // respawn is needed\n      _this.redrawDataPoints();\n      _this._selectlist.redraw();\n      _this._probe.redraw();\n    });\n\n    this.TIMEDIM = this.model.time.getDimension();\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n    this.labelNames = this.model.marker.getLabelHookNames();\n\n    this.mountainAtomicContainer.select(\".vzb-mc-prerender\").remove();\n    this.year.setText(this.model.time.formatDate(this.model.time.value));\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n  },\n\n  ready() {\n    //console.log(\"ready\")\n    const _this = this;\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n    this.labelNames = this.model.marker.getLabelHookNames();\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    this.updateUIStrings();\n    this.updateIndicators();\n    this.model.marker.getFrame(this.model.time.value, values => {\n      if (!values) return;\n      _this.values = values;\n      _this.valuesAggregated = { color: {}, axis_y: {} };\n      \n      _this.model.marker.getFrame(_this.model.time.end, endValues => {\n        _this.updateEntities(endValues);\n        _this.updateSize();\n        _this.zoomToMaxMin();\n        _this._spawnMasks();\n        _this.updateTime();\n        _this.updatePointers();\n        _this._adjustMaxY({ force: true });\n        _this.redrawDataPoints();\n        _this.redrawDataPointsOnlyColors();\n        _this.highlightMarkers();\n        _this.selectMarkers();\n        _this._selectlist.redraw();\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n        _this._probe.redraw();\n      });\n    });\n  },\n\n  frameChanged(frame, time) {\n    if (!frame) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.values = frame;\n    this.updateTime();\n    this.updatePointers();\n    this.redrawDataPoints();\n    this._selectlist.redraw();\n    this._probe.redraw();\n    this.updateDoubtOpacity();\n  },\n\n\n  updateSize(meshLength) {\n    const profiles = {\n      small: {\n        margin: { top: 10, right: 10, left: 10, bottom: 18 },\n        infoElHeight: 16\n      },\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 30 },\n        infoElHeight: 20\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 35 },\n        infoElHeight: 22\n      }\n    };\n\n    const presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 50 },\n        infoElHeight: 26\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 50 },\n        infoElHeight: 32\n      }\n    };\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    const { margin } = this.activeProfile;\n    const { infoElHeight } = this.activeProfile;\n\n    //mesure width and height\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Mountain chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    const isRTL = this.model.locale.isRTL();\n\n    const yearLabelOptions = {\n      topOffset: this.getLayoutProfile() === \"large\" ? margin.top * 2 : 0,\n      xAlign: this.getLayoutProfile() === \"large\" ? (isRTL ? \"left\" : \"right\") : \"center\",\n      yAlign: this.getLayoutProfile() === \"large\" ? \"top\" : \"center\",\n      widthRatio: this.getLayoutProfile() === \"large\" ? 3 / 8 : 8 / 10\n    };\n\n    //year is centered and resized\n    this.year\n      .setConditions(yearLabelOptions)\n      .resize(this.width, this.height);\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n\n    //need to know scale type of X to move on\n    const scaleType = this._readyOnce ? this.model.marker.axis_x.scaleType : \"log\";\n\n    //axis is updated\n    this.xAxis.scale(this.xScale)\n      .tickSizeOuter(0)\n      .tickPadding(9)\n      .tickSizeMinor(3, 0)\n      .labelerOptions({\n        scaleType,\n        toolMargin: margin,\n        pivotingLimit: margin.bottom * 1.5,\n        method: this.xAxis.METHOD_REPEATING,\n        stops: this._readyOnce ? this.model.ui.chart.xLogStops : [1],\n        formatter: this.model.marker.axis_x.getTickFormatter()\n      });\n\n\n    this.xAxisEl\n      .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.xTitleEl.select(\"text\")\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\")\n      .attr(\"dy\", \"-0.36em\");\n\n    this.yTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + margin.top + \")\");\n\n\n    const warnBB = this.dataWarningEl.select(\"text\").node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height)\n      .attr(\"height\", warnBB.height)\n      .attr(\"x\", warnBB.height * 0.1)\n      .attr(\"y\", -warnBB.height * 1.0 + 1);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width - warnBB.width - warnBB.height * 2 : 0) + \",\" + (margin.top + warnBB.height * 1.5) + \")\")\n      .select(\"text\")\n      .attr(\"dx\", warnBB.height * 1.5);\n\n    if (this.infoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.infoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.infoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.eventAreaEl\n      .attr(\"y\", this.height)\n      .attr(\"width\", this.width)\n      .attr(\"height\", margin.bottom);\n\n    if (!meshLength) meshLength = this.model.ui.chart.xPoints;\n    this.mesh = this._math.generateMesh(meshLength, scaleType, this.xScale.domain());\n  },\n\n\n  zoomToMaxMin() {\n    const _this = this;\n    const mdl = this.model.marker.axis_x;\n\n    if (mdl.zoomedMin == null && mdl.domainMin == null || mdl.zoomedMax == null && mdl.domainMin == null) return;\n\n    const x1 = this.xScale(mdl.zoomedMin || mdl.domainMin);\n    const x2 = this.xScale(mdl.zoomedMax || mdl.domainMax);\n    // if we have same x1 and x2 then divider will be 0 and rangeRation will become -Infinity\n    if (!isFinite(x1) || !isFinite(x2) || x1 === x2) return;\n\n    this.rangeRatio = this.width / (x2 - x1) * this.rangeRatio;\n    this.rangeShift = (this.rangeShift - x1) / (x2 - x1) * this.width;\n\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n    this.xAxisEl.call(this.xAxis);\n  },\n\n\n  updateUIStrings() {\n    const _this = this;\n\n    this.translator = this.model.locale.getTFunction();\n    const xConceptprops = this.model.marker.axis_x.getConceptprops();\n\n\n    this.xTitleEl.select(\"text\")\n      .text(this.translator(\"unit/mountainchart_hardcoded_income_per_day\"));\n\n    this.yTitleEl.select(\"text\")\n      .text(this.translator(\"mount/title\"));\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.infoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.infoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.infoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.infoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this.updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this.updateDoubtOpacity();\n      });\n  },\n\n  updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.time.getUTCFullYear().toString());\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  updateIndicators() {\n    const _this = this;\n\n    //fetch scales, or rebuild scales if there are none, then fetch\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.cScale = this.model.marker.color.getScale();\n\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n\n  updateEntities(values = this.values) {\n    const _this = this;\n    const dataKeys = this.dataKeys;\n\n    // construct pointers\n    this.mountainPointers = this.model.marker.getKeys()\n      .filter(d => 1\n      && values.axis_x[utils.getKey(d, dataKeys.axis_x)]\n      && values.axis_y[utils.getKey(d, dataKeys.axis_y)]\n      && values.axis_s[utils.getKey(d, dataKeys.axis_s)])\n      .map(d => {\n        const pointer = {};\n        pointer._keys = d;\n        pointer.KEYS = function() {\n          return this._keys;\n        };\n        pointer._key = utils.getKey(d, _this.KEYS);\n        pointer.KEY = function() {\n          return this._key;\n        };\n        pointer.sortValue = [values.axis_y[utils.getKey(d, dataKeys.axis_y)] || 0, 0];\n        pointer.aggrLevel = 0;\n        return pointer;\n      });\n\n\n    //TODO: optimise this!\n    this.groupedPointers = d3.nest()\n      .key(d => _this.model.marker.stack.use === \"property\" ? values.stack[utils.getKey(d.KEYS(), dataKeys.stack)] : values.group[utils.getKey(d.KEYS(), dataKeys.group)])\n      .sortValues((a, b) => b.sortValue[0] - a.sortValue[0])\n      .entries(this.mountainPointers);\n\n\n    const groupManualSort = this.model.marker.group.manualSorting;\n    const isManualSortCorrect = utils.isArray(groupManualSort) && groupManualSort.length > 1;\n    this.groupedPointers.forEach(group => {\n      const groupSortValue = isManualSortCorrect ?\n        groupManualSort.includes(group.key) ?\n          groupManualSort.length - 1 - groupManualSort.indexOf(group.key) :\n          -1 :\n        d3.sum(group.values.map(m => m.sortValue[0]));\n\n      group.values.forEach(d => {\n        d.sortValue[1] = groupSortValue;\n      });\n\n      group._keys = { [_this.KEY]: group.key }; // hack to get highlihgt and selection work\n      group.KEYS = function() {\n        return this._keys;\n      };\n      group.KEY = function() {\n        return this.key;\n      };\n      group.aggrLevel = 1;\n    });\n\n    const sortGroupKeys = {};\n    _this.groupedPointers.forEach(m => {\n      sortGroupKeys[m.key] = m.values[0].sortValue[1];\n    });\n\n\n    // update the stacked pointers\n    if (_this.model.marker.stack.which === \"none\") {\n      this.stackedPointers = [];\n      this.mountainPointers.sort((a, b) => b.sortValue[0] - a.sortValue[0]);\n\n    } else {\n      this.stackedPointers = d3.nest()\n        .key(d => values.stack[utils.getKey(d.KEYS(), dataKeys.stack)])\n        .key(d => values.group[utils.getKey(d.KEYS(), dataKeys.group)])\n        .sortKeys((a, b) => sortGroupKeys[b] - sortGroupKeys[a])\n        .sortValues((a, b) => b.sortValue[0] - a.sortValue[0])\n        .entries(this.mountainPointers);\n\n      this.mountainPointers.sort((a, b) => b.sortValue[1] - a.sortValue[1]);\n\n\n      this.stackedPointers.forEach(stack => {\n        stack._keys = { [_this.KEY]: stack.key }; // hack to get highlihgt and selection work\n        stack.KEYS = function() {\n          return this._keys;\n        };\n        stack.KEY = function() {\n          return this.key;\n        };\n          stack.aggrLevel = 2;\n      });\n    }\n\n    //bind the data to DOM elements\n    this.mountainsMergeStacked = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel2\")\n      .data(this.stackedPointers);\n    this.mountainsMergeGrouped = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel1\")\n      .data(this.groupedPointers);\n    this.mountainsAtomic = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel0\")\n      .data(this.mountainPointers);\n\n    //exit selection -- remove shapes\n    this.mountainsMergeStacked.exit().remove();\n    this.mountainsMergeGrouped.exit().remove();\n    this.mountainsAtomic.exit().remove();\n\n    //enter selection -- add shapes\n    this.mountainsMergeStacked = this.mountainsMergeStacked.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel2\")\n      .merge(this.mountainsMergeStacked);\n    this.mountainsMergeGrouped = this.mountainsMergeGrouped.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel1\")\n      .merge(this.mountainsMergeGrouped);\n    this.mountainsAtomic = this.mountainsAtomic.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel0\")\n      .merge(this.mountainsAtomic);\n\n    //add interaction\n    this.mountains = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain\");\n\n    this.mountains\n      .on(\"mousemove\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mousemove(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._click(d, i);\n        _this.highlightMarkers();\n      })\n      .onTap((d, i) => {\n        _this._interact()._click(d, i);\n        d3.event.stopPropagation();\n      })\n      .onLongTap((d, i) => {\n      });\n  },\n\n  _getLabelText(values, labelNames, d) {\n    return this.KEYS.map(key => values[labelNames[key]] ? values[labelNames[key]][d[key]] : d[key]).join(\", \");\n  },\n\n  _interact() {\n    const _this = this;\n\n    return {\n      _mousemove(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this.model.marker.highlightMarker(d.KEYS());\n\n        const mouse = d3.mouse(_this.graph.node()).map(d => parseInt(d));\n\n        //position tooltip\n        _this._setTooltip(d.key ? _this.model.marker.color.getColorlegendMarker().label.getItems()[d.key] : _this._getLabelText(_this.values, _this.labelNames, d.KEYS()));\n        _this._selectlist.showCloseCross(d, true);\n\n      },\n      _mouseout(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this._setTooltip(\"\");\n        _this.model.marker.clearHighlighted();\n        _this._selectlist.showCloseCross(d, false);\n\n      },\n      _click(d) {\n        const isPlayingOrDragging = _this.model.time.dragging || _this.model.time.playing;\n        if (!isPlayingOrDragging || _this.model.marker.isSelected(d.KEYS())) {\n          _this.model.marker.selectMarker(d.KEYS());\n        }\n      }\n    };\n\n  },\n\n  highlightMarkers() {\n    const _this = this;\n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    if (!this.selectList || !this.someSelected) return;\n    this.selectList.classed(\"vzb-highlight\", d => _this.model.marker.isHighlighted(d));\n\n  },\n\n  selectMarkers() {\n    const _this = this;\n    this.someSelected = (this.model.marker.select.length > 0);\n\n    this._selectlist.rebuild();\n    this.nonSelectedOpacityZero = false;\n  },\n\n  _sumLeafPointersByMarker(branch, marker) {\n    const _this = this;\n    if (!branch.key) return _this.values[marker][utils.getKey(branch.KEYS(), _this.dataKeys[marker])];\n    return d3.sum(branch.values.map(m => _this._sumLeafPointersByMarker(m, marker)));\n  },\n\n  updateOpacity() {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = 0.3;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.mountains.style(\"opacity\", d => {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d.KEYS())) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d.KEYS()) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n\n    });\n\n    this.mountains.classed(\"vzb-selected\", d => _this.model.marker.isSelected(d.KEYS()));\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero !== this.nonSelectedOpacityZero) {\n      this.mountainsAtomic.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d.KEYS())) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  },\n\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time), this.duration);\n  },\n\n  updatePointers() {\n    const _this = this;\n    this.yMax = 0;\n\n\n    //spawn the original mountains\n    this.mountainPointers.forEach((d, i) => {\n      const vertices = _this._spawn(_this.values, _this.dataKeys, d);\n      _this.cached[d.KEY()] = vertices;\n      d.hidden = vertices.length === 0;\n    });\n\n\n    //recalculate stacking\n    if (_this.model.marker.stack.which !== \"none\") {\n      this.stackedPointers.forEach(group => {\n        let toStack = [];\n        group.values.forEach(subgroup => {\n          toStack = toStack.concat(subgroup.values.filter(f => !f.hidden));\n        });\n        _this.stack.keys(toStack.map(d => d.KEY()))(d3.range(_this.mesh.length))\n          .forEach((vertices, keyIndex) => {\n            const key = toStack[keyIndex].KEY();\n            vertices.forEach((d, verticesIndex) => {\n              _this.cached[key][verticesIndex].y0 = d[0];\n            });\n          });\n      });\n    }\n\n    this.mountainPointers.forEach(d => {\n      d.valuesPointer = _this.values;\n      d.yMax = d3.max(_this.cached[d.KEY()].map(m => m.y0 + m.y));\n      if (_this.yMax < d.yMax) _this.yMax = d.yMax;\n    });\n\n    const mergeGrouped = _this.model.marker.group.merge;\n    const mergeStacked = _this.model.marker.stack.merge;\n    //var dragOrPlay = (_this.model.time.dragging || _this.model.time.playing) && this.model.marker.stack.which !== \"none\";\n\n    //if(mergeStacked){\n    this.stackedPointers.forEach(d => {\n      d.valuesPointer = _this.valuesAggregated;\n      const firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = \"_default\";\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //} else if (mergeGrouped || dragOrPlay){\n    this.groupedPointers.forEach(d => {\n      d.valuesPointer = _this.valuesAggregated;\n      const firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = _this.values.color[firstLast.first.KEY()];\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //}\n\n    if (!mergeStacked && !mergeGrouped && this.model.marker.stack.use === \"property\") {\n      this.groupedPointers.forEach(d => {\n        const visible = d.values.filter(f => !f.hidden);\n        d.yMax = visible[0].yMax;\n        d.values.forEach(e => {\n          e.yMaxGroup = d.yMax;\n        });\n      });\n    }\n\n\n  },\n\n  _getFirstLastPointersInStack(group) {\n    let visible, visible2;\n    let first, last;\n\n    if (group.values[0].values) {\n      visible = group.values[0].values.filter(f => !f.hidden);\n      visible2 = group.values[group.values.length - 1].values.filter(f => !f.hidden);\n      first = visible[0];\n      last = visible2[visible2.length - 1];\n    } else {\n      visible = group.values.filter(f => !f.hidden);\n      first = visible[0];\n      last = visible[visible.length - 1];\n    }\n\n    if (!visible.length || (visible2 && !visible2.length)) utils.warn(\"mountain chart failed to generate shapes. check the incoming data\");\n\n    return {\n      first,\n      last\n    };\n  },\n\n  _getVerticesOfaMergedShape(arg) {\n    const _this = this;\n\n    const first = arg.first.KEY();\n    const last = arg.last.KEY();\n\n    return _this.mesh.map((m, i) => {\n      const y = _this.cached[first][i].y0 + _this.cached[first][i].y - _this.cached[last][i].y0;\n      const y0 = _this.cached[last][i].y0;\n      return {\n        x: m,\n        y0,\n        y\n      };\n    });\n  },\n\n  _spawnMasks() {\n    const _this = this;\n\n    const tailFatX = this._math.unscale(this.model.marker.axis_x.tailFatX);\n    const tailCutX = this._math.unscale(this.model.marker.axis_x.tailCutX);\n    const tailFade = this.model.marker.axis_x.tailFade;\n    const k = 2 * Math.PI / (Math.log(tailFatX) - Math.log(tailCutX));\n    const m = Math.PI - Math.log(tailFatX) * k;\n\n\n    this.spawnMask = [];\n    this.cosineShape = [];\n    this.cosineArea = 0;\n\n    this.mesh.forEach((dX, i) => {\n      _this.spawnMask[i] = dX < tailCutX ? 1 : (dX > tailFade * 7 ? 0 : Math.exp((tailCutX - dX) / tailFade));\n      _this.cosineShape[i] = (dX > tailCutX && dX < tailFatX ? (1 + Math.cos(Math.log(dX) * k + m)) : 0);\n      _this.cosineArea += _this.cosineShape[i];\n    });\n  },\n\n  _spawn(values, dataKeys, d) {\n    const _this = this;\n\n    const norm = values.axis_y[utils.getKey(d.KEYS(), dataKeys.axis_y)];\n    const sigma = _this.model.ui.chart.directSigma ?\n      values.axis_s[utils.getKey(d.KEYS(), dataKeys.axis_s)] :\n      _this._math.giniToSigma(values.axis_s[utils.getKey(d.KEYS(), dataKeys.axis_s)]);\n    \n    const mu = _this.model.ui.chart.directMu ?\n      values.axis_x[utils.getKey(d.KEYS(), dataKeys.axis_x)] :\n      _this._math.gdpToMu(values.axis_x[utils.getKey(d.KEYS(), dataKeys.axis_x)], sigma);\n\n    if (!norm || !mu || !sigma) return [];\n\n    const distribution = [];\n    let acc = 0;\n\n    this.mesh.forEach((dX, i) => {\n      distribution[i] = _this._math.pdf.lognormal(dX, mu, sigma);\n      acc += _this.spawnMask[i] * distribution[i];\n    });\n\n    const result = this.mesh.map((dX, i) => ({\n      x: dX,\n      y0: 0,\n      y: norm * (distribution[i] * (1 - _this.spawnMask[i]) + _this.cosineShape[i] / _this.cosineArea * acc)\n    }));\n\n    return result;\n  },\n\n  _adjustMaxY(options) {\n    if (!options) options = {};\n    const _this = this;\n    const method = this.model.ui.chart.yMaxMethod;\n\n    if (method !== \"immediate\" && !options.force) return;\n    if (method === \"latest\") {\n      const prevValues = _this.values;\n      _this.model.marker.getFrame(_this.model.time.end, values => {\n        if (!values) return;\n\n        //below is a complicated issue when updatePointers() is first calculated for one set of values (at the end of time series), then yMax is taken from that data (assuming that population always grows, so the last year has the highest mountain)\n        _this.values = values;\n        _this.updatePointers();\n\n        //after that updatePointers() is called with the actual data of the current time point\n        _this.values = prevValues;\n        _this.yScale.domain([0, Math.round(_this.yMax)]);\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      });\n    } else {\n      if (!_this.yMax) utils.warn(\"Setting yMax to \" + _this.yMax + \". You failed again :-/\");\n      _this.yScale.domain([0, Math.round(_this.yMax)]);\n    }\n  },\n\n  redrawDataPoints() {\n    const _this = this;\n    const mergeGrouped = this.model.marker.group.merge;\n    const mergeStacked = this.model.marker.stack.merge;\n    const stackMode = this.model.marker.stack.which;\n    //it's important to know if the chart is dragging or playing at the moment.\n    //because if that is the case, the mountain chart will merge the stacked entities to save performance\n    const dragOrPlay = (this.model.time.dragging || this.model.time.playing)\n      //never merge when no entities are stacked\n      && stackMode !== \"none\";\n\n    this._adjustMaxY();\n\n    this.mountainsMergeStacked.each(function(d) {\n      const view = d3.select(this);\n      const hidden = !mergeStacked;\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsMergeGrouped.each(function(d) {\n      const view = d3.select(this);\n      const hidden = (!mergeGrouped && !dragOrPlay) || (mergeStacked && !_this.model.marker.isSelected(d));\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsAtomic.each(function(d, i) {\n      const view = d3.select(this);\n      const hidden = d.hidden || ((mergeGrouped || mergeStacked || dragOrPlay) && !_this.model.marker.isSelected(d));\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    if (stackMode === \"none\") {\n      this.mountainsAtomic.sort((a, b) => b.yMax - a.yMax);\n\n    } else if (stackMode === \"all\") {\n      // do nothing if everything is stacked\n\n    } else {\n      if (mergeGrouped || dragOrPlay) {\n        // this.mountainsMergeGrouped.sort(function (a, b) {\n        //     return b.yMax - a.yMax;\n        // });\n      } else {\n        this.mountainsAtomic.sort((a, b) => b.yMaxGroup - a.yMaxGroup);\n      }\n    }\n\n\n    // exporting shapes for shape preloader. is needed once in a while\n    // if (!this.shapes) this.shapes = {}\n    // this.shapes[this.model.time.value.getUTCFullYear()] = {\n    //     yMax: d3.format(\".2e\")(_this.yMax),\n    //     shape: _this.cached[\"all\"].map(function (d) {return d3.format(\".2e\")(d.y);})\n    // }\n\n  },\n\n  redrawDataPointsOnlyColors() {\n    const _this = this;\n    if (!this.mountains) return utils.warn(\"redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!\");\n    const isColorUseIndicator = this.model.marker.color.use === \"indicator\";\n    this.mountains.style(\"fill\", d => {\n      const color = d.valuesPointer.color[utils.getKey(d.KEYS(), _this.dataKeys.color)];\n      return color ? (isColorUseIndicator && color == \"_default\" ? _this.model.marker.color.palette[\"_default\"] : _this.cScale(color)) : COLOR_WHITEISH;\n    });\n  },\n\n  _renderShape(view, key, hidden) {\n    const stack = this.model.marker.stack.which;\n    const _this = this;\n    const valuesPointer = view.datum().valuesPointer;\n\n    view.classed(\"vzb-hidden\", hidden);\n\n    if (hidden) {\n      if (stack !== \"none\") view.style(\"stroke-opacity\", 0);\n      return;\n    }\n\n    const filter = {};\n    filter[this.KEY] = key;\n    if (this.model.marker.isSelected(filter)) {\n      view.attr(\"d\", this.area(this.cached[key].filter(f => f.y > valuesPointer.axis_y[key] * THICKNESS_THRESHOLD)));\n    } else {\n      view.attr(\"d\", this.area(this.cached[key]));\n    }\n\n    //color use indicator suggests that this should be updated on every timeframe\n    if (this.model.marker.color.use === \"indicator\") {\n      view.style(\"fill\", valuesPointer.color[key] ?\n        (\n          valuesPointer.color[key] !== \"_default\" ?\n            _this.cScale(valuesPointer.color[key])\n            :\n            _this.model.marker.color.palette[\"_default\"]\n        )\n        :\n        COLOR_WHITEISH\n      );\n    }\n\n    if (stack !== \"none\") view\n      .transition().duration(Math.random() * 900 + 100).ease(d3.easeCircle)\n      .style(\"stroke-opacity\", 0.5);\n\n    if (this.model.time.record) this._export.write({\n      type: \"path\",\n      id: key,\n      time: this.model.time.value.getUTCFullYear(),\n      fill: this.cScale(valuesPointer.color[key]),\n      d: this.area(this.cached[key])\n    });\n  },\n\n  _setTooltip(tooltipText) {\n    if (tooltipText) {\n      const mouse = d3.mouse(this.graph.node()).map(d => parseInt(d));\n\n      //position tooltip\n      this.tooltip.classed(\"vzb-hidden\", false)\n        .attr(\"transform\", \"translate(\" + (mouse[0]) + \",\" + (mouse[1]) + \")\")\n        .selectAll(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"alignment-baseline\", \"middle\")\n        .text(tooltipText);\n\n      const contentBBox = this.tooltip.select(\"text\").node().getBBox();\n\n      this.tooltip.select(\"rect\")\n        .attr(\"width\", contentBBox.width + 8)\n        .attr(\"height\", contentBBox.height + 8)\n        .attr(\"x\", -contentBBox.width - 25)\n        .attr(\"y\", -contentBBox.height - 25)\n        .attr(\"rx\", contentBBox.height * 0.2)\n        .attr(\"ry\", contentBBox.height * 0.2);\n\n      this.tooltip.selectAll(\"text\")\n        .attr(\"x\", -contentBBox.width - 25 + ((contentBBox.width + 8) / 2))\n        .attr(\"y\", -contentBBox.height - 25 + ((contentBBox.height + 11) / 2)); // 11 is 8 for margin + 3 for strokes\n      const translateX = (mouse[0] - contentBBox.width - 25) > 0 ? mouse[0] : (contentBBox.width + 25);\n      const translateY = (mouse[1] - contentBBox.height - 25) > 0 ? mouse[1] : (contentBBox.height + 25);\n      this.tooltip\n        .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")\");\n\n    } else {\n\n      this.tooltip.classed(\"vzb-hidden\", true);\n    }\n  },\n\n  preload() {\n    const _this = this;\n    \n    const preload = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preload\"]);\n    const preloadKey = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preloadKey\"]);\n    if(!preload) return Promise.resolve();\n    \n    const KEY = this.model.marker._getFirstDimension({ exceptType: \"time\" });\n    const TIMEDIM = this.model.time.dim;\n\n    //build a query to the reader to fetch preload info\n    const query = {\n      language: this.model.locale.id,\n      from: \"datapoints\",\n      select: {\n        key: [KEY, TIMEDIM],\n        value: [preload]\n      },\n      where: { $and: [\n        { [KEY]: \"$\" + KEY },\n        { [TIMEDIM]: \"$\" + TIMEDIM }\n      ] },\n      join: {\n        [\"$\" + KEY]: { key: KEY, where: { [KEY]: { $in: [preloadKey||\"world\"] } } },\n        [\"$\" + TIMEDIM]: { key: TIMEDIM, where: { [TIMEDIM]: this.model.time.formatDate(this.model.time.value) } }\n      },\n      order_by: [TIMEDIM]\n    };\n    \n    return new Promise((resolve, reject) => {\n\n      const dataPromise = this.model.data.load(query, {[preload]: d => JSON.parse(d)});\n\n      dataPromise.then(\n        function(dataId){\n          _this.precomputedShape = _this.model.data.getData(dataId);\n          resolve();\n        },\n        err => utils.warn(\"Problem with Preload mountainchart query: \", err, JSON.stringify(query))\n      );\n    });\n  }\n\n});\n\nexport default MountainChartComponent;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","/*\n * Axes dialog\n */\n\nconst Axes = Vizabi.Component.get(\"_dialog\").extend(\"axesmc\", {\n\n  /**\n   * Initializes the dialog component\n   * @param config component configuration\n   * @param context component context (parent)\n   */\n  init(config, parent) {\n    this.name = \"axesmc\";\n    const _this = this;\n\n    this.model_binds = {\n      \"change:ui.chart.xLogStops\": function() {\n        _this.updateView();\n      },\n      \"change:ui.chart.yMaxMethod\": function() {\n        _this.updateView();\n      }\n    };\n\n    this.components = [{\n      component: Vizabi.Component.get(\"minmaxinputs\"),\n      placeholder: \".vzb-xlimits-container\",\n      model: [\"state.marker\", \"state.time\", \"locale\"],\n      markerID: \"axis_x\",\n      ui: {\n        selectDomainMinMax: false,\n        selectZoomedMinMax: true\n      }\n    }];\n\n\n    this._super(config, parent);\n    this.template = require(\"./axesmc.html\");\n  },\n\n  readyOnce() {\n    this._super();\n\n    const _this = this;\n\n    this.yMaxRadio = this.element.select(\".vzb-yaxis-container\").selectAll(\"input\")\n      .on(\"change\", function() {\n        _this.setModel(\"yMaxMethod\", d3.select(this).node().value);\n      });\n\n    this.xLogStops = this.element.select(\".vzb-xaxis-container\").selectAll(\"input\")\n      .on(\"change\", function() {\n        _this.setModel(\"xLogStops\", d3.select(this).node().value);\n      });\n\n    this.probeCheck = this.element.select(\".vzb-probe-check\")\n      .on(\"change\", function() {\n        _this.setModel(\"showProbeX\", d3.select(this).property(\"checked\"));\n      });\n\n    this.probeFieldEl = this.element.select(\".vzb-probe-field\")\n      .on(\"change\", function() {\n        let result = parseFloat(this.value.replace(\",\", \".\"));\n        if (!result || result <= _this.model.state.marker.axis_x.tailCutX) {\n          this.value = _this.model.ui.chart.probeX;\n          return;\n        } else if (result > _this.model.state.marker.axis_x.domainMax) {\n          result = _this.model.state.marker.axis_x.domainMax;\n        }\n        this.value = result;\n        _this.setModel(\"probeX\", result);\n      });\n\n    this.updateView();\n\n  },\n\n  updateView() {\n    const _this = this;\n\n    this.yMaxRadio.property(\"checked\", function() {\n      return d3.select(this).node().value === _this.model.ui.chart.yMaxMethod;\n    });\n    this.xLogStops.property(\"checked\", function() {\n      return _this.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value) !== -1;\n    });\n    this.probeCheck.property(\"checked\", this.model.ui.chart.showProbeX);\n    this.probeFieldEl.property(\"value\", this.model.ui.chart.probeX);\n  },\n\n  setModel(what, value) {\n    let result;\n\n    if (what == \"yMaxMethod\") {\n      result = value;\n    }\n    if (what == \"xLogStops\") {\n      result = [];\n      this.xLogStops.each(function() {\n        if (d3.select(this).property(\"checked\")) result.push(+d3.select(this).node().value);\n      });\n    }\n    if (what == \"probeX\" || what == \"showProbeX\") {\n      result = value;\n    }\n\n    this.model.ui.chart[what] = result;\n  }\n});\n\nexport default Axes;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dialogs/axesmc/axesmc.js","const { utils } = Vizabi;\n\nconst MCMath = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n    this.xScaleFactor = 1;\n    this.xScaleShift = 0;\n  },\n\n  rescale(x) {\n    return Math.exp(this.xScaleFactor * Math.log(x) + this.xScaleShift);\n  },\n  unscale(x) {\n    return Math.exp((Math.log(x) - this.xScaleShift) / this.xScaleFactor);\n  },\n\n  generateMesh(length, scaleType, domain) {\n    // span a uniform mesh across the entire X scale\n    // if the scale is log, the mesh would be exponentially distorted to look uniform\n\n    const rangeFrom = scaleType === \"linear\" ? domain[0]\n      : Math.log(this.unscale(domain[0]));\n\n    const rangeTo = scaleType === \"linear\" ? domain[1]\n      : Math.log(this.unscale(domain[1]));\n\n    const rangeStep = (rangeTo - rangeFrom) / length;\n\n    let mesh = d3.range(rangeFrom, rangeTo, rangeStep).concat(rangeTo);\n\n    if (scaleType !== \"linear\") {\n      mesh = mesh.map(dX => Math.exp(dX));\n    } else {\n      mesh = mesh.filter(dX => dX > 0);\n    }\n\n    return mesh;\n  },\n\n  gdpToMu(gdp, sigma, xScaleFactor, xScaleShift) {\n    // converting gdp per capita per day into MU for lognormal distribution\n    // see https://en.wikipedia.org/wiki/Log-normal_distribution\n    return Math.log(gdp / 365) - sigma * sigma / 2;\n  },\n\n  giniToSigma(gini) {\n    // The ginis are turned into std deviation.\n    // Mattias uses this formula in Excel: stddev = NORMSINV( ((gini/100)+1)/2 )*2^0.5\n    return this.normsinv(((gini / 100) + 1) / 2) * Math.pow(2, 0.5);\n  },\n\n  // this function returns PDF values for a specified distribution\n  pdf: {\n    normal(x, mu, sigma) {\n      return Math.exp(\n        -0.5 * Math.log(2 * Math.PI)\n        - Math.log(sigma)\n        - Math.pow(x - mu, 2) / (2 * sigma * sigma)\n      );\n    },\n    lognormal(x, mu, sigma) {\n      return Math.exp(\n        -0.5 * Math.log(2 * Math.PI) //should not be different for the two scales- (scaleType==\"linear\"?Math.log(x):0)\n        - Math.log(sigma)\n        - Math.pow(Math.log(x) - mu, 2) / (2 * sigma * sigma)\n      );\n    }\n  },\n\n\n  normsinv(p) {\n    //\n    // Lower tail quantile for standard normal distribution function.\n    //\n    // This function returns an approximation of the inverse cumulative\n    // standard normal distribution function.  I.e., given P, it returns\n    // an approximation to the X satisfying P = Pr{Z <= X} where Z is a\n    // random variable from the standard normal distribution.\n    //\n    // The algorithm uses a minimax approximation by rational functions\n    // and the result has a relative error whose absolute value is less\n    // than 1.15e-9.\n    //\n    // Author:      Peter John Acklam\n    // (Javascript version by Alankar Misra @ Digital Sutras (alankar@digitalsutras.com))\n    // Time-stamp:  2003-05-05 05:15:14\n    // E-mail:      pjacklam@online.no\n    // WWW URL:     http://home.online.no/~pjacklam\n\n    // Taken from http://home.online.no/~pjacklam/notes/invnorm/index.html\n    // adapted from Java code\n\n    // An algorithm with a relative error less than 1.15*10-9 in the entire region.\n\n    // Coefficients in rational approximations\n    const a = [-3.969683028665376e+01, 2.209460984245205e+02, -2.759285104469687e+02, 1.383577518672690e+02, -3.066479806614716e+01, 2.506628277459239e+00];\n    const b = [-5.447609879822406e+01, 1.615858368580409e+02, -1.556989798598866e+02, 6.680131188771972e+01, -1.328068155288572e+01];\n    const c = [-7.784894002430293e-03, -3.223964580411365e-01, -2.400758277161838e+00, -2.549732539343734e+00, 4.374664141464968e+00, 2.938163982698783e+00];\n    const d = [7.784695709041462e-03, 3.224671290700398e-01, 2.445134137142996e+00, 3.754408661907416e+00];\n\n    // Define break-points.\n    const plow = 0.02425;\n    const phigh = 1 - plow;\n\n    // Rational approximation for lower region:\n    if (p < plow) {\n      const q = Math.sqrt(-2 * Math.log(p));\n      return (((((c[0] * q + c[1]) * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) /\n        ((((d[0] * q + d[1]) * q + d[2]) * q + d[3]) * q + 1);\n    }\n\n    // Rational approximation for upper region:\n    if (phigh < p) {\n      const q = Math.sqrt(-2 * Math.log(1 - p));\n      return -(((((c[0] * q + c[1]) * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) /\n        ((((d[0] * q + d[1]) * q + d[2]) * q + d[3]) * q + 1);\n    }\n\n    // Rational approximation for central region:\n    const q = p - 0.5;\n    const r = q * q;\n    return (((((a[0] * r + a[1]) * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * q /\n      (((((b[0] * r + b[1]) * r + b[2]) * r + b[3]) * r + b[4]) * r + 1);\n\n  }\n\n\n});\n\nexport default MCMath;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-math.js","const { utils } = Vizabi;\n\nconst MCProbe = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n  },\n\n  redraw(options) {\n    const _this = this.context;\n    if (!options) options = {};\n\n    if (!options.level) options.level = _this.model.ui.chart.probeX;\n\n    _this.probeEl.classed(\"vzb-hidden\", !options.level || !_this.model.ui.chart.showProbeX);\n    if (!options.level) return;\n\n    _this.xAxisEl.call(_this.xAxis.highlightValue(options.full ? options.level : \"none\"));\n\n    let sumValue = 0;\n    let totalArea = 0;\n    let leftArea = 0;\n\n    const _computeAreas = function(d) {\n      sumValue += d.valuesPointer.axis_y[utils.getKey(d.KEYS(), _this.dataKeys.axis_y)];\n      _this.cached[d.KEY()].forEach(d => {\n        totalArea += d.y;\n        if (_this._math.rescale(d.x) < options.level) leftArea += d.y;\n      });\n    };\n\n    if (_this.model.marker.stack.which === \"all\") {\n      _this.stackedPointers.forEach(_computeAreas);\n    } else if (_this.model.marker.stack.which === \"none\") {\n      _this.mountainPointers.forEach(_computeAreas);\n    } else {\n      _this.groupedPointers.forEach(_computeAreas);\n    }\n\n    const formatter1 = d3.format(\".3r\");\n    const formatter2 = _this.model.marker.axis_y.getTickFormatter();\n    _this.heightOfLabels = _this.heightOfLabels || (0.66 * _this.height);\n\n    _this.probeTextEl.each(function(d, i) {\n      if (i !== 8) return;\n      const view = d3.select(this);\n\n      if (!options.full && _this.model.ui.chart.probeX == _this.model.marker.axis_x.tailFatX) {\n\n        view.text(_this.translator(\"mount/extremepoverty\"))\n          .classed(\"vzb-hidden\", false)\n          .attr(\"x\", -_this.height)\n          .attr(\"y\", _this.xScale(options.level))\n          .attr(\"dy\", \"-1.15em\")\n          .attr(\"dx\", \"0.5em\")\n          .attr(\"transform\", \"rotate(-90)\");\n\n        _this.heightOfLabels = _this.height - view.node().getBBox().width - view.node().getBBox().height * 1.75;\n      } else {\n        view.classed(\"vzb-hidden\", true);\n      }\n    });\n\n\n    _this.probeTextEl.each(function(d, i) {\n      if (i === 8) return;\n      const view = d3.select(this);\n\n      let string;\n      if (i === 0 || i === 4) string = formatter1(leftArea / totalArea * 100) + \"%\";\n      if (i === 1 || i === 5) string = formatter1(100 - leftArea / totalArea * 100) + \"%\";\n      if (i === 2 || i === 6) string = formatter2(sumValue * leftArea / totalArea);\n      if (i === 3 || i === 7) string = formatter2(sumValue * (1 - leftArea / totalArea)) + \" \" + _this.translator(\"mount/people\");\n\n      view.text(string)\n        .classed(\"vzb-hidden\", !options.full && (_this.someSelected || (i !== 0 && i !== 4)))\n        .attr(\"x\", _this.xScale(options.level) + ([0, 4, 2, 6].indexOf(i) > -1 ? -6 : +5))\n        .attr(\"y\", _this.heightOfLabels)\n        .attr(\"dy\", [0, 1, 4, 5].indexOf(i) > -1 ? 0 : \"1.5em\");\n    });\n\n\n    _this.probeLineEl\n      .attr(\"x1\", _this.xScale(options.level))\n      .attr(\"x2\", _this.xScale(options.level))\n      .attr(\"y1\", _this.height + 6)\n      .attr(\"y2\", 0);\n\n\n  },\n\n\n});\n\nexport default MCProbe;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-probe.js","const { \n  utils,\n  iconset: {\n    close: iconClose\n  }\n} = Vizabi;\n\nconst MCSelectList = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n  },\n\n  rebuild(data) {\n    const _this = this.context;\n    const _local = this;\n\n    const listData = _this.mountainPointers\n      .concat(_this.groupedPointers)\n      .concat(_this.stackedPointers)\n      .filter(f => _this.model.marker.isSelected(f.KEYS())).sort((a, b) => {\n        if (a.sortValue && b.sortValue) {\n          if (a.sortValue[1] === b.sortValue[1]) {\n            return d3.descending(a.sortValue[0], b.sortValue[0]);\n          }\n          return d3.descending(a.sortValue[1], b.sortValue[1]);\n        }\n\n        if (a.aggrLevel != b.aggrLevel) {\n          return d3.descending(a.aggrLevel, b.aggrLevel);\n        } else if (a.aggrLevel && b.aggrLevel) {\n          return d3.descending(a.yMax, b.yMax);\n        }\n\n        return 0;\n      });\n    _this.selectList = _this.mountainLabelContainer.selectAll(\"g.vzb-mc-label\")\n      .data(utils.unique(listData, d => d.KEY()));\n    _this.selectList.exit().remove();\n    _this.selectList = _this.selectList.enter().append(\"g\")\n      .attr(\"class\", \"vzb-mc-label\")\n      .each(function(d, i) {\n        const label = d3.select(this);\n        label.append(\"circle\").attr(\"class\", \"vzb-mc-label-legend\");\n        label.append(\"text\").attr(\"class\", \"vzb-mc-label-shadow vzb-mc-label-text\");\n        label.append(\"text\").attr(\"class\", \"vzb-mc-label-text\");\n        label.append(\"g\").attr(\"class\", \"vzb-mc-label-x vzb-label-shadow vzb-invisible\")\n          .on(\"click\", (d, i) => {\n            if (utils.isTouchDevice()) return;\n            d3.event.stopPropagation();\n            _this.model.marker.clearHighlighted();\n            _this.model.marker.selectMarker(d.KEYS());\n            d3.event.stopPropagation();\n          })\n          .onTap((d, i) => {\n            //d3.select(\"#\" + d.geo + \"-label-\" + _this._id).remove();\n            _this.model.marker.clearHighlighted();\n            _this.model.marker.selectMarker(d.KEYS());\n          });\n        const labelCloseGroup = label.select(\"g.vzb-mc-label-x\");\n        if (!utils.isTouchDevice()) {\n          utils.setIcon(labelCloseGroup, iconClose)\n            .select(\"svg\")\n            .attr(\"class\", \"vzb-mc-label-x-icon\")\n            .attr(\"width\", \"0px\")\n            .attr(\"height\", \"0px\");\n\n          labelCloseGroup.insert(\"circle\", \"svg\");\n\n        } else {\n          labelCloseGroup.append(\"rect\");\n          labelCloseGroup.append(\"text\")\n            .attr(\"class\", \"vzb-mc-label-x-text\")\n            .text(\"Deselect\");\n        }\n      })\n      .on(\"mousemove\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _local.showCloseCross(d, true);\n        _this.model.marker.highlightMarker(d.KEYS());\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _local.showCloseCross(d, false);\n        _this.model.marker.clearHighlighted();\n\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n        _this.model.marker.selectMarker(d.KEYS());\n      })\n      .merge(_this.selectList);\n  },\n\n  redraw() {\n    const _this = this.context;\n    const dataKeys = _this.dataKeys;\n\n    if (!_this.selectList || !_this.someSelected) return;\n\n    const sample = _this.mountainLabelContainer.append(\"g\").attr(\"class\", \"vzb-mc-label\").append(\"text\").text(\"0\");\n    let fontHeight = sample.node().getBBox().height * 1.2;\n    const fontSizeToFontHeight = parseFloat(sample.style(\"font-size\")) / fontHeight;\n    d3.select(sample.node().parentNode).remove();\n    const formatter = _this.model.marker.axis_y.getTickFormatter();\n\n    const titleHeight = _this.yTitleEl.select(\"text\").node().getBBox().height || 0;\n\n    const maxFontHeight = (_this.height - titleHeight * 3) / (_this.selectList.data().length + 2);\n    if (fontHeight > maxFontHeight) fontHeight = maxFontHeight;\n\n    let currentAggrLevel = \"null\";\n    let aggrLevelSpacing = 0;\n\n    const groupLabels = _this.model.marker.color.getColorlegendMarker().label.getItems();\n\n    const isRTL = _this.model.locale.isRTL();\n\n    _this.selectList\n      .attr(\"transform\", (d, i) => {\n        if (d.aggrLevel != currentAggrLevel) aggrLevelSpacing += fontHeight;\n        const spacing = fontHeight * i + titleHeight * 2 + aggrLevelSpacing;\n        currentAggrLevel = d.aggrLevel;\n        return \"translate(\" + (isRTL ? _this.width : 0) + \",\" + spacing + \")\";\n      })\n      .each(function(d, i) {\n\n        const view = d3.select(this).attr(\"id\", d.KEY() + \"-label-\" + _this._id);\n        let name = \"\";\n        if (d.key) {\n          name = d.key === \"all\" ? _this.translator(\"mount/merging/world\") : groupLabels[d.key];\n        } else {\n          name = _this._getLabelText(_this.values, _this.labelNames, d.KEYS());\n        }\n\n        const number = d.valuesPointer.axis_y[utils.getKey(d.KEYS(), dataKeys.axis_y)];\n\n        const string = name + \": \" + formatter(number) + (i === 0 ? \" \" + _this.translator(\"mount/people\") : \"\");\n\n        const text = view.selectAll(\".vzb-mc-label-text\")\n          .attr(\"x\", (isRTL ? -1 : 1) * fontHeight)\n          .attr(\"y\", fontHeight)\n          .text(string)\n          .style(\"font-size\", fontHeight === maxFontHeight ? (fontHeight * fontSizeToFontHeight + \"px\") : null);\n\n        const contentBBox = text.node().getBBox();\n\n        const closeGroup = view.select(\".vzb-mc-label-x\");\n\n        if (utils.isTouchDevice()) {\n          const closeTextBBox = closeGroup.select(\"text\").node().getBBox();\n          closeGroup\n            .classed(\"vzb-revert-color\", true)\n            .select(\".vzb-mc-label-x-text\")\n            .classed(\"vzb-revert-color\", true)\n            .attr(\"x\", contentBBox.width + contentBBox.height * 1.12 + closeTextBBox.width * 0.5)\n            .attr(\"y\", contentBBox.height * 0.55);\n\n          closeGroup.select(\"rect\")\n            .attr(\"width\", closeTextBBox.width + contentBBox.height * 0.6)\n            .attr(\"height\", contentBBox.height)\n            .attr(\"x\", contentBBox.width + contentBBox.height * 0.9)\n            .attr(\"y\", 0)\n            .attr(\"rx\", contentBBox.height * 0.25)\n            .attr(\"ry\", contentBBox.height * 0.25);\n        } else {\n          closeGroup\n            .attr(\"x\", contentBBox.width + contentBBox.height * 1.1)\n            .attr(\"y\", contentBBox.height / 3);\n\n          closeGroup.select(\"circle\")\n            .attr(\"r\", contentBBox.height * 0.4)\n            .attr(\"cx\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * 1.1))\n            .attr(\"cy\", contentBBox.height / 3);\n\n          closeGroup.select(\"svg\")\n            .attr(\"x\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * (1.1 - (isRTL ? -0.4 : 0.4))))\n            .attr(\"y\", contentBBox.height * (1 / 3 - 0.4))\n            .attr(\"width\", contentBBox.height * 0.8)\n            .attr(\"height\", contentBBox.height * 0.8);\n        }\n\n        view.select(\".vzb-mc-label-legend\")\n          .attr(\"r\", fontHeight / 3)\n          .attr(\"cx\", (isRTL ? -1 : 1) * fontHeight * 0.4)\n          .attr(\"cy\", fontHeight / 1.5)\n          .style(\"fill\", _this.cScale(d.valuesPointer.color[utils.getKey(d.KEYS(), dataKeys.color)]));\n\n        view.onTap((d, i) => {\n          d3.event.stopPropagation();\n          _this.model.marker.highlightMarker(d.KEYS());\n          setTimeout(() => {\n            _this.model.marker.unhighlightMarker(d.KEYS());\n          }, 2000);\n        });\n      });\n  },\n\n  showCloseCross(d, show) {\n    const _this = this.context;\n    const key = d.KEY();\n    //show the little cross on the selected label\n    _this.selectList\n      .filter(f => f.KEY() == key)\n      .select(\".vzb-mc-label-x\")\n      .classed(\"vzb-invisible\", !show);\n  },\n\n});\n\nexport default MCSelectList;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-selectlist.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 6\n// module chunks = 0 1","module.exports = \"<div class='vzb-dialog-modal'>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-pin fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"pinDialog\\\"></span>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-drag fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"dragDialog\\\"></span>\\n    <div class=\\\"vzb-dialog-title\\\">\\n        <%=t (\\\"buttons/axes\\\") %>\\n    </div>\\n    <div class=\\\"vzb-dialog-content\\\">\\n        <div class=\\\"vzb-yaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\"><%=t (\\\"hints/mount/maxYvalue\\\") %></p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"immediate\\\"><%=t (\\\"mount/maxYmode/immediate\\\") %></label>\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"latest\\\"><%=t (\\\"mount/maxYmode/latest\\\") %></label>\\n            </form>\\n        </div>\\n        <div class=\\\"vzb-xaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n                <%=t (\\\"hints/mount/logXstops\\\") %>\\n            </p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"1\\\">1\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"2\\\">2\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"5\\\">5\\n            </form>\\n        </div>\\n        <p class=\\\"vzb-dialog-sublabel\\\">\\n            <%=t (\\\"hints/mount/xlimits\\\") %>\\n        </p>\\n        <div class=\\\"vzb-xlimits-container vzb-dialog-paragraph\\\"></div>\\n        <div class=\\\"vzb-probe-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n              <input type=\\\"checkbox\\\" name=\\\"probe\\\" class=\\\"vzb-probe-check\\\"> <%=t (\\\"hints/mount/probe\\\") %>\\n            </p>\\n            <input type=\\\"text\\\" class=\\\"vzb-probe-field\\\" name=\\\"probe\\\">\\n        </div>\\n    </div>\\n    <div class=\\\"vzb-dialog-buttons\\\">\\n        <div data-click=\\\"closeDialog\\\" class=\\\"vzb-dialog-button vzb-label-primary\\\">\\n            <%=t (\\\"buttons/ok\\\") %>\\n        </div>\\n    </div>\\n</div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/dialogs/axesmc/axesmc.html\n// module id = 7\n// module chunks = 0 1","module.exports = \"<!-- MountainChart Component -->\\n<div class=\\\"vzb-mountainchart\\\">\\n    <svg class=\\\"vzb-mountainchart-svg vzb-export\\\">\\n        <g class=\\\"vzb-mc-graph\\\">\\n            <rect class=\\\"vzb-mc-eventarea\\\"></rect>\\n            <g class=\\\"vzb-mc-year\\\"></g>\\n\\n            <g class=\\\"vzb-mc-mountains-mergestacked\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-mergegrouped\\\"></g>\\n            <g class=\\\"vzb-mc-mountains\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-labels\\\"></g>\\n\\n\\n            <g class=\\\"vzb-mc-axis-y-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x\\\"></g>\\n\\n            <g class=\\\"vzb-mc-axis-labels\\\"></g>\\n            <g class=\\\"vzb-mc-probe\\\">\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-extremepoverty\\\"></text>\\n                <line></line>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-tooltip vzb-hidden\\\">\\n                <rect class=\\\"vzb-tooltip-border\\\"></rect>\\n                <text class=\\\"vzb-tooltip-text\\\"></text>\\n            </g>\\n        </g>\\n    </svg>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 8\n// module chunks = 0 1"],"sourceRoot":""}