{"version":3,"sources":["webpack:///webpack/bootstrap d8e92f5fa8b4d37f7373","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/styles.scss?ccec","webpack:///./src/template.html"],"names":["VERSION_INFO","version","build","BubbleMap","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","default_model","state","time","entities","entities_colorlegend","marker","limit","space","hook_lat","use","index","type","_important","hook_lng","label","size","color","syncModels","locale","ui","map","path","colorGeo","preserveAspectRatio","scale","offset","top","right","bottom","left","projection","topology","objects","geo","boundaries","geoIdProperty","chart","superhighlightOnMinimapHover","labels","dragging","datawarning","doubtDomain","doubtRange","presentation","versionInfo","globals","_globals","utils","helpers","Labels","topojson","d3GeoProjection","DynamicBackground","iconset","iconWarn","warn","iconQuestion","question","BubbleMapComponent","config","context","template","require","bubblesDrawing","isMobile","isMobileOrTablet","model_expects","_this","model_binds","evt","_readyOnce","getFrame","value","frameChanged","bind","highlightMarkers","updateOpacity","indexOf","ready","entityBubbles","updateMarkerSizeLimits","redrawDataPoints","selectMarkers","updateDoubtOpacity","_blinkSuperHighlighted","sScale","cScale","d3","scaleOrdinal","schemeCategory10","COLOR_WHITEISH","_labels","CSS_PREFIX","LABELS_CONTAINER_CLASS","LINES_CONTAINER_CLASS","SUPPRESS_HIGHLIGHT_DURING_PLAY","readyOnce","element","select","graph","mapSvg","bubbleContainerCrop","bubbleContainer","labelListContainer","dataWarningEl","yTitleEl","cTitleEl","yInfoEl","cInfoEl","yearEl","year","setConditions","xAlign","yAlign","on","updateSize","initMap","TIMEDIM","getDimension","KEYS","unique","_getAllDimensions","exceptType","KEY","join","dataKeys","getDataKeysPerHook","labelNames","getLabelHookNames","updateUIStrings","wScale","scaleLinear","domain","range","updateIndicators","values","toString","defer","updateEntities","updateTime","frame","translator","getTFunction","conceptPropsS","getConceptprops","conceptPropsC","strings","title","S","C","text","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","toggle","setIcon","attr","append","html","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","node","setHook","show","setPos","hide","updateTitleNumbers","mobile","length","hovered","formatterS","getTickFormatter","formatterC","unitS","unit","unitC","valueS","getKey","valueC","isDiscrete","getColorlegendMarker","getItems","classed","opacity","getUTCFullYear","someSelected","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","someHighlighted","isHighlighted","d","isSelected","nonSelectedOpacityZero","getScale","getKeys","prefix","pointer","Object","assign","endTime","sortValue","sort","a","b","end","setVisible","call","splash","unselectBubblesWithNoData","selectAll","data","getVisible","order","exit","remove","enter","i","isTouchDevice","_interact","_mouseover","_mouseout","_click","onTap","event","stopPropagation","onLongTap","merge","forEach","selectMarker","duration","reposition","each","view","valueX","valueY","valueL","hidden_1","hidden","transition","ease","easeLinear","r","areaToRadius","cLoc","skew","interrupt","_updateLabel","time_1","playing","delayAnimations","setText","formatDate","fitSizeOfTitles","yTitleText","cTitleText","yTitleBB","cTitleBB","font","Math","max","parseInt","width","capitalize","mapPath","geoPath","mapGraph","mapFeature","feature","mesh","translate","mapBounds","bounds","features","insert","properties","toLowerCase","datum","profiles","small","margin","infoElHeight","minRadiusPx","maxRadiusEm","medium","large","presentationProfileChanges","activeProfile","getActiveProfile","containerWH","getVizWidthHeight","maxRadiusPx","hypotenuse","repositionElements","rescaleMap","widthRatio","resize","getLayoutProfile","warnBB","titleBBox","t","transform","hTranslate","translateX","translateY","s","mapWidth","mapHeight","viewPortHeight","viewPortWidth","mapTopOffset","mapLeftOffset","widthScale","heightScale","viewBoxHeight","viewBoxWidth","w","h","points","extent","minRadius","maxRadius","minArea","radiusToArea","maxArea","concat","highlightMarker","_setTooltip","clearHighlighted","isSuperHighlighted","highlight","druging","showhide","valueLST","cache","labelX0","labelY0","scaledS0","scaledC0","labelText","_getLabelText","updateLabel","showCloseCross","key","labelValues","tooltipCache","mouse","setTooltip","preload","loadFromFile","assetName","onSuccess","getAsset","response","topoPath","getProp","topoWhich","topoKey","Promise","resolve","reject","_getFirstDimension","query","language","id","from","where","$and","$in","dataPromise","load","then","dataId","getData","err","JSON","stringify"],"mappings":"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","file":"bubblemap.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d8e92f5fa8b4d37f7373","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst BubbleMap = Vizabi.Tool.extend(\"BubbleMap\", {\n\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"bubblemap\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"locale\", \"ui\", \"data\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.time\", \"locale\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }\n    ];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  default_model: {\n    state: {\n      time: {\n        \"autoconfig\": {\n          \"type\": \"time\"\n        }\n      },\n      entities: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      entities_colorlegend: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      marker: {\n        limit: 5000,\n        space: [\"entities\", \"time\"],\n        hook_lat: {\n          use: \"property\",\n          \"autoconfig\": {\n            index: 0,\n            type: \"measure\"\n          },\n          _important: true\n        },\n        hook_lng: {\n          use: \"property\",\n          \"autoconfig\": {\n            index: 1,\n            type: \"measure\"\n          },\n          _important: true\n        },\n        label: {\n          use: \"property\",\n          \"autoconfig\": {\n            \"includeOnlyIDs\": [\"name\"],\n            \"type\": \"string\"\n          }\n        },\n        size: {\n          \"autoconfig\": {\n              index: 2,\n              type: \"measure\"\n            }\n        },\n        color: {\n          syncModels: [\"marker_colorlegend\"],\n          \"autoconfig\": {}\n        }\n      },\n      \"marker_colorlegend\": {\n        \"space\": [\"entities_colorlegend\"],\n        \"label\": {\n          \"use\": \"property\",\n          \"which\": \"name\"\n        },\n        \"hook_rank\": {\n          \"use\": \"property\",\n          \"which\": \"rank\"\n        },\n        \"hook_geoshape\": {\n          \"use\": \"property\",\n          \"which\": \"shape_lores_svg\"\n        }\n      }\n    },\n    locale: { },\n    ui: {\n      map: {\n        path: null,\n        colorGeo: false,\n        preserveAspectRatio: true,\n        scale: 0.95,\n        offset: {\n          top: 0,\n          right: 0,\n          bottom: 0,\n          left: 0\n        },\n        projection: \"robinson\",\n        topology: {\n          path: null,\n          objects: {\n            geo: \"land\",\n            boundaries: \"countries\"\n          },\n          geoIdProperty: null,\n        }\n      },\n      chart: {\n        superhighlightOnMinimapHover: true,\n        labels: {\n          dragging: true\n        }\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      \"buttons\": [\"colors\", \"find\", \"size\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      \"dialogs\": {\n        \"popup\": [\"colors\", \"find\", \"size\", \"moreoptions\"],\n        \"sidebar\": [\"colors\", \"find\", \"size\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"size\", \"colors\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default BubbleMap;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  _globals: globals,\n  utils,\n  Component,\n  helpers: {\n    labels: Labels,\n    topojson,\n    \"d3.geoProjection\": d3GeoProjection,\n    \"d3.dynamicBackground\": DynamicBackground,\n  },\n  iconset: {\n    warn: iconWarn,\n    question: iconQuestion,\n  },\n} = Vizabi;\n\n\n// BUBBLE MAP CHART COMPONENT\nconst BubbleMapComponent = Component.extend(\"bubblemap\", {\n  /**\n   * Initializes the component (Bubble Map Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"bubblemap\";\n    this.template = require(\"./template.html\");\n    this.bubblesDrawing = null;\n\n\n    this.isMobile = utils.isMobileOrTablet();\n\n    //define expected models for this component\n    this.model_expects = [\n      {\n        name: \"time\",\n        type: \"time\"\n      },\n      {\n        name: \"marker\",\n        type: \"marker\"\n      },\n      {\n        name: \"locale\",\n        type: \"locale\"\n      },\n      {\n        name: \"ui\",\n        type: \"ui\"\n      },\n      {\n        name: \"data\",\n        type: \"data\"\n      }\n    ];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.getFrame(_this.model.time.value, _this.frameChanged.bind(_this));\n      },\n      \"change:marker.highlight\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.highlightMarkers();\n        _this.updateOpacity();\n      },\n      \"change:marker\": function(evt, path) {\n        // bubble size change is processed separately\n        if (!_this._readyOnce) return;\n\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n        }\n      },\n      \"change:marker.size.extent\": function(evt, path) {\n        //console.log(\"EVENT change:marker:size:max\");\n        if (!_this._readyOnce || !_this.entityBubbles) return;\n        _this.updateMarkerSizeLimits();\n        _this.redrawDataPoints(null, false);\n      },\n      \"change:marker.color.palette\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this.redrawDataPoints(null, false);\n      },\n      \"change:marker.select\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.selectMarkers();\n        _this.redrawDataPoints(null, false);\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n\n      },\n      \"change:marker.opacitySelectDim\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.opacityRegular\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.superHighlight\": () => this._readyOnce && this._blinkSuperHighlighted(),\n    };\n\n    //this._selectlist = new Selectlist(this);\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.sScale = null;\n    this.cScale = d3.scaleOrdinal(d3.schemeCategory10);\n\n    _this.COLOR_WHITEISH = \"#fdfdfd\";\n\n    d3GeoProjection();\n\n    this._labels = new Labels(this);\n    this._labels.config({\n      CSS_PREFIX: \"vzb-bmc\",\n      LABELS_CONTAINER_CLASS: \"vzb-bmc-labels\",\n      LINES_CONTAINER_CLASS: \"vzb-bmc-lines\",\n      SUPPRESS_HIGHLIGHT_DURING_PLAY: false\n    });\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n\n    this.element = d3.select(this.element);\n\n    this.graph = this.element.select(\".vzb-bmc-graph\");\n    this.mapSvg = this.element.select(\".vzb-bmc-map-background\");\n\n    this.bubbleContainerCrop = this.graph.select(\".vzb-bmc-bubbles-crop\");\n    this.bubbleContainer = this.graph.select(\".vzb-bmc-bubbles\");\n    this.labelListContainer = this.graph.select(\".vzb-bmc-bubble-labels\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.yTitleEl = this.graph.select(\".vzb-bmc-axis-y-title\");\n    this.cTitleEl = this.graph.select(\".vzb-bmc-axis-c-title\");\n    this.yInfoEl = this.graph.select(\".vzb-bmc-axis-y-info\");\n    this.cInfoEl = this.graph.select(\".vzb-bmc-axis-c-info\");\n\n    this.entityBubbles = null;\n\n    // year background\n    this.yearEl = this.graph.select(\".vzb-bmc-year\");\n    this.year = new DynamicBackground(this.yearEl);\n    this.year.setConditions({ xAlign: \"left\", yAlign: \"bottom\" });\n\n    const _this = this;\n    this.on(\"resize\", () => {\n      //return if updatesize exists with error\n      if (_this.updateSize()) return;\n      _this.updateMarkerSizeLimits();\n      _this._labels.updateSize();\n      _this.redrawDataPoints();\n      //_this._selectlist.redraw();\n\n    });\n\n    this.initMap();\n\n    this.TIMEDIM = this.model.time.getDimension();\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n    this.labelNames = this.model.marker.getLabelHookNames();\n\n    this.updateUIStrings();\n\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n\n    this._labels.readyOnce();\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    const _this = this;\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n    this.labelNames = this.model.marker.getLabelHookNames();\n\n    this.updateUIStrings();\n    this.updateIndicators();\n    this.updateSize();\n    this.updateMarkerSizeLimits();\n    this.model.marker.getFrame(this.model.time.value, (values, time) => {\n      // TODO: temporary fix for case when after data loading time changed on validation\n      if (time.toString() != _this.model.time.value.toString()) {\n        utils.defer(() => {\n          _this.ready();\n        });\n        return;\n      } // frame is outdated\n\n      if (!values) return;\n      _this.values = values;\n      _this.updateEntities();\n      _this.updateTime();\n      _this._labels.ready();\n      _this.redrawDataPoints();\n      _this.highlightMarkers();\n      _this.selectMarkers();\n//    this._selectlist.redraw();\n      _this.updateDoubtOpacity();\n      _this.updateOpacity();\n    });\n\n  },\n\n  frameChanged(frame, time) {\n    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    if (!frame) return;\n\n    this.values = frame;\n    this.updateTime();\n    this.updateDoubtOpacity();\n    this.redrawDataPoints(null, false);\n\n  },\n\n  updateUIStrings() {\n    const _this = this;\n\n    this.translator = this.model.locale.getTFunction();\n    const conceptPropsS = _this.model.marker.size.getConceptprops();\n    const conceptPropsC = _this.model.marker.color.getConceptprops();\n\n    this.strings = {\n      title: {\n        S: conceptPropsS.name,\n        C: conceptPropsC.name\n      }\n    };\n\n    this.yTitleEl.select(\"text\")\n      .text(this.translator(\"buttons/size\") + \": \" + this.strings.title.S)\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"size\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    this.cTitleEl.select(\"text\")\n      .text(this.translator(\"buttons/color\") + \": \" + this.strings.title.C)\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"color\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this.updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this.updateDoubtOpacity();\n      });\n\n    this.yInfoEl\n      .html(iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsS.description || conceptPropsS.sourceLink)));\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.yInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.yInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"size\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.yInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    this.cInfoEl\n      .html(iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsC.description || conceptPropsC.sourceLink)));\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.cInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.cInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"color\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.cInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n  },\n\n  // show size number on title when hovered on a bubble\n  updateTitleNumbers() {\n    const _this = this;\n\n    let mobile; // if is mobile device and only one bubble is selected, update the ytitle for the bubble\n    if (_this.isMobile && _this.model.marker.select && _this.model.marker.select.length === 1) {\n      mobile = _this.model.marker.select[0];\n    }\n\n    if (_this.hovered || mobile) {\n      const conceptPropsS = _this.model.marker.size.getConceptprops();\n      const conceptPropsC = _this.model.marker.color.getConceptprops();\n\n      const hovered = _this.hovered || mobile;\n      const formatterS = _this.model.marker.size.getTickFormatter();\n      const formatterC = _this.model.marker.color.getTickFormatter();\n\n      const unitS = conceptPropsS.unit || \"\";\n      const unitC = conceptPropsC.unit || \"\";\n\n      const valueS = _this.values.size[utils.getKey(hovered, this.dataKeys.size)];\n      let valueC = _this.values.color[utils.getKey(hovered, this.dataKeys.color)];\n\n      //resolve value for color from the color legend model\n      if (_this.model.marker.color.isDiscrete() && valueC) {\n        valueC = this.model.marker.color.getColorlegendMarker().label.getItems()[valueC] || \"\";\n      }\n\n      _this.yTitleEl.select(\"text\")\n        .text(_this.translator(\"buttons/size\") + \": \" + formatterS(valueS) + \" \" + unitS);\n\n      _this.cTitleEl.select(\"text\")\n        .text(_this.translator(\"buttons/color\") + \": \" +\n          (valueC || valueC === 0 ? formatterC(valueC) + \" \" + unitC : _this.translator(\"hints/nodata\")));\n\n      this.yInfoEl.classed(\"vzb-hidden\", true);\n      this.cInfoEl.classed(\"vzb-hidden\", true);\n    } else {\n      this.yTitleEl.select(\"text\")\n        .text(this.translator(\"buttons/size\") + \": \" + this.strings.title.S);\n      this.cTitleEl.select(\"text\")\n        .text(this.translator(\"buttons/color\") + \": \" + this.strings.title.C);\n\n      this.yInfoEl.classed(\"vzb-hidden\", false);\n      this.cInfoEl.classed(\"vzb-hidden\", false || this.cTitleEl.classed(\"vzb-hidden\"));\n    }\n  },\n\n  updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.time.getUTCFullYear().toString());\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  updateOpacity() {\n    const _this = this;\n    /*\n     this.entityBubbles.classed(\"vzb-selected\", function (d) {\n     return _this.model.marker.isSelected(d);\n     });\n     */\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = 0.3;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.entityBubbles.style(\"opacity\", d => {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n\n    });\n\n    this.entityBubbles.classed(\"vzb-selected\", d => _this.model.marker.isSelected(d));\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero !== this.nonSelectedOpacityZero) {\n      this.entityBubbles.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  updateIndicators() {\n    this.sScale = this.model.marker.size.getScale();\n    this.cScale = this.model.marker.color.getScale();\n  },\n\n  /**\n   * Updates entities\n   */\n  updateEntities() {\n\n    const _this = this;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    const getKeys = function(prefix) {\n      prefix = prefix || \"\";\n      return _this.model.marker.getKeys()\n        .map(d => {\n          const pointer = Object.assign({}, d);\n          //pointer[KEY] = d[KEY];\n          pointer[TIMEDIM] = endTime;\n          pointer.sortValue = _this.values.size[utils.getKey(d, _this.dataKeys.size)] || 0;\n          pointer[KEY] = prefix + utils.getKey(d, KEYS);\n          return pointer;\n        })\n        .sort((a, b) => b.sortValue - a.sortValue);\n    };\n\n    // get array of GEOs, sorted by the size hook\n    // that makes larger bubbles go behind the smaller ones\n    const endTime = this.model.time.end;\n    this.model.marker.setVisible(getKeys.call(this));\n\n    //unselecting bubbles with no data is used for the scenario when\n    //some bubbles are selected and user would switch indicator.\n    //bubbles would disappear but selection would stay\n    if (!this.model.time.splash) {\n      this.unselectBubblesWithNoData();\n    }\n\n    // TODO: add to csv\n    //Africa 9.1021° N, 18.2812°E\n    //Europe 53.0000° N, 9.0000° E\n    //Asia 49.8380° N, 105.8203° E\n    //north American 48.1667° N and longitude 100.1667° W\n    /*\n     var pos = {\n     \"afr\": {lat: 9.1, lng: 18.3},\n     \"eur\": {lat: 53.0, lng: 9.0},\n     \"asi\": {lat: 49.8, lng: 105.8},\n     \"ame\": {lat: 48.2, lng: -100.2},\n     };\n     */\n\n\n    this.entityBubbles = this.bubbleContainer.selectAll(\".vzb-bmc-bubble\")\n      .data(this.model.marker.getVisible(), d => d[KEY])\n      .order();\n\n    //exit selection\n    this.entityBubbles.exit().remove();\n\n    //enter selection -- init circles\n    this.entityBubbles = this.entityBubbles.enter().append(\"circle\")\n      .attr(\"class\", \"vzb-bmc-bubble\")\n      .on(\"mouseover\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseover(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._click(d, i);\n        _this.highlightMarkers();\n      })\n      .onTap((d, i) => {\n        _this._interact()._click(d, i);\n        d3.event.stopPropagation();\n      })\n      .onLongTap((d, i) => {\n      })\n      .merge(this.entityBubbles);\n\n  },\n\n  unselectBubblesWithNoData(frame) {\n    const _this = this;\n    if (!frame) frame = this.values;\n\n    if (!frame || !frame.size) return;\n\n    this.model.marker.select.forEach(d => {\n      const valueS = frame.size[utils.getKey(d, _this.dataKeys.size)];\n      if (!valueS && valueS !== 0)\n        _this.model.marker.selectMarker(d);\n    });\n  },\n\n  redrawDataPoints(duration, reposition) {\n    const _this = this;\n    if (!duration) duration = this.duration;\n    if (!reposition) reposition = true;\n    if (!this.entityBubbles) return utils.warn(\"redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!\");\n    const dataKeys = this.dataKeys;\n    const values = this.values;\n    \n    this.entityBubbles.each(function(d, index) {\n      const view = d3.select(this);\n      const geo = d3.select(\"#\" + d[_this.KEY]);\n\n      const valueX = values.hook_lng[utils.getKey(d, dataKeys.hook_lng)];\n      const valueY = values.hook_lat[utils.getKey(d, dataKeys.hook_lat)];\n      const valueS = values.size[utils.getKey(d, dataKeys.size)];\n      const valueC = values.color[utils.getKey(d, dataKeys.color)];\n      const valueL = values.label[utils.getKey(d, dataKeys.label)];\n\n      d.hidden_1 = d.hidden;\n      d.hidden = (!valueS && valueS !== 0) || valueX == null || valueY == null;\n\n\n      if (d.hidden !== d.hidden_1) {\n        if (duration) {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .style(\"opacity\", 0)\n            .on(\"end\", () => view.classed(\"vzb-hidden\", d.hidden).style(\"opacity\", _this.model.marker.opacityRegular));\n        } else {\n          view.classed(\"vzb-hidden\", d.hidden);\n        }\n      }\n      if (!d.hidden) {\n\n        d.r = utils.areaToRadius(_this.sScale(valueS || 0));\n        d.label = valueL;\n\n        view.classed(\"vzb-hidden\", false)\n          .attr(\"fill\", valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH);\n\n        if (_this.model.ui.map.colorGeo)\n          geo.style(\"fill\", valueC != null ? _this.cScale(valueC) : \"#999\");\n\n        if (reposition) {\n          d.cLoc = _this.skew(_this.projection([valueX || 0, valueY || 0]));\n\n          view.attr(\"cx\", d.cLoc[0])\n            .attr(\"cy\", d.cLoc[1]);\n        }\n\n        if (duration) {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"r\", d.r);\n        } else {\n          view.interrupt()\n            .attr(\"r\", d.r)\n            .transition();\n        }\n\n        _this._updateLabel(d, index, d.cLoc[0], d.cLoc[1], valueS, valueC, d.label, duration);\n      } else {\n        _this._updateLabel(d, index, 0, 0, valueS, valueC, valueL, duration);\n      }\n\n    });\n  },\n\n  /*\n   * UPDATE TIME:\n   * Ideally should only update when time or data changes\n   */\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time), this.duration);\n\n    //possibly update the exact value in size title\n    this.updateTitleNumbers();\n  },\n\n\n  fitSizeOfTitles() {\n    // reset font sizes first to make the measurement consistent\n    const yTitleText = this.yTitleEl.select(\"text\");\n    yTitleText.style(\"font-size\", null);\n\n    const cTitleText = this.cTitleEl.select(\"text\");\n    cTitleText.style(\"font-size\", null);\n\n    const yTitleBB = yTitleText.node().getBBox();\n    const cTitleBB = this.cTitleEl.classed(\"vzb-hidden\") ? yTitleBB : cTitleText.node().getBBox();\n\n    const font =\n      Math.max(parseInt(yTitleText.style(\"font-size\")), parseInt(cTitleText.style(\"font-size\")))\n      * this.width / Math.max(yTitleBB.width, cTitleBB.width);\n\n    if (Math.max(yTitleBB.width, cTitleBB.width) > this.width) {\n      yTitleText.style(\"font-size\", font + \"px\");\n      cTitleText.style(\"font-size\", font + \"px\");\n    } else {\n\n      // Else - reset the font size to default so it won't get stuck\n      yTitleText.style(\"font-size\", null);\n      cTitleText.style(\"font-size\", null);\n    }\n\n  },\n\n  initMap() {\n    if (!this.topology) utils.warn(\"bubble map afterPreload: missing country shapes \" + this.topology);\n\n    // http://bl.ocks.org/mbostock/d4021aa4dccfd65edffd patterson\n    // http://bl.ocks.org/mbostock/3710566 robinson\n    // map background\n\n    //stage\n\n    this.projection = d3[\"geo\" + utils.capitalize(this.model.ui.map.projection)]();\n\n    this.mapPath = d3.geoPath()\n      .projection(this.projection);\n\n    this.mapGraph = this.element.select(\".vzb-bmc-map-graph\");\n    this.mapGraph.html(\"\");\n\n    this.mapFeature = topojson.feature(this.topology, this.topology.objects[this.model.ui.map.topology.objects.geo]);\n    const boundaries = topojson.mesh(this.topology, this.topology.objects[this.model.ui.map.topology.objects.boundaries], (a, b) => a !== b);\n\n    // project to bounding box https://bl.ocks.org/mbostock/4707858\n    this.projection\n      .scale(1)\n      .translate([0, 0]);\n\n    this.mapBounds = this.mapPath.bounds(this.mapFeature);\n\n    if (this.mapFeature.features) {\n      this.mapGraph.selectAll(\".land\")\n        .data(this.mapFeature.features)\n        .enter().insert(\"path\")\n        .attr(\"d\", this.mapPath)\n        .attr(\"id\", d => d.properties[this.model.ui.map.topology.geoIdProperty].toLowerCase())\n        .attr(\"class\", \"land\");\n    } else {\n      this.mapGraph.insert(\"path\")\n        .datum(this.mapFeature)\n        .attr(\"class\", \"land\");\n    }\n\n    this.mapGraph.insert(\"path\")\n      .datum(boundaries)\n      .attr(\"class\", \"boundary\");\n  },\n\n  profiles: {\n    small: {\n      margin: { top: 10, right: 10, left: 10, bottom: 0 },\n      infoElHeight: 16,\n      minRadiusPx: 0.5,\n      maxRadiusEm: 0.05\n    },\n    medium: {\n      margin: { top: 20, right: 20, left: 20, bottom: 30 },\n      infoElHeight: 20,\n      minRadiusPx: 1,\n      maxRadiusEm: 0.05\n    },\n    large: {\n      margin: { top: 30, right: 30, left: 30, bottom: 35 },\n      infoElHeight: 22,\n      minRadiusPx: 1,\n      maxRadiusEm: 0.05\n    }\n  },\n\n  presentationProfileChanges: {\n    medium: {\n      infoElHeight: 26\n    },\n    large: {\n      infoElHeight: 32\n    }\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n  updateSize() {\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    const containerWH = this.root.getVizWidthHeight();\n    this.activeProfile.maxRadiusPx = Math.max(\n      this.activeProfile.minRadiusPx,\n      this.activeProfile.maxRadiusEm * utils.hypotenuse(containerWH.width, containerWH.height)\n    );\n\n    const margin = this.activeProfile.margin;\n\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Bubble map chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    this.repositionElements();\n    this.rescaleMap();\n\n  },\n\n  repositionElements() {\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n    const isRTL = this.model.locale.isRTL();\n\n    this.graph\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.year.setConditions({\n      widthRatio: 2 / 10\n    });\n    this.year.resize(this.width, this.height);\n\n    this.yTitleEl\n      .style(\"font-size\", infoElHeight)\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + margin.top + \")\");\n\n    const yTitleBB = this.yTitleEl.select(\"text\").node().getBBox();\n\n    //hide the second line about color in large profile or when color is constant\n    this.cTitleEl.attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + (margin.top + yTitleBB.height) + \")\")\n      .classed(\"vzb-hidden\", this.getLayoutProfile() === \"large\" || this.model.marker.color.use == \"constant\");\n\n    const warnBB = this.dataWarningEl.select(\"text\").node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height * 0.75)\n      .attr(\"height\", warnBB.height * 0.75)\n      .attr(\"x\", -warnBB.width - warnBB.height * 1.2)\n      .attr(\"y\", -warnBB.height * 0.65);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\" + (this.width) + \",\" + (this.height - warnBB.height * 0.5) + \")\")\n      .select(\"text\");\n\n    if (this.yInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.yInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight)\n        .attr(\"height\", infoElHeight);\n      this.yInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.cInfoEl.classed(\"vzb-hidden\", this.cTitleEl.classed(\"vzb-hidden\"));\n\n    if (!this.cInfoEl.classed(\"vzb-hidden\") && this.cInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.cTitleEl.node().getBBox();\n      const t = utils.transform(this.cTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.cInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight)\n        .attr(\"height\", infoElHeight);\n      this.cInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n  },\n\n  rescaleMap() {\n\n    const offset = this.model.ui.map.offset;\n    const margin = this.activeProfile.margin;\n\n    // scale to aspect ratio\n    // http://bl.ocks.org/mbostock/4707858\n    const s = this.model.ui.map.scale / Math.max((this.mapBounds[1][0] - this.mapBounds[0][0]) / this.width, (this.mapBounds[1][1] - this.mapBounds[0][1]) / this.height);\n\n    // dimensions of the map itself (regardless of cropping)\n    const mapWidth = (s * (this.mapBounds[1][0] - this.mapBounds[0][0]));\n    const mapHeight = (s * (this.mapBounds[1][1] - this.mapBounds[0][1]));\n\n    // dimensions of the viewport in which the map is shown (can be bigger or smaller than map)\n    let viewPortHeight = mapHeight * (1 + offset.top + offset.bottom);\n    let viewPortWidth = mapWidth * (1 + offset.left + offset.right);\n    const mapTopOffset = mapHeight * offset.top;\n    const mapLeftOffset = mapWidth * offset.left;\n\n    // translate projection to the middle of map\n    const t = [(mapWidth - s * (this.mapBounds[1][0] + this.mapBounds[0][0])) / 2, (mapHeight - s * (this.mapBounds[1][1] + this.mapBounds[0][1])) / 2];\n\n    this.projection\n      .scale(s)\n      .translate(t);\n\n    this.mapGraph\n      .selectAll(\"path\").attr(\"d\", this.mapPath);\n\n    // handle scale to fit case\n    let widthScale, heightScale;\n    if (!this.model.ui.map.preserveAspectRatio) {\n\n      // wrap viewBox around viewport so map scales to fit viewport\n      const viewBoxHeight = viewPortHeight;\n      const viewBoxWidth = viewPortWidth;\n\n      // viewport is complete area (apart from scaling)\n      viewPortHeight = this.height * this.model.ui.map.scale;\n      viewPortWidth = this.width * this.model.ui.map.scale;\n\n      this.mapSvg\n        .attr(\"preserveAspectRatio\", \"none\")\n        .attr(\"viewBox\", [0, 0, viewBoxWidth, viewBoxHeight].join(\" \"));\n\n      //            ratio between map, viewport and offset (for bubbles)\n      widthScale = viewPortWidth / (mapWidth || 1) / (1 + offset.left + offset.right);\n      heightScale = viewPortHeight / (mapHeight || 1) / (1 + offset.top + offset.bottom);\n\n    } else {\n\n      // no scaling needed\n      widthScale = 1;\n      heightScale = 1;\n\n    }\n\n    // internal offset against parent container (mapSvg)\n    this.mapGraph\n      .attr(\"transform\", \"translate(\" + mapLeftOffset + \",\" + mapTopOffset + \")\");\n\n    // resize and put in center\n    this.mapSvg\n      .style(\"transform\", \"translate3d(\" + (margin.left + (this.width - viewPortWidth) / 2) + \"px,\" + (margin.top + (this.height - viewPortHeight) / 2) + \"px,0)\")\n      .attr(\"width\", viewPortWidth)\n      .attr(\"height\", viewPortHeight);\n\n    // set skew function used for bubbles in chart\n    const _this = this;\n    this.skew = (function() {\n      const w = _this.width;\n      const h = _this.height;\n      //input pixel loc after projection, return pixel loc after skew;\n      return function(points) {\n        //      input       scale         translate                    translate offset\n        const x = points[0] * widthScale + ((w - viewPortWidth) / 2) + mapLeftOffset * widthScale;\n        const y = points[1] * heightScale + ((h - viewPortHeight) / 2) + mapTopOffset * heightScale;\n        return [x, y];\n      };\n    })();\n\n\n  },\n\n  updateMarkerSizeLimits() {\n    const _this = this;\n    const extent = this.model.marker.size.extent || [0, 1];\n\n    if (!this.activeProfile) return utils.warn(\"updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data\");\n\n    let minRadius = this.activeProfile.minRadiusPx;\n    let maxRadius = this.activeProfile.maxRadiusPx;\n\n    let minArea = utils.radiusToArea(Math.max(maxRadius * extent[0], minRadius));\n    let maxArea = utils.radiusToArea(Math.max(maxRadius * extent[1], minRadius));\n\n    let range = minArea === maxArea ? [minArea, maxArea] :\n      d3.range(minArea, maxArea, (maxArea - minArea) / this.sScale.domain().length).concat(maxArea);\n\n    this.sScale.range(range);\n  },\n\n  _interact() {\n    const _this = this;\n\n    return {\n      _mouseover(d, i) {\n        if (_this.model.time.dragging) return;\n\n        _this.model.marker.highlightMarker(d);\n\n        _this.hovered = d;\n        //put the exact value in the size title\n        _this.updateTitleNumbers();\n        _this.fitSizeOfTitles();\n\n        if (_this.model.marker.isSelected(d)) { // if selected, not show hover tooltip\n          _this._setTooltip();\n        } else {\n          //position tooltip\n          _this._setTooltip(d);\n        }\n      },\n      _mouseout(d, i) {\n        if (_this.model.time.dragging) return;\n        _this._setTooltip();\n        _this.hovered = null;\n        _this.updateTitleNumbers();\n        _this.fitSizeOfTitles();\n        _this.model.marker.clearHighlighted();\n      },\n      _click(d, i) {\n        _this.model.marker.selectMarker(d);\n      }\n    };\n\n  },\n\n  _blinkSuperHighlighted() {\n    this.entityBubbles\n      .classed(\"vzb-super-highlighted\", d => this.model.marker.isSuperHighlighted(d));\n  },\n\n  highlightMarkers() {\n    const _this = this;\n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    if (utils.isTouchDevice()) {\n      if (this.someHighlighted) {\n        _this.hovered = this.model.marker.highlight[0];\n      } else {\n        _this.hovered = null;\n      }\n      _this.updateTitleNumbers();\n      _this.fitSizeOfTitles();\n    }\n\n\n//      if (!this.selectList || !this.someSelected) return;\n//      this.selectList.classed(\"vzb-highlight\", function (d) {\n//          return _this.model.entities.isHighlighted(d);\n//      });\n//      this.selectList.each(function (d, i) {\n//        d3.select(this).selectAll(\".vzb-bmc-label-x\")\n//          .classed(\"vzb-invisible\", function(n) {\n//            return !_this.model.entities.isHighlighted(d);\n//          });\n//\n//      });\n\n  },\n\n  _updateLabel(d, index, valueX, valueY, valueS, valueC, valueL, duration) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (d[KEY] == _this.druging) return;\n    if (duration == null) duration = _this.duration;\n\n    // only for selected entities\n    if (_this.model.marker.isSelected(d)) {\n\n      const showhide = d.hidden !== d.hidden_1;\n      const valueLST = null;\n      const cache = {};\n      cache.labelX0 = valueX / this.width;\n      cache.labelY0 = valueY / this.height;\n      cache.scaledS0 = valueS ? utils.areaToRadius(_this.sScale(valueS)) : null;\n      cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n      const labelText = this._getLabelText(this.values, this.labelNames, d);\n\n      this._labels.updateLabel(d, index, cache, valueX / this.width, valueY / this.height, valueS, valueC, labelText, valueLST, duration, showhide);\n    }\n  },\n\n  selectMarkers() {\n    const _this = this;\n    const KEY = this.KEY;\n    this.someSelected = (this.model.marker.select.length > 0);\n\n//      this._selectlist.rebuild();\n    if (utils.isTouchDevice()) {\n      _this._labels.showCloseCross(null, false);\n      if (_this.someHighlighted) {\n        _this.model.marker.clearHighlighted();\n      } else {\n        _this.updateTitleNumbers();\n        _this.fitSizeOfTitles();\n      }\n    } else {\n      // hide recent hover tooltip\n      if (!_this.hovered || _this.model.marker.isSelected(_this.hovered)) {\n        _this._setTooltip();\n      }\n    }\n\n    this.nonSelectedOpacityZero = false;\n  },\n\n  _getLabelText(values, labelNames, d) {\n    return this.KEYS.map(key => values[labelNames[key]] ? values[labelNames[key]][d[key]] : d[key]).join(\", \");    \n  },\n\n  _setTooltip(d) {\n    if (d) {\n      const KEY = this.KEY;\n      const values = this.values;\n      const labelValues = {};\n      const tooltipCache = {};\n      const mouse = d3.mouse(this.graph.node()).map(d => parseInt(d));\n      const x = d.cLoc[0] || mouse[0];\n      const y = d.cLoc[1] || mouse[1];\n      const offset = d.r || 0;\n\n      labelValues.valueS = values.size[utils.getKey(d, this.dataKeys.size)];\n      labelValues.labelText = this._getLabelText(values, this.labelNames, d);\n      tooltipCache.labelX0 = labelValues.valueX = x / this.width;\n      tooltipCache.labelY0 = labelValues.valueY = y / this.height;\n      tooltipCache.scaledS0 = offset;\n      tooltipCache.scaledC0 = null;\n\n      this._labels.setTooltip(d, labelValues.labelText, tooltipCache, labelValues);\n    } else {\n      this._labels.setTooltip();\n    }\n  },\n\n  preload() {\n    const _this = this;\n\n    //this component shall fetch the preload geoshape information from a file\n    const loadFromFile = function(assetName, onSuccess) {\n      _this.model.data.getAsset(assetName, function(response){\n        _this.topology = response;\n        onSuccess();\n      });\n    }\n\n    //where the path to preload geoshape can be defined either directly in config:\n    const topoPath = utils.getProp(this, [\"model\", \"ui\", \"map\", \"topology\", \"path\"]);\n\n    //or via an entity property in dataset:\n    const topoWhich = utils.getProp(this, [\"model\", \"ui\", \"map\", \"topology\", \"which\"]);\n    const topoKey = utils.getProp(this, [\"model\", \"ui\", \"map\", \"topology\", \"key\"]);\n\n\n    return new Promise((resolve, reject) => {\n\n      // priority 1: direct URL to the topojson file\n      if (topoPath) {\n        loadFromFile(topoPath, resolve);\n\n        // priority 2: getting URL to the topojson file via DDF request\n      } else if (topoWhich) {\n        const KEY = this.model.marker._getFirstDimension({ exceptType: \"time\" });\n\n        //build a query to the reader to fetch preload info\n        const query = {\n          language: this.model.locale.id,\n          from: \"entities\",\n          select: {\n            key: [KEY],\n            value: [topoWhich]\n          },\n          where: {\n            $and: [\n              { [KEY]: \"$\" + KEY }\n            ]\n          },\n          join: {\n            [\"$\" + KEY]: { key: KEY, where: { [KEY]: { $in: [topoKey || \"world\"] } } }\n          },\n        };\n\n        const dataPromise = this.model.data.load(query, { [topoWhich]: d => d });\n\n        dataPromise.then(\n          function(dataId) {\n            loadFromFile(_this.model.data.getData(dataId)[0][topoWhich], resolve);\n          },\n          err => utils.warn(\"Problem with Preload query: \", err, JSON.stringify(query))\n        );\n\n        // priority 3: no clues provided, go for a hardcoded filename for a world map\n      } else {\n        loadFromFile(\"assets/world-50m.json\", resolve);\n      }\n\n    });\n  }\n\n\n});\n\n\nexport default BubbleMapComponent;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 2\n// module chunks = 0 1","module.exports = \"<!-- Bubble Map Chart Component -->\\n<div class=\\\"vzb-bubblemap\\\">\\n    <svg class=\\\"vzb-bmc-map-background vzb-export\\\">\\n        <g class=\\\"vzb-bmc-map-graph\\\"></g>\\n    </svg>\\n    <svg class=\\\"vzb-bubblemap-svg vzb-export\\\">\\n        <g class=\\\"vzb-bmc-graph\\\">\\n            <g class=\\\"vzb-bmc-year\\\"></g>\\n\\n            <g class=\\\"vzb-bmc-lines\\\"></g>\\n            <g class=\\\"vzb-bmc-bubbles\\\"></g>\\n            <g class=\\\"vzb-bmc-bubble-labels\\\"></g>\\n\\n\\n            <g class=\\\"vzb-bmc-axis-y-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-bmc-axis-c-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-bmc-axis-y-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-bmc-axis-c-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n            <g class=\\\"vzb-bmc-labels\\\"></g>\\n        </g>\\n    </svg>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0 1"],"sourceRoot":""}